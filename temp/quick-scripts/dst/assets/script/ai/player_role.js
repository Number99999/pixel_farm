
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/script/ai/player_role.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'b5a19zoFnJM1JpLizpjLrYq', 'player_role');
// script/ai/player_role.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    player_node: cc.Node,
    gift_node: cc.Node,
    gift_frame_arr: [cc.SpriteFrame]
  },
  // LIFE-CYCLE CALLBACKS:
  // 每隔几秒改变移动方向
  change_movement_direction: function change_movement_direction() {
    var callback = function callback() {
      this.stop_move = false;
      var num = Math.floor(Math.random() * this.all_direction.length - 1) + 1;

      if (num < 0) {
        num = 0;
      }

      ;
      this.movement_direction = this.all_direction[num];
      this.anim_select();
    };

    this.schedule(callback, Math.random() * 3 + 2);
  },
  //anim select
  anim_select: function anim_select() {
    var anim = this.player_node.getComponent(cc.Animation);
    var anim_clips = anim.getClips(); //获取动画剪辑

    switch (this.movement_direction) {
      case "z_idle":
        anim.play(anim_clips[0].name);
        break;

      case "z_run":
        anim.play(anim_clips[1].name);
        break;

      case "b_idle":
        anim.play(anim_clips[2].name);
        break;

      case "b_run":
        anim.play(anim_clips[3].name);
        break;

      case "c_idle":
        anim.play(anim_clips[4].name);
        break;

      case "c_run_l":
        this.node.scaleX = 1;
        anim.play(anim_clips[5].name);
        break;

      case "c_run_r":
        this.node.scaleX = -1;
        anim.play(anim_clips[5].name);
        break;
    }

    ;
  },
  //随机某个方向移动
  ai_move: function ai_move(dt) {
    //dt游戏时间
    //得到每帧的速度
    var s = this.move_speed * dt; //

    if (this.node.x <= -65 && this.stop_move == false) {
      this.stop_move = true;
      this.movement_direction = "c_run_r";
      this.anim_select();
    }

    if (this.node.x >= 65 && this.stop_move == false) {
      this.stop_move = true;
      this.movement_direction = "c_run_l";
      this.anim_select();
    }

    if (this.node.y >= 290 && this.stop_move == false) {
      this.stop_move = true;
      this.movement_direction = "z_run";
      this.anim_select();
    }

    if (this.node.y <= -529 && this.stop_move == false) {
      this.stop_move = true;
      this.movement_direction = "b_run";
      this.anim_select();
    } //几种不同的移动策略


    switch (this.movement_direction) {
      case "z_idle":
        s = 0;
        break;

      case "z_run":
        this.node.y -= s;
        break;

      case "b_idle":
        s = 0;
        break;

      case "b_run":
        this.node.y += s;
        break;

      case "c_idle":
        s = 0;
        break;

      case "c_run_l":
        this.node.x -= s;
        break;

      case "c_run_r":
        this.node.x += s;
        break;
    }

    ;
  },
  //按钮被点击
  on_gift_button_click: function on_gift_button_click() {
    this.sound_control.play_sound_effect("button_click");
    var random_ex = Math.floor(Math.random() * 10) + 1; //最大值为6

    if (random_ex > 6) {
      random_ex = 6;
    }

    ;

    switch (this.gift_type) {
      case "ex":
        for (var i = 0; i < random_ex; i++) {
          this.game_scene_js.create_ex_effect(this.gift_node, i);
        }

        ;
        this.gift_type = null;
        this.gift_node.active = false;
        break;

      case "ad":
        this.gift_type = null;
        this.gift_node.active = false;
        this.game_scene_js.create_gift_ui(this.game_scene_js.node);
        break;
    }

    ;
  },
  ini_node: function ini_node() {
    this.game_scene_js = cc.find("UI_ROOT").getComponent("game_scene");
    this.sound_control = cc.find("sound_control").getComponent("sound_control");
    this.all_direction = ["z_idle", "z_run", "b_idle", "b_run", "c_idle", "c_run_l", "c_run_r"];
    this.movement_direction = "z_idle"; //小人的移动速度

    this.move_speed = 30;
    this.gift_node.active = false;
    this.gift_type = null; //停止移动，边缘时触发

    this.stop_move = false;
    this.create_gift();
  },
  //生成礼物
  create_gift: function create_gift() {
    var callback = function callback() {
      var random_num = Math.random();

      if (random_num > 0.5) {
        this.gift_type = "ex";
        this.gift_node.active = true;
        this.gift_node.getComponent(cc.Sprite).spriteFrame = this.gift_frame_arr[0];
      } else {
        this.gift_type = "ad";
        this.gift_node.active = true;
        this.gift_node.getComponent(cc.Sprite).spriteFrame = this.gift_frame_arr[1];
      }

      ;
      this.hide_gift();
    };

    this.schedule(callback, 30);
  },
  //隐藏礼物
  hide_gift: function hide_gift() {
    //10s后隐藏礼物
    var callback = function callback() {
      this.gift_node.active = false;
      this.gift_type = null;
    };

    this.scheduleOnce(callback, 10);
  },
  onLoad: function onLoad() {
    this.ini_node();
  },
  start: function start() {
    this.change_movement_direction();
    this.anim_select();
  },
  update: function update(dt) {
    this.ai_move(dt);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0XFxhaVxccGxheWVyX3JvbGUuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJwbGF5ZXJfbm9kZSIsIk5vZGUiLCJnaWZ0X25vZGUiLCJnaWZ0X2ZyYW1lX2FyciIsIlNwcml0ZUZyYW1lIiwiY2hhbmdlX21vdmVtZW50X2RpcmVjdGlvbiIsImNhbGxiYWNrIiwic3RvcF9tb3ZlIiwibnVtIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiYWxsX2RpcmVjdGlvbiIsImxlbmd0aCIsIm1vdmVtZW50X2RpcmVjdGlvbiIsImFuaW1fc2VsZWN0Iiwic2NoZWR1bGUiLCJhbmltIiwiZ2V0Q29tcG9uZW50IiwiQW5pbWF0aW9uIiwiYW5pbV9jbGlwcyIsImdldENsaXBzIiwicGxheSIsIm5hbWUiLCJub2RlIiwic2NhbGVYIiwiYWlfbW92ZSIsImR0IiwicyIsIm1vdmVfc3BlZWQiLCJ4IiwieSIsIm9uX2dpZnRfYnV0dG9uX2NsaWNrIiwic291bmRfY29udHJvbCIsInBsYXlfc291bmRfZWZmZWN0IiwicmFuZG9tX2V4IiwiZ2lmdF90eXBlIiwiaSIsImdhbWVfc2NlbmVfanMiLCJjcmVhdGVfZXhfZWZmZWN0IiwiYWN0aXZlIiwiY3JlYXRlX2dpZnRfdWkiLCJpbmlfbm9kZSIsImZpbmQiLCJjcmVhdGVfZ2lmdCIsInJhbmRvbV9udW0iLCJTcHJpdGUiLCJzcHJpdGVGcmFtZSIsImhpZGVfZ2lmdCIsInNjaGVkdWxlT25jZSIsIm9uTG9hZCIsInN0YXJ0IiwidXBkYXRlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUsQ0FBQ0UsU0FEUDtBQUdMQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsV0FBVyxFQUFFSixFQUFFLENBQUNLLElBRFI7QUFFUkMsSUFBQUEsU0FBUyxFQUFFTixFQUFFLENBQUNLLElBRk47QUFHUkUsSUFBQUEsY0FBYyxFQUFFLENBQUNQLEVBQUUsQ0FBQ1EsV0FBSjtBQUhSLEdBSFA7QUFTTDtBQUNBO0FBQ0FDLEVBQUFBLHlCQUF5QixFQUFFLHFDQUFZO0FBQ25DLFFBQUlDLFFBQVEsR0FBRyxTQUFYQSxRQUFXLEdBQVk7QUFDdkIsV0FBS0MsU0FBTCxHQUFpQixLQUFqQjtBQUNBLFVBQUlDLEdBQUcsR0FBR0MsSUFBSSxDQUFDQyxLQUFMLENBQVdELElBQUksQ0FBQ0UsTUFBTCxLQUFnQixLQUFLQyxhQUFMLENBQW1CQyxNQUFuQyxHQUE0QyxDQUF2RCxJQUE0RCxDQUF0RTs7QUFDQSxVQUFJTCxHQUFHLEdBQUcsQ0FBVixFQUFhO0FBQ1RBLFFBQUFBLEdBQUcsR0FBRyxDQUFOO0FBQ0g7O0FBQUE7QUFDRCxXQUFLTSxrQkFBTCxHQUEwQixLQUFLRixhQUFMLENBQW1CSixHQUFuQixDQUExQjtBQUNBLFdBQUtPLFdBQUw7QUFDSCxLQVJEOztBQVNBLFNBQUtDLFFBQUwsQ0FBY1YsUUFBZCxFQUF3QkcsSUFBSSxDQUFDRSxNQUFMLEtBQWdCLENBQWhCLEdBQW9CLENBQTVDO0FBQ0gsR0F0Qkk7QUF1Qkw7QUFDQUksRUFBQUEsV0FBVyxFQUFFLHVCQUFZO0FBQ3JCLFFBQUlFLElBQUksR0FBRyxLQUFLakIsV0FBTCxDQUFpQmtCLFlBQWpCLENBQThCdEIsRUFBRSxDQUFDdUIsU0FBakMsQ0FBWDtBQUNBLFFBQUlDLFVBQVUsR0FBR0gsSUFBSSxDQUFDSSxRQUFMLEVBQWpCLENBRnFCLENBRVk7O0FBQ2pDLFlBQVEsS0FBS1Asa0JBQWI7QUFDSSxXQUFLLFFBQUw7QUFDSUcsUUFBQUEsSUFBSSxDQUFDSyxJQUFMLENBQVVGLFVBQVUsQ0FBQyxDQUFELENBQVYsQ0FBY0csSUFBeEI7QUFDQTs7QUFDSixXQUFLLE9BQUw7QUFDSU4sUUFBQUEsSUFBSSxDQUFDSyxJQUFMLENBQVVGLFVBQVUsQ0FBQyxDQUFELENBQVYsQ0FBY0csSUFBeEI7QUFDQTs7QUFDSixXQUFLLFFBQUw7QUFDSU4sUUFBQUEsSUFBSSxDQUFDSyxJQUFMLENBQVVGLFVBQVUsQ0FBQyxDQUFELENBQVYsQ0FBY0csSUFBeEI7QUFDQTs7QUFDSixXQUFLLE9BQUw7QUFDSU4sUUFBQUEsSUFBSSxDQUFDSyxJQUFMLENBQVVGLFVBQVUsQ0FBQyxDQUFELENBQVYsQ0FBY0csSUFBeEI7QUFDQTs7QUFDSixXQUFLLFFBQUw7QUFDSU4sUUFBQUEsSUFBSSxDQUFDSyxJQUFMLENBQVVGLFVBQVUsQ0FBQyxDQUFELENBQVYsQ0FBY0csSUFBeEI7QUFDQTs7QUFDSixXQUFLLFNBQUw7QUFDSSxhQUFLQyxJQUFMLENBQVVDLE1BQVYsR0FBbUIsQ0FBbkI7QUFDQVIsUUFBQUEsSUFBSSxDQUFDSyxJQUFMLENBQVVGLFVBQVUsQ0FBQyxDQUFELENBQVYsQ0FBY0csSUFBeEI7QUFDQTs7QUFDSixXQUFLLFNBQUw7QUFDSSxhQUFLQyxJQUFMLENBQVVDLE1BQVYsR0FBbUIsQ0FBQyxDQUFwQjtBQUNBUixRQUFBQSxJQUFJLENBQUNLLElBQUwsQ0FBVUYsVUFBVSxDQUFDLENBQUQsQ0FBVixDQUFjRyxJQUF4QjtBQUNBO0FBdkJSOztBQXdCQztBQUNKLEdBcERJO0FBcURMO0FBQ0FHLEVBQUFBLE9BQU8sRUFBRSxpQkFBVUMsRUFBVixFQUFjO0FBQUU7QUFFckI7QUFDQSxRQUFJQyxDQUFDLEdBQUcsS0FBS0MsVUFBTCxHQUFrQkYsRUFBMUIsQ0FIbUIsQ0FJbkI7O0FBQ0EsUUFBSSxLQUFLSCxJQUFMLENBQVVNLENBQVYsSUFBZSxDQUFDLEVBQWhCLElBQXNCLEtBQUt2QixTQUFMLElBQWtCLEtBQTVDLEVBQW1EO0FBQy9DLFdBQUtBLFNBQUwsR0FBaUIsSUFBakI7QUFDQSxXQUFLTyxrQkFBTCxHQUEwQixTQUExQjtBQUNBLFdBQUtDLFdBQUw7QUFDSDs7QUFDRCxRQUFJLEtBQUtTLElBQUwsQ0FBVU0sQ0FBVixJQUFlLEVBQWYsSUFBcUIsS0FBS3ZCLFNBQUwsSUFBa0IsS0FBM0MsRUFBa0Q7QUFDOUMsV0FBS0EsU0FBTCxHQUFpQixJQUFqQjtBQUNBLFdBQUtPLGtCQUFMLEdBQTBCLFNBQTFCO0FBQ0EsV0FBS0MsV0FBTDtBQUVIOztBQUNELFFBQUksS0FBS1MsSUFBTCxDQUFVTyxDQUFWLElBQWUsR0FBZixJQUFzQixLQUFLeEIsU0FBTCxJQUFrQixLQUE1QyxFQUFtRDtBQUMvQyxXQUFLQSxTQUFMLEdBQWlCLElBQWpCO0FBQ0EsV0FBS08sa0JBQUwsR0FBMEIsT0FBMUI7QUFDQSxXQUFLQyxXQUFMO0FBRUg7O0FBQ0QsUUFBSSxLQUFLUyxJQUFMLENBQVVPLENBQVYsSUFBZSxDQUFDLEdBQWhCLElBQXVCLEtBQUt4QixTQUFMLElBQWtCLEtBQTdDLEVBQW9EO0FBQ2hELFdBQUtBLFNBQUwsR0FBaUIsSUFBakI7QUFDQSxXQUFLTyxrQkFBTCxHQUEwQixPQUExQjtBQUNBLFdBQUtDLFdBQUw7QUFDSCxLQTFCa0IsQ0E0Qm5COzs7QUFDQSxZQUFRLEtBQUtELGtCQUFiO0FBQ0ksV0FBSyxRQUFMO0FBQ0ljLFFBQUFBLENBQUMsR0FBRyxDQUFKO0FBQ0E7O0FBQ0osV0FBSyxPQUFMO0FBQ0ksYUFBS0osSUFBTCxDQUFVTyxDQUFWLElBQWVILENBQWY7QUFDQTs7QUFDSixXQUFLLFFBQUw7QUFDSUEsUUFBQUEsQ0FBQyxHQUFHLENBQUo7QUFDQTs7QUFDSixXQUFLLE9BQUw7QUFDSSxhQUFLSixJQUFMLENBQVVPLENBQVYsSUFBZUgsQ0FBZjtBQUNBOztBQUNKLFdBQUssUUFBTDtBQUNJQSxRQUFBQSxDQUFDLEdBQUcsQ0FBSjtBQUNBOztBQUNKLFdBQUssU0FBTDtBQUNJLGFBQUtKLElBQUwsQ0FBVU0sQ0FBVixJQUFlRixDQUFmO0FBQ0E7O0FBQ0osV0FBSyxTQUFMO0FBQ0ksYUFBS0osSUFBTCxDQUFVTSxDQUFWLElBQWVGLENBQWY7QUFDQTtBQXJCUjs7QUFzQkM7QUFFSixHQTNHSTtBQTRHTDtBQUNBSSxFQUFBQSxvQkE3R0ssa0NBNkdrQjtBQUNuQixTQUFLQyxhQUFMLENBQW1CQyxpQkFBbkIsQ0FBcUMsY0FBckM7QUFDQSxRQUFJQyxTQUFTLEdBQUcxQixJQUFJLENBQUNDLEtBQUwsQ0FBV0QsSUFBSSxDQUFDRSxNQUFMLEtBQWdCLEVBQTNCLElBQWlDLENBQWpELENBRm1CLENBR25COztBQUNBLFFBQUd3QixTQUFTLEdBQUUsQ0FBZCxFQUFnQjtBQUNaQSxNQUFBQSxTQUFTLEdBQUcsQ0FBWjtBQUNIOztBQUFBOztBQUNELFlBQVEsS0FBS0MsU0FBYjtBQUNJLFdBQUssSUFBTDtBQUNJLGFBQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0YsU0FBcEIsRUFBK0JFLENBQUMsRUFBaEMsRUFBb0M7QUFDaEMsZUFBS0MsYUFBTCxDQUFtQkMsZ0JBQW5CLENBQW9DLEtBQUtyQyxTQUF6QyxFQUFvRG1DLENBQXBEO0FBQ0g7O0FBQUE7QUFDRCxhQUFLRCxTQUFMLEdBQWlCLElBQWpCO0FBQ0EsYUFBS2xDLFNBQUwsQ0FBZXNDLE1BQWYsR0FBd0IsS0FBeEI7QUFDQTs7QUFDSixXQUFLLElBQUw7QUFDSSxhQUFLSixTQUFMLEdBQWlCLElBQWpCO0FBQ0EsYUFBS2xDLFNBQUwsQ0FBZXNDLE1BQWYsR0FBd0IsS0FBeEI7QUFDQSxhQUFLRixhQUFMLENBQW1CRyxjQUFuQixDQUFrQyxLQUFLSCxhQUFMLENBQW1CZCxJQUFyRDtBQUNBO0FBWlI7O0FBYUM7QUFDSixHQWxJSTtBQW1JTGtCLEVBQUFBLFFBQVEsRUFBRSxvQkFBWTtBQUNsQixTQUFLSixhQUFMLEdBQXFCMUMsRUFBRSxDQUFDK0MsSUFBSCxDQUFRLFNBQVIsRUFBbUJ6QixZQUFuQixDQUFnQyxZQUFoQyxDQUFyQjtBQUNBLFNBQUtlLGFBQUwsR0FBcUJyQyxFQUFFLENBQUMrQyxJQUFILENBQVEsZUFBUixFQUF5QnpCLFlBQXpCLENBQXNDLGVBQXRDLENBQXJCO0FBQ0EsU0FBS04sYUFBTCxHQUFxQixDQUFDLFFBQUQsRUFBVyxPQUFYLEVBQW9CLFFBQXBCLEVBQThCLE9BQTlCLEVBQXVDLFFBQXZDLEVBQWlELFNBQWpELEVBQTRELFNBQTVELENBQXJCO0FBQ0EsU0FBS0Usa0JBQUwsR0FBMEIsUUFBMUIsQ0FKa0IsQ0FLbEI7O0FBQ0EsU0FBS2UsVUFBTCxHQUFrQixFQUFsQjtBQUNBLFNBQUszQixTQUFMLENBQWVzQyxNQUFmLEdBQXdCLEtBQXhCO0FBQ0EsU0FBS0osU0FBTCxHQUFpQixJQUFqQixDQVJrQixDQVNsQjs7QUFDQSxTQUFLN0IsU0FBTCxHQUFpQixLQUFqQjtBQUNBLFNBQUtxQyxXQUFMO0FBQ0gsR0EvSUk7QUFnSkw7QUFDQUEsRUFBQUEsV0FqSksseUJBaUpTO0FBQ1YsUUFBSXRDLFFBQVEsR0FBRyxTQUFYQSxRQUFXLEdBQVk7QUFDdkIsVUFBSXVDLFVBQVUsR0FBR3BDLElBQUksQ0FBQ0UsTUFBTCxFQUFqQjs7QUFDQSxVQUFJa0MsVUFBVSxHQUFHLEdBQWpCLEVBQXNCO0FBQ2xCLGFBQUtULFNBQUwsR0FBaUIsSUFBakI7QUFDQSxhQUFLbEMsU0FBTCxDQUFlc0MsTUFBZixHQUF3QixJQUF4QjtBQUNBLGFBQUt0QyxTQUFMLENBQWVnQixZQUFmLENBQTRCdEIsRUFBRSxDQUFDa0QsTUFBL0IsRUFBdUNDLFdBQXZDLEdBQXFELEtBQUs1QyxjQUFMLENBQW9CLENBQXBCLENBQXJEO0FBQ0gsT0FKRCxNQUlPO0FBQ0gsYUFBS2lDLFNBQUwsR0FBaUIsSUFBakI7QUFDQSxhQUFLbEMsU0FBTCxDQUFlc0MsTUFBZixHQUF3QixJQUF4QjtBQUNBLGFBQUt0QyxTQUFMLENBQWVnQixZQUFmLENBQTRCdEIsRUFBRSxDQUFDa0QsTUFBL0IsRUFBdUNDLFdBQXZDLEdBQXFELEtBQUs1QyxjQUFMLENBQW9CLENBQXBCLENBQXJEO0FBRUg7O0FBQUE7QUFDRCxXQUFLNkMsU0FBTDtBQUNILEtBYkQ7O0FBY0EsU0FBS2hDLFFBQUwsQ0FBY1YsUUFBZCxFQUF3QixFQUF4QjtBQUNILEdBaktJO0FBa0tMO0FBQ0EwQyxFQUFBQSxTQW5LSyx1QkFtS087QUFDUjtBQUNBLFFBQUkxQyxRQUFRLEdBQUcsU0FBWEEsUUFBVyxHQUFZO0FBQ3ZCLFdBQUtKLFNBQUwsQ0FBZXNDLE1BQWYsR0FBd0IsS0FBeEI7QUFDQSxXQUFLSixTQUFMLEdBQWlCLElBQWpCO0FBQ0gsS0FIRDs7QUFJQSxTQUFLYSxZQUFMLENBQWtCM0MsUUFBbEIsRUFBNEIsRUFBNUI7QUFDSCxHQTFLSTtBQTJLTDRDLEVBQUFBLE1BM0tLLG9CQTJLSTtBQUNMLFNBQUtSLFFBQUw7QUFDSCxHQTdLSTtBQStLTFMsRUFBQUEsS0EvS0ssbUJBK0tHO0FBQ0osU0FBSzlDLHlCQUFMO0FBQ0EsU0FBS1UsV0FBTDtBQUNILEdBbExJO0FBb0xMcUMsRUFBQUEsTUFwTEssa0JBb0xFekIsRUFwTEYsRUFvTE07QUFDUCxTQUFLRCxPQUFMLENBQWFDLEVBQWI7QUFDSDtBQXRMSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBwbGF5ZXJfbm9kZTogY2MuTm9kZSxcbiAgICAgICAgZ2lmdF9ub2RlOiBjYy5Ob2RlLFxuICAgICAgICBnaWZ0X2ZyYW1lX2FycjogW2NjLlNwcml0ZUZyYW1lXSxcbiAgICB9LFxuXG4gICAgLy8gTElGRS1DWUNMRSBDQUxMQkFDS1M6XG4gICAgLy8g5q+P6ZqU5Yeg56eS5pS55Y+Y56e75Yqo5pa55ZCRXG4gICAgY2hhbmdlX21vdmVtZW50X2RpcmVjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3BfbW92ZSA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIG51bSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuYWxsX2RpcmVjdGlvbi5sZW5ndGggLSAxKSArIDE7XG4gICAgICAgICAgICBpZiAobnVtIDwgMCkge1xuICAgICAgICAgICAgICAgIG51bSA9IDA7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5tb3ZlbWVudF9kaXJlY3Rpb24gPSB0aGlzLmFsbF9kaXJlY3Rpb25bbnVtXTtcbiAgICAgICAgICAgIHRoaXMuYW5pbV9zZWxlY3QoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zY2hlZHVsZShjYWxsYmFjaywgTWF0aC5yYW5kb20oKSAqIDMgKyAyKTtcbiAgICB9LFxuICAgIC8vYW5pbSBzZWxlY3RcbiAgICBhbmltX3NlbGVjdDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYW5pbSA9IHRoaXMucGxheWVyX25vZGUuZ2V0Q29tcG9uZW50KGNjLkFuaW1hdGlvbik7XG4gICAgICAgIHZhciBhbmltX2NsaXBzID0gYW5pbS5nZXRDbGlwcygpOy8v6I635Y+W5Yqo55S75Ymq6L6RXG4gICAgICAgIHN3aXRjaCAodGhpcy5tb3ZlbWVudF9kaXJlY3Rpb24pIHtcbiAgICAgICAgICAgIGNhc2UgXCJ6X2lkbGVcIjpcbiAgICAgICAgICAgICAgICBhbmltLnBsYXkoYW5pbV9jbGlwc1swXS5uYW1lKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ6X3J1blwiOlxuICAgICAgICAgICAgICAgIGFuaW0ucGxheShhbmltX2NsaXBzWzFdLm5hbWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImJfaWRsZVwiOlxuICAgICAgICAgICAgICAgIGFuaW0ucGxheShhbmltX2NsaXBzWzJdLm5hbWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImJfcnVuXCI6XG4gICAgICAgICAgICAgICAgYW5pbS5wbGF5KGFuaW1fY2xpcHNbM10ubmFtZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiY19pZGxlXCI6XG4gICAgICAgICAgICAgICAgYW5pbS5wbGF5KGFuaW1fY2xpcHNbNF0ubmFtZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiY19ydW5fbFwiOlxuICAgICAgICAgICAgICAgIHRoaXMubm9kZS5zY2FsZVggPSAxO1xuICAgICAgICAgICAgICAgIGFuaW0ucGxheShhbmltX2NsaXBzWzVdLm5hbWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImNfcnVuX3JcIjpcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUuc2NhbGVYID0gLTE7XG4gICAgICAgICAgICAgICAgYW5pbS5wbGF5KGFuaW1fY2xpcHNbNV0ubmFtZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH07XG4gICAgfSxcbiAgICAvL+maj+acuuafkOS4quaWueWQkeenu+WKqFxuICAgIGFpX21vdmU6IGZ1bmN0aW9uIChkdCkgeyAvL2R05ri45oiP5pe26Ze0XG5cbiAgICAgICAgLy/lvpfliLDmr4/luKfnmoTpgJ/luqZcbiAgICAgICAgdmFyIHMgPSB0aGlzLm1vdmVfc3BlZWQgKiBkdDtcbiAgICAgICAgLy9cbiAgICAgICAgaWYgKHRoaXMubm9kZS54IDw9IC02NSAmJiB0aGlzLnN0b3BfbW92ZSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy5zdG9wX21vdmUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5tb3ZlbWVudF9kaXJlY3Rpb24gPSBcImNfcnVuX3JcIjtcbiAgICAgICAgICAgIHRoaXMuYW5pbV9zZWxlY3QoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5ub2RlLnggPj0gNjUgJiYgdGhpcy5zdG9wX21vdmUgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHRoaXMuc3RvcF9tb3ZlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubW92ZW1lbnRfZGlyZWN0aW9uID0gXCJjX3J1bl9sXCI7XG4gICAgICAgICAgICB0aGlzLmFuaW1fc2VsZWN0KCk7XG5cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5ub2RlLnkgPj0gMjkwICYmIHRoaXMuc3RvcF9tb3ZlID09IGZhbHNlKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3BfbW92ZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLm1vdmVtZW50X2RpcmVjdGlvbiA9IFwiel9ydW5cIjtcbiAgICAgICAgICAgIHRoaXMuYW5pbV9zZWxlY3QoKTtcblxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm5vZGUueSA8PSAtNTI5ICYmIHRoaXMuc3RvcF9tb3ZlID09IGZhbHNlKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3BfbW92ZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLm1vdmVtZW50X2RpcmVjdGlvbiA9IFwiYl9ydW5cIjtcbiAgICAgICAgICAgIHRoaXMuYW5pbV9zZWxlY3QoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5Yeg56eN5LiN5ZCM55qE56e75Yqo562W55WlXG4gICAgICAgIHN3aXRjaCAodGhpcy5tb3ZlbWVudF9kaXJlY3Rpb24pIHtcbiAgICAgICAgICAgIGNhc2UgXCJ6X2lkbGVcIjpcbiAgICAgICAgICAgICAgICBzID0gMDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ6X3J1blwiOlxuICAgICAgICAgICAgICAgIHRoaXMubm9kZS55IC09IHM7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiYl9pZGxlXCI6XG4gICAgICAgICAgICAgICAgcyA9IDA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiYl9ydW5cIjpcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUueSArPSBzO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImNfaWRsZVwiOlxuICAgICAgICAgICAgICAgIHMgPSAwO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImNfcnVuX2xcIjpcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUueCAtPSBzO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImNfcnVuX3JcIjpcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUueCArPSBzO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9O1xuXG4gICAgfSxcbiAgICAvL+aMiemSruiiq+eCueWHu1xuICAgIG9uX2dpZnRfYnV0dG9uX2NsaWNrKCkge1xuICAgICAgICB0aGlzLnNvdW5kX2NvbnRyb2wucGxheV9zb3VuZF9lZmZlY3QoXCJidXR0b25fY2xpY2tcIik7XG4gICAgICAgIHZhciByYW5kb21fZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCkgKyAxO1xuICAgICAgICAvL+acgOWkp+WAvOS4ujZcbiAgICAgICAgaWYocmFuZG9tX2V4ID42KXtcbiAgICAgICAgICAgIHJhbmRvbV9leCA9IDY7XG4gICAgICAgIH07XG4gICAgICAgIHN3aXRjaCAodGhpcy5naWZ0X3R5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJleFwiOlxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmFuZG9tX2V4OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lX3NjZW5lX2pzLmNyZWF0ZV9leF9lZmZlY3QodGhpcy5naWZ0X25vZGUsIGkpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdGhpcy5naWZ0X3R5cGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2lmdF9ub2RlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImFkXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5naWZ0X3R5cGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2lmdF9ub2RlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZV9zY2VuZV9qcy5jcmVhdGVfZ2lmdF91aSh0aGlzLmdhbWVfc2NlbmVfanMubm9kZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH07XG4gICAgfSxcbiAgICBpbmlfbm9kZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmdhbWVfc2NlbmVfanMgPSBjYy5maW5kKFwiVUlfUk9PVFwiKS5nZXRDb21wb25lbnQoXCJnYW1lX3NjZW5lXCIpO1xuICAgICAgICB0aGlzLnNvdW5kX2NvbnRyb2wgPSBjYy5maW5kKFwic291bmRfY29udHJvbFwiKS5nZXRDb21wb25lbnQoXCJzb3VuZF9jb250cm9sXCIpO1xuICAgICAgICB0aGlzLmFsbF9kaXJlY3Rpb24gPSBbXCJ6X2lkbGVcIiwgXCJ6X3J1blwiLCBcImJfaWRsZVwiLCBcImJfcnVuXCIsIFwiY19pZGxlXCIsIFwiY19ydW5fbFwiLCBcImNfcnVuX3JcIl07XG4gICAgICAgIHRoaXMubW92ZW1lbnRfZGlyZWN0aW9uID0gXCJ6X2lkbGVcIjtcbiAgICAgICAgLy/lsI/kurrnmoTnp7vliqjpgJ/luqZcbiAgICAgICAgdGhpcy5tb3ZlX3NwZWVkID0gMzA7XG4gICAgICAgIHRoaXMuZ2lmdF9ub2RlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmdpZnRfdHlwZSA9IG51bGw7XG4gICAgICAgIC8v5YGc5q2i56e75Yqo77yM6L6557yY5pe26Kem5Y+RXG4gICAgICAgIHRoaXMuc3RvcF9tb3ZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY3JlYXRlX2dpZnQoKTtcbiAgICB9LFxuICAgIC8v55Sf5oiQ56S854mpXG4gICAgY3JlYXRlX2dpZnQoKSB7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciByYW5kb21fbnVtID0gTWF0aC5yYW5kb20oKTtcbiAgICAgICAgICAgIGlmIChyYW5kb21fbnVtID4gMC41KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5naWZ0X3R5cGUgPSBcImV4XCI7XG4gICAgICAgICAgICAgICAgdGhpcy5naWZ0X25vZGUuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmdpZnRfbm9kZS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHRoaXMuZ2lmdF9mcmFtZV9hcnJbMF07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2lmdF90eXBlID0gXCJhZFwiO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2lmdF9ub2RlLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5naWZ0X25vZGUuZ2V0Q29tcG9uZW50KGNjLlNwcml0ZSkuc3ByaXRlRnJhbWUgPSB0aGlzLmdpZnRfZnJhbWVfYXJyWzFdO1xuXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5oaWRlX2dpZnQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zY2hlZHVsZShjYWxsYmFjaywgMzApO1xuICAgIH0sXG4gICAgLy/pmpDol4/npLznialcbiAgICBoaWRlX2dpZnQoKSB7XG4gICAgICAgIC8vMTBz5ZCO6ZqQ6JeP56S854mpXG4gICAgICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuZ2lmdF9ub2RlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5naWZ0X3R5cGUgPSBudWxsO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNjaGVkdWxlT25jZShjYWxsYmFjaywgMTApO1xuICAgIH0sXG4gICAgb25Mb2FkKCkge1xuICAgICAgICB0aGlzLmluaV9ub2RlKCk7XG4gICAgfSxcblxuICAgIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLmNoYW5nZV9tb3ZlbWVudF9kaXJlY3Rpb24oKTtcbiAgICAgICAgdGhpcy5hbmltX3NlbGVjdCgpO1xuICAgIH0sXG5cbiAgICB1cGRhdGUoZHQpIHtcbiAgICAgICAgdGhpcy5haV9tb3ZlKGR0KTtcbiAgICB9LFxufSk7Il19