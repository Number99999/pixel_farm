
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/script/ui/sell_ui.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'b3408LFwupOPKoN9Pojb+Zi', 'sell_ui');
// script/ui/sell_ui.js

"use strict";

var user_data = require("user_data");

var config = require("config");

cc.Class({
  "extends": cc.Component,
  properties: {
    box_frame_arr: [cc.SpriteFrame],
    icon_group_node: cc.Node,
    label_group_node: cc.Node,
    // estimate_label: cc.Label,
    lock_group_node: cc.Node,
    confirm_button_node: cc.Node,
    sum_gold: 0,
    index: 0
  },
  // LIFE-CYCLE CALLBACKS:
  ini_node: function ini_node() {
    this.game_scene_js = cc.find("UI_ROOT").getComponent("game_scene");
    this.game_rules_js = cc.find("UI_ROOT").getComponent("game_rules");
    this.adsManager_js = cc.find("UI_ROOT").getComponent("AdsManager");
    this.ad_control = cc.find("ad_control").getComponent("ad_control");
    this.sound_control = cc.find("sound_control").getComponent("sound_control");
    this.ad_control.show_bannerAd();
    this.set_sell(); // this.set_estimate_label();
  },
  button_unlock_click: function button_unlock_click(e, custom) {
    // button unlock repo
    this.node.children[2].active = false; // show POP-UP open new repo

    this.node.children[3].active = true; // hidden repo

    this.show_comfirm_buy(custom);
  },
  show_comfirm_buy: function show_comfirm_buy(custom) {
    // hiển thị số tiền để mua rương, thêm nút xác nhận
    this.sum_gold = Number(0); // var sum_diamond = 0;

    for (var i = 0; i <= custom; i++) {
      if (user_data.user_data.wareHouse[i].have == 0) {
        this.sum_gold += user_data.user_data.wareHouse[i].cost;
      }
    }

    this.node.children[3].children[0].getComponent(cc.Label).string = "Do you want use " + this.sum_gold + " gold to buy new repository?";
    this.index = custom;
  },
  buy_repo: function buy_repo() {
    if (user_data.user_data.gold >= this.sum_gold) {
      // console.log("sum_godl " + sum_gold);
      // user_data.user_data.diamond -= this.sum_diamond;
      for (var i = 0; i <= this.index; i++) {
        user_data.user_data.wareHouse[i].have = 1;
        this.lock_group_node.children[i].active = false;
        this.label_group_node.children[i].getComponent(cc.Label).string = "0/30";
        this.game_scene_js.create_tips_ui(this.game_scene_js.node, "unlocked_repo");
      }

      this.game_rules_js.add_gold(-this.sum_gold);
      this.touch_exit();
    } else {
      console.log(this.sum_gold + " sum_gold");
      this.game_scene_js.create_tips_ui(this.game_scene_js.node, "no_money_gold");
    }
  },
  // auto_sell: function () {    // tự động bán hàng trong kho // chưa xong
  //     var time_auto = 60 * 60;
  //     var auto = function () {
  //         time_auto -=0.1;
  //     };
  //     this.schedule(this.auto, 0.1);
  // },
  set_sell: function set_sell() {
    var all_capacity = 30;

    for (var i = 0; i < this.icon_group_node.children.length; i++) {
      if (user_data.user_data.wareHouse[i].have == 1) {
        var count = user_data.user_data.wareHouse[i].count;
        this.label_group_node.children[i].getComponent(cc.Label).string = count + "/" + all_capacity;
        this.lock_group_node.children[i].active = false;

        if (count > 0) {
          var id_product = user_data.user_data.wareHouse[i].id_product;
          this.icon_group_node.children[i].getComponent(cc.Sprite).spriteFrame = this.box_frame_arr[id_product];
        } else {
          this.icon_group_node.children[i].getComponent(cc.Sprite).spriteFrame = this.box_frame_arr[8];
        }
      } else {
        this.label_group_node.children[i].getComponent(cc.Label).string = '';
        this.lock_group_node.children[i].active = true;
        this.icon_group_node.children[i].getComponent(cc.Sprite).SpriteFrame = this.box_frame_arr[8];
      }
    }
  },
  touch_exit: function touch_exit() {
    if (this.node.children[2].active == false) {
      this.node.children[2].active = true;
      this.node.children[3].active = false;
    } else {
      this.sound_control.play_sound_effect("button_exit");
      this.ad_control.hide_bannerAd();
      this.game_scene_js.on_node_kill(this.node);
    }
  },
  //设置预计卖出文字
  set_estimate_label: function set_estimate_label() {
    var sum = 0;

    for (var i = 0; i < this.icon_group_node.children.length; i++) {
      var count = user_data.user_data.wareHouse[i].count;
      var sell = config.plant[i].sell;
      sum += count * sell;
    }

    ;
    this.estimate_label.string = "Expected to sell: " + sum;
  },
  //普通卖出
  on_sell_button_click: function on_sell_button_click() {
    this.sound_control.play_sound_effect("button_click");
    var sum = 0;

    for (var i = 0; i < this.icon_group_node.children.length; i++) {
      var count = user_data.user_data.wareHouse[i].count;
      var id_product = user_data.user_data.wareHouse[i].id_product; // lấy id của cây trong mỗi kho

      if (id_product > 7) continue;
      var sell = config.plant[id_product].sell;
      sum += count * sell;
    }

    ;

    if (sum == 0) {
      this.game_scene_js.create_tips_ui(this.game_rules_js.node, "no_sell");
    } else {
      for (var j = 0; j < this.icon_group_node.children.length; j++) {
        user_data.user_data.wareHouse[j].count = 0;
      }

      ;
      this.game_scene_js.create_tips_ui(this.game_rules_js.node, "gold", sum);
      this.game_rules_js.add_gold(sum);
      this.set_sell();
    }

    ;
  },
  //double_sell_button_click
  on_double_sell_button_click: function on_double_sell_button_click() {
    var _this = this;

    this.sound_control.play_sound_effect("button_click");
    this.adsManager_js.showRewardedVideo(function () {
      var sum = 0;

      for (var i = 0; i < _this.icon_group_node.children.length; i++) {
        var count = user_data.user_data.wareHouse[i].count;
        var id_product = user_data.user_data.wareHouse[i].id_product; // lấy id của cây trong mỗi kho

        if (id_product > 7) continue;
        var sell = config.plant[id_product].sell;
        sum += count * sell;
      }

      ;

      if (sum == 0) {
        _this.game_scene_js.create_tips_ui(_this.game_rules_js.node, "no_sell");
      } else {
        for (var j = 0; j < _this.icon_group_node.children.length; j++) {
          user_data.user_data.wareHouse[j].count = 0;
        }

        ;

        _this.game_scene_js.create_tips_ui(_this.game_rules_js.node, "gold", sum);

        _this.game_rules_js.add_gold(sum);

        _this.set_sell();
      }

      ;
    });
  },
  //检测视频是否播放成功
  video_succes: function video_succes() {
    if (typeof wx != "undefined") {
      var callback = function callback() {
        if (this.ad_control.video_state == 1 && this.ad_control.video_tag == "double_sell") {
          this.ad_control.video_tag = null;
          this.ad_control.video_state = 2;
          var sum = 0;

          for (var i = 0; i < this.icon_group_node.children.length; i++) {
            var count = user_data.user_data.wareHouse[i].count;
            var sell = config.plant[i].sell;
            sum += count * sell;
          }

          ;

          for (var j = 0; j < this.icon_group_node.children.length; j++) {
            user_data.user_data.wareHouse[j].count = 0;
          }

          ;
          this.game_scene_js.create_tips_ui(this.game_rules_js.node, "gold", sum * 2);
          this.game_rules_js.add_gold(sum * 2);
          this.set_sell();
          this.unschedule(callback);
        } else {
          if (this.ad_control.video_tag == null && this.ad_control.video_state == 2) {
            this.unschedule(callback);
          }

          ;
        }

        ;
      };

      this.schedule(callback, 0.2);
    }

    ;
  },
  onLoad: function onLoad() {},
  start: function start() {} // update (dt) {},

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0XFx1aVxcc2VsbF91aS5qcyJdLCJuYW1lcyI6WyJ1c2VyX2RhdGEiLCJyZXF1aXJlIiwiY29uZmlnIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJib3hfZnJhbWVfYXJyIiwiU3ByaXRlRnJhbWUiLCJpY29uX2dyb3VwX25vZGUiLCJOb2RlIiwibGFiZWxfZ3JvdXBfbm9kZSIsImxvY2tfZ3JvdXBfbm9kZSIsImNvbmZpcm1fYnV0dG9uX25vZGUiLCJzdW1fZ29sZCIsImluZGV4IiwiaW5pX25vZGUiLCJnYW1lX3NjZW5lX2pzIiwiZmluZCIsImdldENvbXBvbmVudCIsImdhbWVfcnVsZXNfanMiLCJhZHNNYW5hZ2VyX2pzIiwiYWRfY29udHJvbCIsInNvdW5kX2NvbnRyb2wiLCJzaG93X2Jhbm5lckFkIiwic2V0X3NlbGwiLCJidXR0b25fdW5sb2NrX2NsaWNrIiwiZSIsImN1c3RvbSIsIm5vZGUiLCJjaGlsZHJlbiIsImFjdGl2ZSIsInNob3dfY29tZmlybV9idXkiLCJOdW1iZXIiLCJpIiwid2FyZUhvdXNlIiwiaGF2ZSIsImNvc3QiLCJMYWJlbCIsInN0cmluZyIsImJ1eV9yZXBvIiwiZ29sZCIsImNyZWF0ZV90aXBzX3VpIiwiYWRkX2dvbGQiLCJ0b3VjaF9leGl0IiwiY29uc29sZSIsImxvZyIsImFsbF9jYXBhY2l0eSIsImxlbmd0aCIsImNvdW50IiwiaWRfcHJvZHVjdCIsIlNwcml0ZSIsInNwcml0ZUZyYW1lIiwicGxheV9zb3VuZF9lZmZlY3QiLCJoaWRlX2Jhbm5lckFkIiwib25fbm9kZV9raWxsIiwic2V0X2VzdGltYXRlX2xhYmVsIiwic3VtIiwic2VsbCIsInBsYW50IiwiZXN0aW1hdGVfbGFiZWwiLCJvbl9zZWxsX2J1dHRvbl9jbGljayIsImoiLCJvbl9kb3VibGVfc2VsbF9idXR0b25fY2xpY2siLCJzaG93UmV3YXJkZWRWaWRlbyIsInZpZGVvX3N1Y2NlcyIsInd4IiwiY2FsbGJhY2siLCJ2aWRlb19zdGF0ZSIsInZpZGVvX3RhZyIsInVuc2NoZWR1bGUiLCJzY2hlZHVsZSIsIm9uTG9hZCIsInN0YXJ0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLFNBQVMsR0FBR0MsT0FBTyxDQUFDLFdBQUQsQ0FBdkI7O0FBQ0EsSUFBSUMsTUFBTSxHQUFHRCxPQUFPLENBQUMsUUFBRCxDQUFwQjs7QUFDQUUsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTRCxFQUFFLENBQUNFLFNBRFA7QUFHTEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1JDLElBQUFBLGFBQWEsRUFBRSxDQUFDSixFQUFFLENBQUNLLFdBQUosQ0FEUDtBQUVSQyxJQUFBQSxlQUFlLEVBQUVOLEVBQUUsQ0FBQ08sSUFGWjtBQUdSQyxJQUFBQSxnQkFBZ0IsRUFBRVIsRUFBRSxDQUFDTyxJQUhiO0FBSVI7QUFDQUUsSUFBQUEsZUFBZSxFQUFFVCxFQUFFLENBQUNPLElBTFo7QUFNUkcsSUFBQUEsbUJBQW1CLEVBQUVWLEVBQUUsQ0FBQ08sSUFOaEI7QUFPUkksSUFBQUEsUUFBUSxFQUFFLENBUEY7QUFRUkMsSUFBQUEsS0FBSyxFQUFFO0FBUkMsR0FIUDtBQWNMO0FBQ0FDLEVBQUFBLFFBQVEsRUFBRSxvQkFBWTtBQUNsQixTQUFLQyxhQUFMLEdBQXFCZCxFQUFFLENBQUNlLElBQUgsQ0FBUSxTQUFSLEVBQW1CQyxZQUFuQixDQUFnQyxZQUFoQyxDQUFyQjtBQUNBLFNBQUtDLGFBQUwsR0FBcUJqQixFQUFFLENBQUNlLElBQUgsQ0FBUSxTQUFSLEVBQW1CQyxZQUFuQixDQUFnQyxZQUFoQyxDQUFyQjtBQUNBLFNBQUtFLGFBQUwsR0FBcUJsQixFQUFFLENBQUNlLElBQUgsQ0FBUSxTQUFSLEVBQW1CQyxZQUFuQixDQUFnQyxZQUFoQyxDQUFyQjtBQUNBLFNBQUtHLFVBQUwsR0FBa0JuQixFQUFFLENBQUNlLElBQUgsQ0FBUSxZQUFSLEVBQXNCQyxZQUF0QixDQUFtQyxZQUFuQyxDQUFsQjtBQUNB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Q0FBZ0I4QyxXQUFoQixJQUErQixDQUF4RSxFQUEyRTtBQUN2RSxpQkFBS0UsVUFBTCxDQUFnQkgsUUFBaEI7QUFDSDs7QUFBQTtBQUNKOztBQUFBO0FBQ0osT0F0QkQ7O0FBdUJBLFdBQUtJLFFBQUwsQ0FBY0osUUFBZCxFQUF3QixHQUF4QjtBQUNIOztBQUFBO0FBQ0osR0E5TEk7QUErTExLLEVBQUFBLE1BL0xLLG9CQStMSSxDQUVSLENBak1JO0FBbU1MQyxFQUFBQSxLQW5NSyxtQkFtTUcsQ0FFUCxDQXJNSSxDQXVNTDs7QUF2TUssQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHVzZXJfZGF0YSA9IHJlcXVpcmUoXCJ1c2VyX2RhdGFcIik7XG52YXIgY29uZmlnID0gcmVxdWlyZShcImNvbmZpZ1wiKTtcbmNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG5cbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGJveF9mcmFtZV9hcnI6IFtjYy5TcHJpdGVGcmFtZV0sXG4gICAgICAgIGljb25fZ3JvdXBfbm9kZTogY2MuTm9kZSxcbiAgICAgICAgbGFiZWxfZ3JvdXBfbm9kZTogY2MuTm9kZSxcbiAgICAgICAgLy8gZXN0aW1hdGVfbGFiZWw6IGNjLkxhYmVsLFxuICAgICAgICBsb2NrX2dyb3VwX25vZGU6IGNjLk5vZGUsXG4gICAgICAgIGNvbmZpcm1fYnV0dG9uX25vZGU6IGNjLk5vZGUsXG4gICAgICAgIHN1bV9nb2xkOiAwLFxuICAgICAgICBpbmRleDogMCxcbiAgICB9LFxuXG4gICAgLy8gTElGRS1DWUNMRSBDQUxMQkFDS1M6XG4gICAgaW5pX25vZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5nYW1lX3NjZW5lX2pzID0gY2MuZmluZChcIlVJX1JPT1RcIikuZ2V0Q29tcG9uZW50KFwiZ2FtZV9zY2VuZVwiKTtcbiAgICAgICAgdGhpcy5nYW1lX3J1bGVzX2pzID0gY2MuZmluZChcIlVJX1JPT1RcIikuZ2V0Q29tcG9uZW50KFwiZ2FtZV9ydWxlc1wiKTtcbiAgICAgICAgdGhpcy5hZHNNYW5hZ2VyX2pzID0gY2MuZmluZChcIlVJX1JPT1RcIikuZ2V0Q29tcG9uZW50KFwiQWRzTWFuYWdlclwiKTtcbiAgICAgICAgdGhpcy5hZF9jb250cm9sID0gY2MuZmluZChcImFkX2NvbnRyb2xcIikuZ2V0Q29tcG9uZW50KFwiYWRfY29udHJvbFwiKTtcbiAgICAgICAgdGhpcy5zb3VuZF9jb250cm9sID0gY2MuZmluZChcInNvdW5kX2NvbnRyb2xcIikuZ2V0Q29tcG9uZW50KFwic291bmRfY29udHJvbFwiKTtcbiAgICAgICAgdGhpcy5hZF9jb250cm9sLnNob3dfYmFubmVyQWQoKTtcbiAgICAgICAgdGhpcy5zZXRfc2VsbCgpO1xuICAgICAgICAvLyB0aGlzLnNldF9lc3RpbWF0ZV9sYWJlbCgpO1xuICAgIH0sXG4gICAgYnV0dG9uX3VubG9ja19jbGljayhlLCBjdXN0b20pIHsgICAgICAgIC8vIGJ1dHRvbiB1bmxvY2sgcmVwb1xuICAgICAgICB0aGlzLm5vZGUuY2hpbGRyZW5bMl0uYWN0aXZlID0gZmFsc2U7ICAgLy8gc2hvdyBQT1AtVVAgb3BlbiBuZXcgcmVwb1xuICAgICAgICB0aGlzLm5vZGUuY2hpbGRyZW5bM10uYWN0aXZlID0gdHJ1ZTsgICAgLy8gaGlkZGVuIHJlcG9cbiAgICAgICAgdGhpcy5zaG93X2NvbWZpcm1fYnV5KGN1c3RvbSk7XG4gICAgfSxcbiAgICBzaG93X2NvbWZpcm1fYnV5OiBmdW5jdGlvbiAoY3VzdG9tKSB7ICAgICAgIC8vIGhp4buDbiB0aOG7iyBz4buRIHRp4buBbiDEkeG7gyBtdWEgcsawxqFuZywgdGjDqm0gbsO6dCB4w6FjIG5o4bqtblxuICAgICAgICB0aGlzLnN1bV9nb2xkID0gTnVtYmVyKDApO1xuICAgICAgICAvLyB2YXIgc3VtX2RpYW1vbmQgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBjdXN0b207IGkrKykge1xuICAgICAgICAgICAgaWYgKHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLmhhdmUgPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3VtX2dvbGQgKz0gdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uY29zdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5vZGUuY2hpbGRyZW5bM10uY2hpbGRyZW5bMF0uZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBcIkRvIHlvdSB3YW50IHVzZSBcIiArIHRoaXMuc3VtX2dvbGQgKyBcIiBnb2xkIHRvIGJ1eSBuZXcgcmVwb3NpdG9yeT9cIjtcbiAgICAgICAgdGhpcy5pbmRleCA9IGN1c3RvbTtcbiAgICB9LFxuICAgIGJ1eV9yZXBvOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh1c2VyX2RhdGEudXNlcl9kYXRhLmdvbGQgPj0gdGhpcy5zdW1fZ29sZCkge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJzdW1fZ29kbCBcIiArIHN1bV9nb2xkKTtcbiAgICAgICAgICAgIC8vIHVzZXJfZGF0YS51c2VyX2RhdGEuZGlhbW9uZCAtPSB0aGlzLnN1bV9kaWFtb25kO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gdGhpcy5pbmRleDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uaGF2ZSA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2NrX2dyb3VwX25vZGUuY2hpbGRyZW5baV0uYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbF9ncm91cF9ub2RlLmNoaWxkcmVuW2ldLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gXCIwLzMwXCI7XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lX3NjZW5lX2pzLmNyZWF0ZV90aXBzX3VpKHRoaXMuZ2FtZV9zY2VuZV9qcy5ub2RlLCBcInVubG9ja2VkX3JlcG9cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmdhbWVfcnVsZXNfanMuYWRkX2dvbGQoLXRoaXMuc3VtX2dvbGQpO1xuICAgICAgICAgICAgdGhpcy50b3VjaF9leGl0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnN1bV9nb2xkICsgXCIgc3VtX2dvbGRcIik7XG4gICAgICAgICAgICB0aGlzLmdhbWVfc2NlbmVfanMuY3JlYXRlX3RpcHNfdWkodGhpcy5nYW1lX3NjZW5lX2pzLm5vZGUsIFwibm9fbW9uZXlfZ29sZFwiKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgLy8gYXV0b19zZWxsOiBmdW5jdGlvbiAoKSB7ICAgIC8vIHThu7EgxJHhu5luZyBiw6FuIGjDoG5nIHRyb25nIGtobyAvLyBjaMawYSB4b25nXG4gICAgLy8gICAgIHZhciB0aW1lX2F1dG8gPSA2MCAqIDYwO1xuXG4gICAgLy8gICAgIHZhciBhdXRvID0gZnVuY3Rpb24gKCkge1xuICAgIC8vICAgICAgICAgdGltZV9hdXRvIC09MC4xO1xuICAgIC8vICAgICB9O1xuICAgIC8vICAgICB0aGlzLnNjaGVkdWxlKHRoaXMuYXV0bywgMC4xKTtcbiAgICAvLyB9LFxuXG4gICAgc2V0X3NlbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFsbF9jYXBhY2l0eSA9IDMwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaWNvbl9ncm91cF9ub2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uaGF2ZSA9PSAxKSB7XG4gICAgICAgICAgICAgICAgbGV0IGNvdW50ID0gdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uY291bnQ7XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbF9ncm91cF9ub2RlLmNoaWxkcmVuW2ldLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gY291bnQgKyBcIi9cIiArIGFsbF9jYXBhY2l0eTtcbiAgICAgICAgICAgICAgICB0aGlzLmxvY2tfZ3JvdXBfbm9kZS5jaGlsZHJlbltpXS5hY3RpdmUgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIGlmIChjb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkX3Byb2R1Y3QgPSB1c2VyX2RhdGEudXNlcl9kYXRhLndhcmVIb3VzZVtpXS5pZF9wcm9kdWN0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbltpXS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHRoaXMuYm94X2ZyYW1lX2FycltpZF9wcm9kdWN0XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaWNvbl9ncm91cF9ub2RlLmNoaWxkcmVuW2ldLmdldENvbXBvbmVudChjYy5TcHJpdGUpLnNwcml0ZUZyYW1lID0gdGhpcy5ib3hfZnJhbWVfYXJyWzhdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubGFiZWxfZ3JvdXBfbm9kZS5jaGlsZHJlbltpXS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9ICcnO1xuICAgICAgICAgICAgICAgIHRoaXMubG9ja19ncm91cF9ub2RlLmNoaWxkcmVuW2ldLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5pY29uX2dyb3VwX25vZGUuY2hpbGRyZW5baV0uZ2V0Q29tcG9uZW50KGNjLlNwcml0ZSkuU3ByaXRlRnJhbWUgPSB0aGlzLmJveF9mcmFtZV9hcnJbOF07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuICAgIH0sXG4gICAgdG91Y2hfZXhpdDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5ub2RlLmNoaWxkcmVuWzJdLmFjdGl2ZSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy5ub2RlLmNoaWxkcmVuWzJdLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLm5vZGUuY2hpbGRyZW5bM10uYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNvdW5kX2NvbnRyb2wucGxheV9zb3VuZF9lZmZlY3QoXCJidXR0b25fZXhpdFwiKTtcbiAgICAgICAgICAgIHRoaXMuYWRfY29udHJvbC5oaWRlX2Jhbm5lckFkKCk7XG4gICAgICAgICAgICB0aGlzLmdhbWVfc2NlbmVfanMub25fbm9kZV9raWxsKHRoaXMubm9kZSk7XG4gICAgICAgIH1cblxuICAgIH0sXG4gICAgLy/orr7nva7pooTorqHljZblh7rmloflrZdcbiAgICBzZXRfZXN0aW1hdGVfbGFiZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHN1bSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5pY29uX2dyb3VwX25vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBjb3VudCA9IHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLmNvdW50O1xuICAgICAgICAgICAgdmFyIHNlbGwgPSBjb25maWcucGxhbnRbaV0uc2VsbDtcbiAgICAgICAgICAgIHN1bSArPSBjb3VudCAqIHNlbGw7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZXN0aW1hdGVfbGFiZWwuc3RyaW5nID0gXCJFeHBlY3RlZCB0byBzZWxsOiBcIiArIHN1bTtcbiAgICB9LFxuICAgIC8v5pmu6YCa5Y2W5Ye6XG4gICAgb25fc2VsbF9idXR0b25fY2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zb3VuZF9jb250cm9sLnBsYXlfc291bmRfZWZmZWN0KFwiYnV0dG9uX2NsaWNrXCIpO1xuICAgICAgICB2YXIgc3VtID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGNvdW50ID0gdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uY291bnQ7XG4gICAgICAgICAgICB2YXIgaWRfcHJvZHVjdCA9IHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLmlkX3Byb2R1Y3Q7Ly8gbOG6pXkgaWQgY+G7p2EgY8OieSB0cm9uZyBt4buXaSBraG9cbiAgICAgICAgICAgIGlmIChpZF9wcm9kdWN0ID4gNykgY29udGludWU7XG4gICAgICAgICAgICB2YXIgc2VsbCA9IGNvbmZpZy5wbGFudFtpZF9wcm9kdWN0XS5zZWxsO1xuICAgICAgICAgICAgc3VtICs9IGNvdW50ICogc2VsbDtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHN1bSA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmdhbWVfc2NlbmVfanMuY3JlYXRlX3RpcHNfdWkodGhpcy5nYW1lX3J1bGVzX2pzLm5vZGUsIFwibm9fc2VsbFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5pY29uX2dyb3VwX25vZGUuY2hpbGRyZW4ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB1c2VyX2RhdGEudXNlcl9kYXRhLndhcmVIb3VzZVtqXS5jb3VudCA9IDA7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5nYW1lX3NjZW5lX2pzLmNyZWF0ZV90aXBzX3VpKHRoaXMuZ2FtZV9ydWxlc19qcy5ub2RlLCBcImdvbGRcIiwgc3VtKTtcbiAgICAgICAgICAgIHRoaXMuZ2FtZV9ydWxlc19qcy5hZGRfZ29sZChzdW0pO1xuICAgICAgICAgICAgdGhpcy5zZXRfc2VsbCgpO1xuICAgICAgICB9O1xuICAgIH0sXG4gICAgXG4gICAgLy9kb3VibGVfc2VsbF9idXR0b25fY2xpY2tcbiAgICBvbl9kb3VibGVfc2VsbF9idXR0b25fY2xpY2soKSB7XG4gICAgICAgIHRoaXMuc291bmRfY29udHJvbC5wbGF5X3NvdW5kX2VmZmVjdChcImJ1dHRvbl9jbGlja1wiKTtcbiAgICAgICAgdGhpcy5hZHNNYW5hZ2VyX2pzLnNob3dSZXdhcmRlZFZpZGVvKCgpID0+IHtcbiAgICAgICAgICAgIHZhciBzdW0gPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBjb3VudCA9IHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLmNvdW50O1xuICAgICAgICAgICAgICAgIHZhciBpZF9wcm9kdWN0ID0gdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uaWRfcHJvZHVjdDsvLyBs4bqleSBpZCBj4bunYSBjw6J5IHRyb25nIG3hu5dpIGtob1xuICAgICAgICAgICAgICAgIGlmIChpZF9wcm9kdWN0ID4gNykgY29udGludWU7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGwgPSBjb25maWcucGxhbnRbaWRfcHJvZHVjdF0uc2VsbDtcbiAgICAgICAgICAgICAgICBzdW0gKz0gY291bnQgKiBzZWxsO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChzdW0gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZV9zY2VuZV9qcy5jcmVhdGVfdGlwc191aSh0aGlzLmdhbWVfcnVsZXNfanMubm9kZSwgXCJub19zZWxsXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuaWNvbl9ncm91cF9ub2RlLmNoaWxkcmVuLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2pdLmNvdW50ID0gMDtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZV9zY2VuZV9qcy5jcmVhdGVfdGlwc191aSh0aGlzLmdhbWVfcnVsZXNfanMubm9kZSwgXCJnb2xkXCIsIHN1bSk7XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lX3J1bGVzX2pzLmFkZF9nb2xkKHN1bSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfc2VsbCgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v5qOA5rWL6KeG6aKR5piv5ZCm5pKt5pS+5oiQ5YqfXG4gICAgdmlkZW9fc3VjY2VzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0eXBlb2YgKHd4KSAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRfY29udHJvbC52aWRlb19zdGF0ZSA9PSAxICYmIHRoaXMuYWRfY29udHJvbC52aWRlb190YWcgPT0gXCJkb3VibGVfc2VsbFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRfY29udHJvbC52aWRlb190YWcgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkX2NvbnRyb2wudmlkZW9fc3RhdGUgPSAyO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3VtID0gMDtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uY291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VsbCA9IGNvbmZpZy5wbGFudFtpXS5zZWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VtICs9IGNvdW50ICogc2VsbDtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2Vbal0uY291bnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWVfc2NlbmVfanMuY3JlYXRlX3RpcHNfdWkodGhpcy5nYW1lX3J1bGVzX2pzLm5vZGUsIFwiZ29sZFwiLCBzdW0gKiAyKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lX3J1bGVzX2pzLmFkZF9nb2xkKHN1bSAqIDIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldF9zZWxsKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5zY2hlZHVsZShjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRfY29udHJvbC52aWRlb190YWcgPT0gbnVsbCAmJiB0aGlzLmFkX2NvbnRyb2wudmlkZW9fc3RhdGUgPT0gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNjaGVkdWxlKGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuc2NoZWR1bGUoY2FsbGJhY2ssIDAuMik7XG4gICAgICAgIH07XG4gICAgfSxcbiAgICBvbkxvYWQoKSB7XG5cbiAgICB9LFxuXG4gICAgc3RhcnQoKSB7XG5cbiAgICB9LFxuXG4gICAgLy8gdXBkYXRlIChkdCkge30sXG59KTtcbiJdfQ==