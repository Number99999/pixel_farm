
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/script/ui/sell_ui.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'b3408LFwupOPKoN9Pojb+Zi', 'sell_ui');
// script/ui/sell_ui.js

"use strict";

var user_data = require("user_data");

var config = require("config");

cc.Class({
  "extends": cc.Component,
  properties: {
    box_frame_arr: [cc.SpriteFrame],
    icon_group_node: cc.Node,
    label_group_node: cc.Node,
    // estimate_label: cc.Label,
    lock_group_node: cc.Node,
    confirm_button_node: cc.Node,
    sum_gold: 0,
    sum_diamond: 0,
    index: 0
  },
  // LIFE-CYCLE CALLBACKS:
  ini_node: function ini_node() {
    this.game_scene_js = cc.find("UI_ROOT").getComponent("game_scene");
    this.game_rules_js = cc.find("UI_ROOT").getComponent("game_rules");
    this.adsManager_js = cc.find("UI_ROOT").getComponent("AdsManager");
    this.ad_control = cc.find("ad_control").getComponent("ad_control");
    this.sound_control = cc.find("sound_control").getComponent("sound_control");
    this.set_sell(); // this.set_estimate_label();
  },
  button_unlock_click: function button_unlock_click(e, custom) {
    // button unlock repo
    // if (custom <= 7) {
    this.node.children[2].active = false; // show POP-UP open new repo

    this.node.children[3].active = true; // hidden repo

    this.show_comfirm_buy(custom); // }
    // else
    //     this.game_scene_js.create_tips_ui(this.game_scene_js.node, "cant_unlock_repo");
  },
  show_comfirm_buy: function show_comfirm_buy(custom) {
    // hiển thị số tiền để mua rương, thêm nút xác nhận
    this.sum_gold = Number(0);
    this.sum_diamond = Number(0); // var sum_diamond = 0;

    for (var i = 0; i <= custom; i++) {
      if (user_data.user_data.wareHouse[i].have == 0) {
        if (user_data.user_data.wareHouse[i].type_buy == "gold") this.sum_gold += user_data.user_data.wareHouse[i].cost;else this.sum_diamond += user_data.user_data.wareHouse[i].cost; // cc.log("43 index " + i + " cost " + user_data.user_data.wareHouse[i].cost);
      }
    }

    this.node.children[3].children[0].getComponent(cc.Label).string = "Do you want use " + this.sum_gold + " gold and " + this.sum_diamond + " diamond to buy new repository?";
    this.index = custom;
  },
  buy_repo: function buy_repo() {
    if (user_data.user_data.gold >= this.sum_gold && user_data.user_data.diamond >= this.sum_diamond) {
      // console.log("sum_godl " + sum_gold);
      // user_data.user_data.diamond -= this.sum_diamond;
      for (var i = 0; i <= this.index; i++) {
        user_data.user_data.wareHouse[i].have = 1;
        this.lock_group_node.children[i].active = false;
        this.label_group_node.children[i].getComponent(cc.Label).string = user_data.user_data.wareHouse[i].count + "/30";
        this.game_scene_js.create_tips_ui(this.game_scene_js.node, "unlocked_repo");
      }

      this.game_rules_js.add_gold(-this.sum_gold);
      this.game_rules_js.add_diamond(-this.sum_diamond);
      this.touch_exit();
    } else if (user_data.user_data.gold < this.gold) {
      this.game_scene_js.create_tips_ui(this.game_scene_js.node, "no_money_gold");
    } else if (user_data.user_data.diamond, this.diamond) this.game_scene_js.create_tips_ui(this.game_scene_js.node, "no_money_diamond");else this.game_scene_js.create_tips_ui(this.game_scene_js.node, "no_money");
  },
  // auto_sell: function () {    // tự động bán hàng trong kho // chưa xong
  //     var time_auto = 60 * 60;
  //     var auto = function () {
  //         time_auto -=0.1;
  //     };
  //     this.schedule(this.auto, 0.1);
  // },
  set_sell: function set_sell() {
    var all_capacity = 30;

    for (var i = 0; i < this.icon_group_node.children.length; i++) {
      if (user_data.user_data.wareHouse[i].have == 1) {
        var count = user_data.user_data.wareHouse[i].count;
        this.label_group_node.children[i].getComponent(cc.Label).string = count + "/" + all_capacity;
        this.lock_group_node.children[i].active = false;

        if (count > 0) {
          var id_product = user_data.user_data.wareHouse[i].id_product;
          this.icon_group_node.children[i].getComponent(cc.Sprite).spriteFrame = this.box_frame_arr[id_product];
        } else {
          this.icon_group_node.children[i].getComponent(cc.Sprite).spriteFrame = this.box_frame_arr[8];
        }
      } else {
        this.label_group_node.children[i].getComponent(cc.Label).string = '';
        this.lock_group_node.children[i].active = true;
        this.icon_group_node.children[i].getComponent(cc.Sprite).SpriteFrame = this.box_frame_arr[8];
      }
    }
  },
  touch_exit: function touch_exit() {
    if (this.node.children[2].active == false) {
      this.node.children[2].active = true;
      this.node.children[3].active = false;
    } else {
      this.sound_control.play_sound_effect("button_exit");
      this.game_scene_js.on_node_kill(this.node);
    }
  },
  //设置预计卖出文字
  set_estimate_label: function set_estimate_label() {
    var sum = 0;

    for (var i = 0; i < this.icon_group_node.children.length; i++) {
      var count = user_data.user_data.wareHouse[i].count;
      var sell = config.plant[i].sell;
      sum += count * sell;
    }

    ;
    this.estimate_label.string = "Expected to sell: " + sum;
  },
  //普通卖出
  on_sell_button_click: function on_sell_button_click() {
    this.sound_control.play_sound_effect("button_click");
    var sum = 0;

    for (var i = 0; i < this.icon_group_node.children.length; i++) {
      var count = user_data.user_data.wareHouse[i].count;
      var id_product = user_data.user_data.wareHouse[i].id_product; // lấy id của cây trong mỗi kho

      if (id_product > 7) continue;
      var sell = config.plant[id_product].sell;
      sum += count * sell;
    }

    ;

    if (sum == 0) {
      this.game_scene_js.create_tips_ui(this.game_rules_js.node, "no_sell");
    } else {
      for (var j = 0; j < this.icon_group_node.children.length; j++) {
        user_data.user_data.wareHouse[j].count = 0;
      }

      ;
      this.game_scene_js.create_tips_ui(this.game_rules_js.node, "gold", sum);
      this.game_rules_js.add_gold(sum);
      this.set_sell();
    }

    ;
  },
  //double_sell_button_click
  on_double_sell_button_click: function on_double_sell_button_click() {
    var _this = this;

    this.sound_control.play_sound_effect("button_click");
    this.adsManager_js.showRewardedVideo(function () {
      var sum = 0;

      for (var i = 0; i < _this.icon_group_node.children.length; i++) {
        var count = user_data.user_data.wareHouse[i].count;
        var id_product = user_data.user_data.wareHouse[i].id_product; // lấy id của cây trong mỗi kho

        if (id_product > 7) continue;
        var sell = config.plant[id_product].sell;
        sum += count * sell;
      }

      ;

      if (sum == 0) {
        _this.game_scene_js.create_tips_ui(_this.game_rules_js.node, "no_sell");
      } else {
        for (var j = 0; j < _this.icon_group_node.children.length; j++) {
          user_data.user_data.wareHouse[j].count = 0;
        }

        ;

        _this.game_scene_js.create_tips_ui(_this.game_rules_js.node, "gold", sum);

        _this.game_rules_js.add_gold(sum * 2);

        _this.set_sell();
      }

      ;
    });
  },
  //检测视频是否播放成功
  video_succes: function video_succes() {
    if (typeof wx != "undefined") {
      var callback = function callback() {
        if (this.ad_control.video_state == 1 && this.ad_control.video_tag == "double_sell") {
          this.ad_control.video_tag = null;
          this.ad_control.video_state = 2;
          var sum = 0;

          for (var i = 0; i < this.icon_group_node.children.length; i++) {
            var count = user_data.user_data.wareHouse[i].count;
            var sell = config.plant[i].sell;
            sum += count * sell;
          }

          ;

          for (var j = 0; j < this.icon_group_node.children.length; j++) {
            user_data.user_data.wareHouse[j].count = 0;
          }

          ;
          this.game_scene_js.create_tips_ui(this.game_rules_js.node, "gold", sum * 2);
          this.game_rules_js.add_gold(sum * 2);
          this.set_sell();
          this.unschedule(callback);
        } else {
          if (this.ad_control.video_tag == null && this.ad_control.video_state == 2) {
            this.unschedule(callback);
          }

          ;
        }

        ;
      };

      this.schedule(callback, 0.2);
    }

    ;
  },
  onLoad: function onLoad() {},
  start: function start() {} // update (dt) {},

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0XFx1aVxcc2VsbF91aS5qcyJdLCJuYW1lcyI6WyJ1c2VyX2RhdGEiLCJyZXF1aXJlIiwiY29uZmlnIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJib3hfZnJhbWVfYXJyIiwiU3ByaXRlRnJhbWUiLCJpY29uX2dyb3VwX25vZGUiLCJOb2RlIiwibGFiZWxfZ3JvdXBfbm9kZSIsImxvY2tfZ3JvdXBfbm9kZSIsImNvbmZpcm1fYnV0dG9uX25vZGUiLCJzdW1fZ29sZCIsInN1bV9kaWFtb25kIiwiaW5kZXgiLCJpbmlfbm9kZSIsImdhbWVfc2NlbmVfanMiLCJmaW5kIiwiZ2V0Q29tcG9uZW50IiwiZ2FtZV9ydWxlc19qcyIsImFkc01hbmFnZXJfanMiLCJhZF9jb250cm9sIiwic291bmRfY29udHJvbCIsInNldF9zZWxsIiwiYnV0dG9uX3VubG9ja19jbGljayIsImUiLCJjdXN0b20iLCJub2RlIiwiY2hpbGRyZW4iLCJhY3RpdmUiLCJzaG93X2NvbWZpcm1fYnV5IiwiTnVtYmVyIiwiaSIsIndhcmVIb3VzZSIsImhhdmUiLCJ0eXBlX2J1eSIsImNvc3QiLCJMYWJlbCIsInN0cmluZyIsImJ1eV9yZXBvIiwiZ29sZCIsImRpYW1vbmQiLCJjb3VudCIsImNyZWF0ZV90aXBzX3VpIiwiYWRkX2dvbGQiLCJhZGRfZGlhbW9uZCIsInRvdWNoX2V4aXQiLCJhbGxfY2FwYWNpdHkiLCJsZW5ndGgiLCJpZF9wcm9kdWN0IiwiU3ByaXRlIiwic3ByaXRlRnJhbWUiLCJwbGF5X3NvdW5kX2VmZmVjdCIsIm9uX25vZGVfa2lsbCIsInNldF9lc3RpbWF0ZV9sYWJlbCIsInN1bSIsInNlbGwiLCJwbGFudCIsImVzdGltYXRlX2xhYmVsIiwib25fc2VsbF9idXR0b25fY2xpY2siLCJqIiwib25fZG91YmxlX3NlbGxfYnV0dG9uX2NsaWNrIiwic2hvd1Jld2FyZGVkVmlkZW8iLCJ2aWRlb19zdWNjZXMiLCJ3eCIsImNhbGxiYWNrIiwidmlkZW9fc3RhdGUiLCJ2aWRlb190YWciLCJ1bnNjaGVkdWxlIiwic2NoZWR1bGUiLCJvbkxvYWQiLCJzdGFydCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxTQUFTLEdBQUdDLE9BQU8sQ0FBQyxXQUFELENBQXZCOztBQUNBLElBQUlDLE1BQU0sR0FBR0QsT0FBTyxDQUFDLFFBQUQsQ0FBcEI7O0FBQ0FFLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxhQUFhLEVBQUUsQ0FBQ0osRUFBRSxDQUFDSyxXQUFKLENBRFA7QUFFUkMsSUFBQUEsZUFBZSxFQUFFTixFQUFFLENBQUNPLElBRlo7QUFHUkMsSUFBQUEsZ0JBQWdCLEVBQUVSLEVBQUUsQ0FBQ08sSUFIYjtBQUlSO0FBQ0FFLElBQUFBLGVBQWUsRUFBRVQsRUFBRSxDQUFDTyxJQUxaO0FBTVJHLElBQUFBLG1CQUFtQixFQUFFVixFQUFFLENBQUNPLElBTmhCO0FBT1JJLElBQUFBLFFBQVEsRUFBRSxDQVBGO0FBUVJDLElBQUFBLFdBQVcsRUFBRSxDQVJMO0FBU1JDLElBQUFBLEtBQUssRUFBRTtBQVRDLEdBSFA7QUFlTDtBQUNBQyxFQUFBQSxRQUFRLEVBQUUsb0JBQVk7QUFDbEIsU0FBS0MsYUFBTCxHQUFxQmYsRUFBRSxDQUFDZ0IsSUFBSCxDQUFRLFNBQVIsRUFBbUJDLFlBQW5CLENBQWdDLFlBQWhDLENBQXJCO0FBQ0EsU0FBS0MsYUFBTCxHQUFxQmxCLEVBQUUsQ0FBQ2dCLElBQUgsQ0FBUSxTQUFSLEVBQW1CQyxZQUFuQixDQUFnQyxZQUFoQyxDQUFyQjtBQUNBLFNBQUtFLGFBQUwsR0FBcUJuQixFQUFFLENBQUNnQixJQUFILENBQVEsU0FBUixFQUFtQkMsWUFBbkIsQ0FBZ0MsWUFBaEMsQ0FBckI7QUFDQSxTQUFLRyxVQUFMLEdBQWtCcEIsRUFBRSxDQUFDZ0IsSUFBSCxDQUFRLFlBQVIsRUFB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SSxDQWlOTDs7QUFqTkssQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHVzZXJfZGF0YSA9IHJlcXVpcmUoXCJ1c2VyX2RhdGFcIik7XHJcbnZhciBjb25maWcgPSByZXF1aXJlKFwiY29uZmlnXCIpO1xyXG5jYy5DbGFzcyh7XHJcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcblxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGJveF9mcmFtZV9hcnI6IFtjYy5TcHJpdGVGcmFtZV0sXHJcbiAgICAgICAgaWNvbl9ncm91cF9ub2RlOiBjYy5Ob2RlLFxyXG4gICAgICAgIGxhYmVsX2dyb3VwX25vZGU6IGNjLk5vZGUsXHJcbiAgICAgICAgLy8gZXN0aW1hdGVfbGFiZWw6IGNjLkxhYmVsLFxyXG4gICAgICAgIGxvY2tfZ3JvdXBfbm9kZTogY2MuTm9kZSxcclxuICAgICAgICBjb25maXJtX2J1dHRvbl9ub2RlOiBjYy5Ob2RlLFxyXG4gICAgICAgIHN1bV9nb2xkOiAwLFxyXG4gICAgICAgIHN1bV9kaWFtb25kOiAwLFxyXG4gICAgICAgIGluZGV4OiAwLFxyXG4gICAgfSxcclxuXHJcbiAgICAvLyBMSUZFLUNZQ0xFIENBTExCQUNLUzpcclxuICAgIGluaV9ub2RlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5nYW1lX3NjZW5lX2pzID0gY2MuZmluZChcIlVJX1JPT1RcIikuZ2V0Q29tcG9uZW50KFwiZ2FtZV9zY2VuZVwiKTtcclxuICAgICAgICB0aGlzLmdhbWVfcnVsZXNfanMgPSBjYy5maW5kKFwiVUlfUk9PVFwiKS5nZXRDb21wb25lbnQoXCJnYW1lX3J1bGVzXCIpO1xyXG4gICAgICAgIHRoaXMuYWRzTWFuYWdlcl9qcyA9IGNjLmZpbmQoXCJVSV9ST09UXCIpLmdldENvbXBvbmVudChcIkFkc01hbmFnZXJcIik7XHJcbiAgICAgICAgdGhpcy5hZF9jb250cm9sID0gY2MuZmluZChcImFkX2NvbnRyb2xcIikuZ2V0Q29tcG9uZW50KFwiYWRfY29udHJvbFwiKTtcclxuICAgICAgICB0aGlzLnNvdW5kX2NvbnRyb2wgPSBjYy5maW5kKFwic291bmRfY29udHJvbFwiKS5nZXRDb21wb25lbnQoXCJzb3VuZF9jb250cm9sXCIpO1xyXG4gICAgICAgIHRoaXMuc2V0X3NlbGwoKTtcclxuICAgICAgICAvLyB0aGlzLnNldF9lc3RpbWF0ZV9sYWJlbCgpO1xyXG4gICAgfSxcclxuICAgIGJ1dHRvbl91bmxvY2tfY2xpY2soZSwgY3VzdG9tKSB7ICAgICAgICAvLyBidXR0b24gdW5sb2NrIHJlcG9cclxuICAgICAgICAvLyBpZiAoY3VzdG9tIDw9IDcpIHtcclxuICAgICAgICB0aGlzLm5vZGUuY2hpbGRyZW5bMl0uYWN0aXZlID0gZmFsc2U7ICAgLy8gc2hvdyBQT1AtVVAgb3BlbiBuZXcgcmVwb1xyXG4gICAgICAgIHRoaXMubm9kZS5jaGlsZHJlblszXS5hY3RpdmUgPSB0cnVlOyAgICAvLyBoaWRkZW4gcmVwb1xyXG4gICAgICAgIHRoaXMuc2hvd19jb21maXJtX2J1eShjdXN0b20pO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyBlbHNlXHJcbiAgICAgICAgLy8gICAgIHRoaXMuZ2FtZV9zY2VuZV9qcy5jcmVhdGVfdGlwc191aSh0aGlzLmdhbWVfc2NlbmVfanMubm9kZSwgXCJjYW50X3VubG9ja19yZXBvXCIpO1xyXG4gICAgfSxcclxuICAgIHNob3dfY29tZmlybV9idXk6IGZ1bmN0aW9uIChjdXN0b20pIHsgICAgICAgLy8gaGnhu4NuIHRo4buLIHPhu5EgdGnhu4FuIMSR4buDIG11YSByxrDGoW5nLCB0aMOqbSBuw7p0IHjDoWMgbmjhuq1uXHJcbiAgICAgICAgdGhpcy5zdW1fZ29sZCA9IE51bWJlcigwKTtcclxuICAgICAgICB0aGlzLnN1bV9kaWFtb25kID0gTnVtYmVyKDApO1xyXG4gICAgICAgIC8vIHZhciBzdW1fZGlhbW9uZCA9IDA7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gY3VzdG9tOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLmhhdmUgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLnR5cGVfYnV5ID09IFwiZ29sZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3VtX2dvbGQgKz0gdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uY29zdDtcclxuICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5zdW1fZGlhbW9uZCArPSB1c2VyX2RhdGEudXNlcl9kYXRhLndhcmVIb3VzZVtpXS5jb3N0O1xyXG4gICAgICAgICAgICAgICAgLy8gY2MubG9nKFwiNDMgaW5kZXggXCIgKyBpICsgXCIgY29zdCBcIiArIHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLmNvc3QpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubm9kZS5jaGlsZHJlblszXS5jaGlsZHJlblswXS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IFwiRG8geW91IHdhbnQgdXNlIFwiICsgdGhpcy5zdW1fZ29sZCArIFwiIGdvbGQgYW5kIFwiICsgdGhpcy5zdW1fZGlhbW9uZCArIFwiIGRpYW1vbmQgdG8gYnV5IG5ldyByZXBvc2l0b3J5P1wiO1xyXG4gICAgICAgIHRoaXMuaW5kZXggPSBjdXN0b207XHJcbiAgICB9LFxyXG4gICAgYnV5X3JlcG86IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodXNlcl9kYXRhLnVzZXJfZGF0YS5nb2xkID49IHRoaXMuc3VtX2dvbGQgJiYgdXNlcl9kYXRhLnVzZXJfZGF0YS5kaWFtb25kID49IHRoaXMuc3VtX2RpYW1vbmQpIHtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJzdW1fZ29kbCBcIiArIHN1bV9nb2xkKTtcclxuICAgICAgICAgICAgLy8gdXNlcl9kYXRhLnVzZXJfZGF0YS5kaWFtb25kIC09IHRoaXMuc3VtX2RpYW1vbmQ7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IHRoaXMuaW5kZXg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uaGF2ZSA9IDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvY2tfZ3JvdXBfbm9kZS5jaGlsZHJlbltpXS5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHRoaXMubGFiZWxfZ3JvdXBfbm9kZS5jaGlsZHJlbltpXS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLmNvdW50ICsgXCIvMzBcIjtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZV9zY2VuZV9qcy5jcmVhdGVfdGlwc191aSh0aGlzLmdhbWVfc2NlbmVfanMubm9kZSwgXCJ1bmxvY2tlZF9yZXBvXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZ2FtZV9ydWxlc19qcy5hZGRfZ29sZCgtdGhpcy5zdW1fZ29sZCk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2FtZV9ydWxlc19qcy5hZGRfZGlhbW9uZCgtdGhpcy5zdW1fZGlhbW9uZCk7XHJcbiAgICAgICAgICAgIHRoaXMudG91Y2hfZXhpdCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh1c2VyX2RhdGEudXNlcl9kYXRhLmdvbGQgPCB0aGlzLmdvbGQpIHtcclxuICAgICAgICAgICAgdGhpcy5nYW1lX3NjZW5lX2pzLmNyZWF0ZV90aXBzX3VpKHRoaXMuZ2FtZV9zY2VuZV9qcy5ub2RlLCBcIm5vX21vbmV5X2dvbGRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHVzZXJfZGF0YS51c2VyX2RhdGEuZGlhbW9uZCwgdGhpcy5kaWFtb25kKVxyXG4gICAgICAgICAgICB0aGlzLmdhbWVfc2NlbmVfanMuY3JlYXRlX3RpcHNfdWkodGhpcy5nYW1lX3NjZW5lX2pzLm5vZGUsIFwibm9fbW9uZXlfZGlhbW9uZFwiKTtcclxuICAgICAgICBlbHNlIHRoaXMuZ2FtZV9zY2VuZV9qcy5jcmVhdGVfdGlwc191aSh0aGlzLmdhbWVfc2NlbmVfanMubm9kZSwgXCJub19tb25leVwiKTtcclxuICAgIH0sXHJcbiAgICAvLyBhdXRvX3NlbGw6IGZ1bmN0aW9uICgpIHsgICAgLy8gdOG7sSDEkeG7mW5nIGLDoW4gaMOgbmcgdHJvbmcga2hvIC8vIGNoxrBhIHhvbmdcclxuICAgIC8vICAgICB2YXIgdGltZV9hdXRvID0gNjAgKiA2MDtcclxuXHJcbiAgICAvLyAgICAgdmFyIGF1dG8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAvLyAgICAgICAgIHRpbWVfYXV0byAtPTAuMTtcclxuICAgIC8vICAgICB9O1xyXG4gICAgLy8gICAgIHRoaXMuc2NoZWR1bGUodGhpcy5hdXRvLCAwLjEpO1xyXG4gICAgLy8gfSxcclxuXHJcbiAgICBzZXRfc2VsbDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBhbGxfY2FwYWNpdHkgPSAzMDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaWNvbl9ncm91cF9ub2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICh1c2VyX2RhdGEudXNlcl9kYXRhLndhcmVIb3VzZVtpXS5oYXZlID09IDEpIHtcclxuICAgICAgICAgICAgICAgIGxldCBjb3VudCA9IHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLmNvdW50O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbF9ncm91cF9ub2RlLmNoaWxkcmVuW2ldLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gY291bnQgKyBcIi9cIiArIGFsbF9jYXBhY2l0eTtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9ja19ncm91cF9ub2RlLmNoaWxkcmVuW2ldLmFjdGl2ZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjb3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRfcHJvZHVjdCA9IHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLmlkX3Byb2R1Y3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pY29uX2dyb3VwX25vZGUuY2hpbGRyZW5baV0uZ2V0Q29tcG9uZW50KGNjLlNwcml0ZSkuc3ByaXRlRnJhbWUgPSB0aGlzLmJveF9mcmFtZV9hcnJbaWRfcHJvZHVjdF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbltpXS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHRoaXMuYm94X2ZyYW1lX2Fycls4XTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGFiZWxfZ3JvdXBfbm9kZS5jaGlsZHJlbltpXS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9ICcnO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2NrX2dyb3VwX25vZGUuY2hpbGRyZW5baV0uYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaWNvbl9ncm91cF9ub2RlLmNoaWxkcmVuW2ldLmdldENvbXBvbmVudChjYy5TcHJpdGUpLlNwcml0ZUZyYW1lID0gdGhpcy5ib3hfZnJhbWVfYXJyWzhdO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICB0b3VjaF9leGl0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubm9kZS5jaGlsZHJlblsyXS5hY3RpdmUgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgdGhpcy5ub2RlLmNoaWxkcmVuWzJdLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5jaGlsZHJlblszXS5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc291bmRfY29udHJvbC5wbGF5X3NvdW5kX2VmZmVjdChcImJ1dHRvbl9leGl0XCIpO1xyXG4gICAgICAgICAgICB0aGlzLmdhbWVfc2NlbmVfanMub25fbm9kZV9raWxsKHRoaXMubm9kZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0sXHJcbiAgICAvL+iuvue9rumihOiuoeWNluWHuuaWh+Wtl1xyXG4gICAgc2V0X2VzdGltYXRlX2xhYmVsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHN1bSA9IDA7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgY291bnQgPSB1c2VyX2RhdGEudXNlcl9kYXRhLndhcmVIb3VzZVtpXS5jb3VudDtcclxuICAgICAgICAgICAgdmFyIHNlbGwgPSBjb25maWcucGxhbnRbaV0uc2VsbDtcclxuICAgICAgICAgICAgc3VtICs9IGNvdW50ICogc2VsbDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZXN0aW1hdGVfbGFiZWwuc3RyaW5nID0gXCJFeHBlY3RlZCB0byBzZWxsOiBcIiArIHN1bTtcclxuICAgIH0sXHJcbiAgICAvL+aZrumAmuWNluWHulxyXG4gICAgb25fc2VsbF9idXR0b25fY2xpY2s6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLnNvdW5kX2NvbnRyb2wucGxheV9zb3VuZF9lZmZlY3QoXCJidXR0b25fY2xpY2tcIik7XHJcbiAgICAgICAgdmFyIHN1bSA9IDA7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgY291bnQgPSB1c2VyX2RhdGEudXNlcl9kYXRhLndhcmVIb3VzZVtpXS5jb3VudDtcclxuICAgICAgICAgICAgdmFyIGlkX3Byb2R1Y3QgPSB1c2VyX2RhdGEudXNlcl9kYXRhLndhcmVIb3VzZVtpXS5pZF9wcm9kdWN0Oy8vIGzhuqV5IGlkIGPhu6dhIGPDonkgdHJvbmcgbeG7l2kga2hvXHJcbiAgICAgICAgICAgIGlmIChpZF9wcm9kdWN0ID4gNykgY29udGludWU7XHJcbiAgICAgICAgICAgIHZhciBzZWxsID0gY29uZmlnLnBsYW50W2lkX3Byb2R1Y3RdLnNlbGw7XHJcbiAgICAgICAgICAgIHN1bSArPSBjb3VudCAqIHNlbGw7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoc3VtID09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5nYW1lX3NjZW5lX2pzLmNyZWF0ZV90aXBzX3VpKHRoaXMuZ2FtZV9ydWxlc19qcy5ub2RlLCBcIm5vX3NlbGxcIik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2Vbal0uY291bnQgPSAwO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmdhbWVfc2NlbmVfanMuY3JlYXRlX3RpcHNfdWkodGhpcy5nYW1lX3J1bGVzX2pzLm5vZGUsIFwiZ29sZFwiLCBzdW0pO1xyXG4gICAgICAgICAgICB0aGlzLmdhbWVfcnVsZXNfanMuYWRkX2dvbGQoc3VtKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRfc2VsbCgpO1xyXG4gICAgICAgIH07XHJcbiAgICB9LFxyXG5cclxuICAgIC8vZG91YmxlX3NlbGxfYnV0dG9uX2NsaWNrXHJcbiAgICBvbl9kb3VibGVfc2VsbF9idXR0b25fY2xpY2soKSB7XHJcbiAgICAgICAgdGhpcy5zb3VuZF9jb250cm9sLnBsYXlfc291bmRfZWZmZWN0KFwiYnV0dG9uX2NsaWNrXCIpO1xyXG4gICAgICAgIHRoaXMuYWRzTWFuYWdlcl9qcy5zaG93UmV3YXJkZWRWaWRlbygoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBzdW0gPSAwO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaWNvbl9ncm91cF9ub2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnQgPSB1c2VyX2RhdGEudXNlcl9kYXRhLndhcmVIb3VzZVtpXS5jb3VudDtcclxuICAgICAgICAgICAgICAgIHZhciBpZF9wcm9kdWN0ID0gdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uaWRfcHJvZHVjdDsvLyBs4bqleSBpZCBj4bunYSBjw6J5IHRyb25nIG3hu5dpIGtob1xyXG4gICAgICAgICAgICAgICAgaWYgKGlkX3Byb2R1Y3QgPiA3KSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIHZhciBzZWxsID0gY29uZmlnLnBsYW50W2lkX3Byb2R1Y3RdLnNlbGw7XHJcbiAgICAgICAgICAgICAgICBzdW0gKz0gY291bnQgKiBzZWxsO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBpZiAoc3VtID09IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZV9zY2VuZV9qcy5jcmVhdGVfdGlwc191aSh0aGlzLmdhbWVfcnVsZXNfanMubm9kZSwgXCJub19zZWxsXCIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2pdLmNvdW50ID0gMDtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdhbWVfc2NlbmVfanMuY3JlYXRlX3RpcHNfdWkodGhpcy5nYW1lX3J1bGVzX2pzLm5vZGUsIFwiZ29sZFwiLCBzdW0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lX3J1bGVzX2pzLmFkZF9nb2xkKHN1bSAqIDIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfc2VsbCgpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuXHJcbiAgICAvL+ajgOa1i+inhumikeaYr+WQpuaSreaUvuaIkOWKn1xyXG4gICAgdmlkZW9fc3VjY2VzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiAod3gpICE9IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgdmFyIGNhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRfY29udHJvbC52aWRlb19zdGF0ZSA9PSAxICYmIHRoaXMuYWRfY29udHJvbC52aWRlb190YWcgPT0gXCJkb3VibGVfc2VsbFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZF9jb250cm9sLnZpZGVvX3RhZyA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZF9jb250cm9sLnZpZGVvX3N0YXRlID0gMjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VtID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaWNvbl9ncm91cF9ub2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3VudCA9IHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLmNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VsbCA9IGNvbmZpZy5wbGFudFtpXS5zZWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdW0gKz0gY291bnQgKiBzZWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyX2RhdGEudXNlcl9kYXRhLndhcmVIb3VzZVtqXS5jb3VudCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWVfc2NlbmVfanMuY3JlYXRlX3RpcHNfdWkodGhpcy5nYW1lX3J1bGVzX2pzLm5vZGUsIFwiZ29sZFwiLCBzdW0gKiAyKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWVfcnVsZXNfanMuYWRkX2dvbGQoc3VtICogMik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRfc2VsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5zY2hlZHVsZShjYWxsYmFjayk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmFkX2NvbnRyb2wudmlkZW9fdGFnID09IG51bGwgJiYgdGhpcy5hZF9jb250cm9sLnZpZGVvX3N0YXRlID09IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNjaGVkdWxlKGNhbGxiYWNrKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZShjYWxsYmFjaywgMC4yKTtcclxuICAgICAgICB9O1xyXG4gICAgfSxcclxuICAgIG9uTG9hZCgpIHtcclxuXHJcbiAgICB9LFxyXG5cclxuICAgIHN0YXJ0KCkge1xyXG5cclxuICAgIH0sXHJcblxyXG4gICAgLy8gdXBkYXRlIChkdCkge30sXHJcbn0pO1xyXG4iXX0=