
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/script/ui/sell_ui.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'b3408LFwupOPKoN9Pojb+Zi', 'sell_ui');
// script/ui/sell_ui.js

"use strict";

var user_data = require("user_data");

var config = require("config");

cc.Class({
  "extends": cc.Component,
  properties: {
    box_frame_arr: [cc.SpriteFrame],
    icon_group_node: cc.Node,
    label_group_node: cc.Node,
    // estimate_label: cc.Label,
    lock_group_node: cc.Node
  },
  // LIFE-CYCLE CALLBACKS:
  ini_node: function ini_node() {
    this.game_scene_js = cc.find("UI_ROOT").getComponent("game_scene");
    this.game_rules_js = cc.find("UI_ROOT").getComponent("game_rules");
    this.ad_control = cc.find("ad_control").getComponent("ad_control");
    this.sound_control = cc.find("sound_control").getComponent("sound_control");
    this.ad_control.show_bannerAd();
    this.set_sell(); // this.set_estimate_label();
  },
  button_unlock_click: function button_unlock_click(e, custom) {
    // button mở kho
    var sum_gold = 0;
    var sum_diamond = 0;

    for (var i = 0; i <= custom; i++) {
      if (user_data.user_data.wareHouse[i].have == 0) {
        if (user_data.user_data.wareHouse[i].type_buy == "gold") sum_gold += user_data.user_data.wareHouse[i].cost;else sum_diamond += user_data.user_data.wareHouse[i].cost;
      }
    }

    if (user_data.user_data.gold >= sum_gold && user_data.user_data.diamond >= sum_diamond) {
      user_data.user_data.gold -= sum_gold;
      user_data.user_data.diamond -= sum_diamond;
    } else {
      this.game_scene_js.create_tips_ui(this.game_scene_js.node, "no_money_gold");
    }
  },
  auto_sell: function auto_sell() {
    // tự động bán hàng trong kho
    var time_auto = 60 * 60;

    var auto = function auto() {
      time_auto -= 0.1;
    };

    this.schedule(this.auto, 0.1);
  },
  set_sell: function set_sell() {
    var all_capacity = 30;

    for (var i = 0; i < this.icon_group_node.children.length; i++) {
      if (user_data.user_data.wareHouse[i].have == 1) {
        var count = user_data.user_data.wareHouse[i].count;
        this.label_group_node.children[i].getComponent(cc.Label).string = count + "/" + all_capacity;
        this.lock_group_node.children[i].active = false;

        if (count > 0) {
          var id_product = user_data.user_data.wareHouse[i].id_product;
          this.icon_group_node.children[i].getComponent(cc.Sprite).spriteFrame = this.box_frame_arr[id_product];
        } else {
          this.icon_group_node.children[i].getComponent(cc.Sprite).spriteFrame = this.box_frame_arr[8];
        }
      } else {
        this.label_group_node.children[i].getComponent(cc.Label).string = '';
        this.lock_group_node.children[i].active = true;
        this.icon_group_node.children[i].getComponent(cc.Sprite).SpriteFrame = this.box_frame_arr[8];
      }
    }
  },
  touch_exit: function touch_exit() {
    this.sound_control.play_sound_effect("button_exit");
    this.ad_control.hide_bannerAd();
    this.game_scene_js.on_node_kill(this.node);
  },
  //设置预计卖出文字
  set_estimate_label: function set_estimate_label() {
    var sum = 0;

    for (var i = 0; i < this.icon_group_node.children.length; i++) {
      var count = user_data.user_data.wareHouse[i].count;
      var sell = config.plant[i].sell;
      sum += count * sell;
    }

    ;
    this.estimate_label.string = "Expected to sell: " + sum;
  },
  //普通卖出
  on_sell_button_click: function on_sell_button_click() {
    this.sound_control.play_sound_effect("button_click");
    var sum = 0;

    for (var i = 0; i < this.icon_group_node.children.length; i++) {
      var count = user_data.user_data.wareHouse[i].count;
      var id_product = user_data.user_data.wareHouse[i].id_product; // lấy id của cây trong mỗi kho

      if (id_product > 7) continue;
      var sell = config.plant[id_product].sell;
      sum += count * sell;
    }

    ;

    if (sum == 0) {
      this.game_scene_js.create_tips_ui(this.game_rules_js.node, "no_sell");
    } else {
      for (var j = 0; j < this.icon_group_node.children.length; j++) {
        user_data.user_data.wareHouse[j].count = 0;
      }

      ;
      this.game_scene_js.create_tips_ui(this.game_rules_js.node, "gold", sum);
      this.game_rules_js.add_gold(sum);
      this.set_sell();
    }

    ;
  },
  //double_sell_button_click
  on_double_sell_button_click: function on_double_sell_button_click() {
    this.sound_control.play_sound_effect("button_click");
    var sum = 0;

    for (var i = 0; i < this.icon_group_node.children.length; i++) {
      var count = user_data.user_data.wareHouse[i].count;
      var sell = config.plant[i].sell;
      sum += count * sell;
    }

    ; //如果没有可卖的则不能卖出

    if (sum == 0) {
      this.game_scene_js.create_tips_ui(this.game_rules_js.node, "no_sell");
    } else {
      this.ad_control.show_videoAd("double_sell");
      this.video_succes();
    }

    ;
  },
  //检测视频是否播放成功
  video_succes: function video_succes() {
    if (typeof wx != "undefined") {
      var callback = function callback() {
        if (this.ad_control.video_state == 1 && this.ad_control.video_tag == "double_sell") {
          this.ad_control.video_tag = null;
          this.ad_control.video_state = 2;
          var sum = 0;

          for (var i = 0; i < this.icon_group_node.children.length; i++) {
            var count = user_data.user_data.wareHouse[i].count;
            var sell = config.plant[i].sell;
            sum += count * sell;
          }

          ;

          for (var j = 0; j < this.icon_group_node.children.length; j++) {
            user_data.user_data.wareHouse[j].count = 0;
          }

          ;
          this.game_scene_js.create_tips_ui(this.game_rules_js.node, "gold", sum * 2);
          this.game_rules_js.add_gold(sum * 2);
          this.set_sell();
          this.unschedule(callback);
        } else {
          if (this.ad_control.video_tag == null && this.ad_control.video_state == 2) {
            this.unschedule(callback);
          }

          ;
        }

        ;
      };

      this.schedule(callback, 0.2);
    }

    ;
  },
  onLoad: function onLoad() {},
  start: function start() {} // update (dt) {},

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0XFx1aVxcc2VsbF91aS5qcyJdLCJuYW1lcyI6WyJ1c2VyX2RhdGEiLCJyZXF1aXJlIiwiY29uZmlnIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJib3hfZnJhbWVfYXJyIiwiU3ByaXRlRnJhbWUiLCJpY29uX2dyb3VwX25vZGUiLCJOb2RlIiwibGFiZWxfZ3JvdXBfbm9kZSIsImxvY2tfZ3JvdXBfbm9kZSIsImluaV9ub2RlIiwiZ2FtZV9zY2VuZV9qcyIsImZpbmQiLCJnZXRDb21wb25lbnQiLCJnYW1lX3J1bGVzX2pzIiwiYWRfY29udHJvbCIsInNvdW5kX2NvbnRyb2wiLCJzaG93X2Jhbm5lckFkIiwic2V0X3NlbGwiLCJidXR0b25fdW5sb2NrX2NsaWNrIiwiZSIsImN1c3RvbSIsInN1bV9nb2xkIiwic3VtX2RpYW1vbmQiLCJpIiwid2FyZUhvdXNlIiwiaGF2ZSIsInR5cGVfYnV5IiwiY29zdCIsImdvbGQiLCJkaWFtb25kIiwiY3JlYXRlX3RpcHNfdWkiLCJub2RlIiwiYXV0b19zZWxsIiwidGltZV9hdXRvIiwiYXV0byIsInNjaGVkdWxlIiwiYWxsX2NhcGFjaXR5IiwiY2hpbGRyZW4iLCJsZW5ndGgiLCJjb3VudCIsIkxhYmVsIiwic3RyaW5nIiwiYWN0aXZlIiwiaWRfcHJvZHVjdCIsIlNwcml0ZSIsInNwcml0ZUZyYW1lIiwidG91Y2hfZXhpdCIsInBsYXlfc291bmRfZWZmZWN0IiwiaGlkZV9iYW5uZXJBZCIsIm9uX25vZGVfa2lsbCIsInNldF9lc3RpbWF0ZV9sYWJlbCIsInN1bSIsInNlbGwiLCJwbGFudCIsImVzdGltYXRlX2xhYmVsIiwib25fc2VsbF9idXR0b25fY2xpY2siLCJqIiwiYWRkX2dvbGQiLCJvbl9kb3VibGVfc2VsbF9idXR0b25fY2xpY2siLCJzaG93X3ZpZGVvQWQiLCJ2aWRlb19zdWNjZXMiLCJ3eCIsImNhbGxiYWNrIiwidmlkZW9fc3RhdGUiLCJ2aWRlb190YWci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LENBQW1Cb0IsY0FBbkIsQ0FBa0MsS0FBS2pCLGFBQUwsQ0FBbUJrQixJQUFyRCxFQUEyRCxNQUEzRCxFQUFtRW9CLEdBQUcsR0FBRyxDQUF6RTtBQUNBLGVBQUt0QyxhQUFMLENBQW1CNEMsUUFBbkIsQ0FBNEJOLEdBQUcsR0FBRyxDQUFsQztBQUNBLGVBQUtsQyxRQUFMO0FBQ0EsZUFBS2dELFVBQUwsQ0FBZ0JILFFBQWhCO0FBQ0gsU0FoQkQsTUFnQk87QUFDSCxjQUFJLEtBQUtoRCxVQUFMLENBQWdCa0QsU0FBaEIsSUFBNkIsSUFBN0IsSUFBcUMsS0FBS2xELFVBQUwsQ0FBZ0JpRCxXQUFoQixJQUErQixDQUF4RSxFQUEyRTtBQUN2RSxpQkFBS0UsVUFBTCxDQUFnQkgsUUFBaEI7QUFDSDs7QUFBQTtBQUNKOztBQUFBO0FBQ0osT0F0QkQ7O0FBdUJBLFdBQUszQixRQUFMLENBQWMyQixRQUFkLEVBQXdCLEdBQXhCO0FBQ0g7O0FBQUE7QUFDSixHQTNKSTtBQTRKTEksRUFBQUEsTUE1Skssb0JBNEpJLENBRVIsQ0E5Skk7QUFnS0xDLEVBQUFBLEtBaEtLLG1CQWdLRyxDQUVQLENBbEtJLENBb0tMOztBQXBLSyxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdXNlcl9kYXRhID0gcmVxdWlyZShcInVzZXJfZGF0YVwiKTtcbnZhciBjb25maWcgPSByZXF1aXJlKFwiY29uZmlnXCIpO1xuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgYm94X2ZyYW1lX2FycjogW2NjLlNwcml0ZUZyYW1lXSxcbiAgICAgICAgaWNvbl9ncm91cF9ub2RlOiBjYy5Ob2RlLFxuICAgICAgICBsYWJlbF9ncm91cF9ub2RlOiBjYy5Ob2RlLFxuICAgICAgICAvLyBlc3RpbWF0ZV9sYWJlbDogY2MuTGFiZWwsXG4gICAgICAgIGxvY2tfZ3JvdXBfbm9kZTogY2MuTm9kZSxcbiAgICB9LFxuXG4gICAgLy8gTElGRS1DWUNMRSBDQUxMQkFDS1M6XG4gICAgaW5pX25vZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5nYW1lX3NjZW5lX2pzID0gY2MuZmluZChcIlVJX1JPT1RcIikuZ2V0Q29tcG9uZW50KFwiZ2FtZV9zY2VuZVwiKTtcbiAgICAgICAgdGhpcy5nYW1lX3J1bGVzX2pzID0gY2MuZmluZChcIlVJX1JPT1RcIikuZ2V0Q29tcG9uZW50KFwiZ2FtZV9ydWxlc1wiKTtcbiAgICAgICAgdGhpcy5hZF9jb250cm9sID0gY2MuZmluZChcImFkX2NvbnRyb2xcIikuZ2V0Q29tcG9uZW50KFwiYWRfY29udHJvbFwiKTtcbiAgICAgICAgdGhpcy5zb3VuZF9jb250cm9sID0gY2MuZmluZChcInNvdW5kX2NvbnRyb2xcIikuZ2V0Q29tcG9uZW50KFwic291bmRfY29udHJvbFwiKTtcbiAgICAgICAgdGhpcy5hZF9jb250cm9sLnNob3dfYmFubmVyQWQoKTtcbiAgICAgICAgdGhpcy5zZXRfc2VsbCgpO1xuICAgICAgICAvLyB0aGlzLnNldF9lc3RpbWF0ZV9sYWJlbCgpO1xuICAgIH0sXG4gICAgYnV0dG9uX3VubG9ja19jbGljayhlLCBjdXN0b20pIHsgICAgICAgIC8vIGJ1dHRvbiBt4bufIGtob1xuICAgICAgICB2YXIgc3VtX2dvbGQgPSAwO1xuICAgICAgICB2YXIgc3VtX2RpYW1vbmQgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBjdXN0b207IGkrKykge1xuXG4gICAgICAgICAgICBpZiAodXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uaGF2ZSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLnR5cGVfYnV5ID09IFwiZ29sZFwiKVxuICAgICAgICAgICAgICAgICAgICBzdW1fZ29sZCArPSB1c2VyX2RhdGEudXNlcl9kYXRhLndhcmVIb3VzZVtpXS5jb3N0O1xuICAgICAgICAgICAgICAgIGVsc2Ugc3VtX2RpYW1vbmQgKz0gdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uY29zdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodXNlcl9kYXRhLnVzZXJfZGF0YS5nb2xkID49IHN1bV9nb2xkICYmIHVzZXJfZGF0YS51c2VyX2RhdGEuZGlhbW9uZCA+PSBzdW1fZGlhbW9uZCkge1xuICAgICAgICAgICAgdXNlcl9kYXRhLnVzZXJfZGF0YS5nb2xkIC09IHN1bV9nb2xkO1xuICAgICAgICAgICAgdXNlcl9kYXRhLnVzZXJfZGF0YS5kaWFtb25kIC09IHN1bV9kaWFtb25kO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZV9zY2VuZV9qcy5jcmVhdGVfdGlwc191aSh0aGlzLmdhbWVfc2NlbmVfanMubm9kZSwgXCJub19tb25leV9nb2xkXCIpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBhdXRvX3NlbGw6IGZ1bmN0aW9uICgpIHsgICAgLy8gdOG7sSDEkeG7mW5nIGLDoW4gaMOgbmcgdHJvbmcga2hvXG4gICAgICAgIHZhciB0aW1lX2F1dG8gPSA2MCAqIDYwO1xuXG4gICAgICAgIHZhciBhdXRvID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGltZV9hdXRvIC09MC4xO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNjaGVkdWxlKHRoaXMuYXV0bywgMC4xKTtcbiAgICB9LFxuICAgIHNldF9zZWxsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhbGxfY2FwYWNpdHkgPSAzMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLmhhdmUgPT0gMSkge1xuICAgICAgICAgICAgICAgIGxldCBjb3VudCA9IHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLmNvdW50O1xuICAgICAgICAgICAgICAgIHRoaXMubGFiZWxfZ3JvdXBfbm9kZS5jaGlsZHJlbltpXS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IGNvdW50ICsgXCIvXCIgKyBhbGxfY2FwYWNpdHk7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2NrX2dyb3VwX25vZGUuY2hpbGRyZW5baV0uYWN0aXZlID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAoY291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpZF9wcm9kdWN0ID0gdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uaWRfcHJvZHVjdDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pY29uX2dyb3VwX25vZGUuY2hpbGRyZW5baV0uZ2V0Q29tcG9uZW50KGNjLlNwcml0ZSkuc3ByaXRlRnJhbWUgPSB0aGlzLmJveF9mcmFtZV9hcnJbaWRfcHJvZHVjdF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbltpXS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHRoaXMuYm94X2ZyYW1lX2Fycls4XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsX2dyb3VwX25vZGUuY2hpbGRyZW5baV0uZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSAnJztcbiAgICAgICAgICAgICAgICB0aGlzLmxvY2tfZ3JvdXBfbm9kZS5jaGlsZHJlbltpXS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuaWNvbl9ncm91cF9ub2RlLmNoaWxkcmVuW2ldLmdldENvbXBvbmVudChjYy5TcHJpdGUpLlNwcml0ZUZyYW1lID0gdGhpcy5ib3hfZnJhbWVfYXJyWzhdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICB9LFxuICAgIHRvdWNoX2V4aXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zb3VuZF9jb250cm9sLnBsYXlfc291bmRfZWZmZWN0KFwiYnV0dG9uX2V4aXRcIik7XG4gICAgICAgIHRoaXMuYWRfY29udHJvbC5oaWRlX2Jhbm5lckFkKCk7XG4gICAgICAgIHRoaXMuZ2FtZV9zY2VuZV9qcy5vbl9ub2RlX2tpbGwodGhpcy5ub2RlKTtcbiAgICB9LFxuICAgIC8v6K6+572u6aKE6K6h5Y2W5Ye65paH5a2XXG4gICAgc2V0X2VzdGltYXRlX2xhYmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzdW0gPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaWNvbl9ncm91cF9ub2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgY291bnQgPSB1c2VyX2RhdGEudXNlcl9kYXRhLndhcmVIb3VzZVtpXS5jb3VudDtcbiAgICAgICAgICAgIHZhciBzZWxsID0gY29uZmlnLnBsYW50W2ldLnNlbGw7XG4gICAgICAgICAgICBzdW0gKz0gY291bnQgKiBzZWxsO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmVzdGltYXRlX2xhYmVsLnN0cmluZyA9IFwiRXhwZWN0ZWQgdG8gc2VsbDogXCIgKyBzdW07XG4gICAgfSxcbiAgICAvL+aZrumAmuWNluWHulxuICAgIG9uX3NlbGxfYnV0dG9uX2NsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc291bmRfY29udHJvbC5wbGF5X3NvdW5kX2VmZmVjdChcImJ1dHRvbl9jbGlja1wiKTtcbiAgICAgICAgdmFyIHN1bSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5pY29uX2dyb3VwX25vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBjb3VudCA9IHVzZXJfZGF0YS51c2VyX2RhdGEud2FyZUhvdXNlW2ldLmNvdW50O1xuICAgICAgICAgICAgdmFyIGlkX3Byb2R1Y3QgPSB1c2VyX2RhdGEudXNlcl9kYXRhLndhcmVIb3VzZVtpXS5pZF9wcm9kdWN0Oy8vIGzhuqV5IGlkIGPhu6dhIGPDonkgdHJvbmcgbeG7l2kga2hvXG4gICAgICAgICAgICBpZiAoaWRfcHJvZHVjdCA+IDcpIGNvbnRpbnVlO1xuICAgICAgICAgICAgdmFyIHNlbGwgPSBjb25maWcucGxhbnRbaWRfcHJvZHVjdF0uc2VsbDtcbiAgICAgICAgICAgIHN1bSArPSBjb3VudCAqIHNlbGw7XG4gICAgICAgIH07XG4gICAgICAgIGlmIChzdW0gPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5nYW1lX3NjZW5lX2pzLmNyZWF0ZV90aXBzX3VpKHRoaXMuZ2FtZV9ydWxlc19qcy5ub2RlLCBcIm5vX3NlbGxcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuaWNvbl9ncm91cF9ub2RlLmNoaWxkcmVuLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2Vbal0uY291bnQgPSAwO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuZ2FtZV9zY2VuZV9qcy5jcmVhdGVfdGlwc191aSh0aGlzLmdhbWVfcnVsZXNfanMubm9kZSwgXCJnb2xkXCIsIHN1bSk7XG4gICAgICAgICAgICB0aGlzLmdhbWVfcnVsZXNfanMuYWRkX2dvbGQoc3VtKTtcbiAgICAgICAgICAgIHRoaXMuc2V0X3NlbGwoKTtcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIC8vZG91YmxlX3NlbGxfYnV0dG9uX2NsaWNrXG4gICAgb25fZG91YmxlX3NlbGxfYnV0dG9uX2NsaWNrKCkge1xuICAgICAgICB0aGlzLnNvdW5kX2NvbnRyb2wucGxheV9zb3VuZF9lZmZlY3QoXCJidXR0b25fY2xpY2tcIik7XG4gICAgICAgIHZhciBzdW0gPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaWNvbl9ncm91cF9ub2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgY291bnQgPSB1c2VyX2RhdGEudXNlcl9kYXRhLndhcmVIb3VzZVtpXS5jb3VudDtcbiAgICAgICAgICAgIHZhciBzZWxsID0gY29uZmlnLnBsYW50W2ldLnNlbGw7XG4gICAgICAgICAgICBzdW0gKz0gY291bnQgKiBzZWxsO1xuICAgICAgICB9O1xuICAgICAgICAvL+WmguaenOayoeacieWPr+WNlueahOWImeS4jeiDveWNluWHulxuICAgICAgICBpZiAoc3VtID09IDApIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZV9zY2VuZV9qcy5jcmVhdGVfdGlwc191aSh0aGlzLmdhbWVfcnVsZXNfanMubm9kZSwgXCJub19zZWxsXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5hZF9jb250cm9sLnNob3dfdmlkZW9BZChcImRvdWJsZV9zZWxsXCIpO1xuICAgICAgICAgICAgdGhpcy52aWRlb19zdWNjZXMoKTtcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIC8v5qOA5rWL6KeG6aKR5piv5ZCm5pKt5pS+5oiQ5YqfXG4gICAgdmlkZW9fc3VjY2VzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0eXBlb2YgKHd4KSAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRfY29udHJvbC52aWRlb19zdGF0ZSA9PSAxICYmIHRoaXMuYWRfY29udHJvbC52aWRlb190YWcgPT0gXCJkb3VibGVfc2VsbFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRfY29udHJvbC52aWRlb190YWcgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkX2NvbnRyb2wudmlkZW9fc3RhdGUgPSAyO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3VtID0gMDtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2VbaV0uY291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VsbCA9IGNvbmZpZy5wbGFudFtpXS5zZWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VtICs9IGNvdW50ICogc2VsbDtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmljb25fZ3JvdXBfbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9kYXRhLnVzZXJfZGF0YS53YXJlSG91c2Vbal0uY291bnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWVfc2NlbmVfanMuY3JlYXRlX3RpcHNfdWkodGhpcy5nYW1lX3J1bGVzX2pzLm5vZGUsIFwiZ29sZFwiLCBzdW0gKiAyKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lX3J1bGVzX2pzLmFkZF9nb2xkKHN1bSAqIDIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldF9zZWxsKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5zY2hlZHVsZShjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRfY29udHJvbC52aWRlb190YWcgPT0gbnVsbCAmJiB0aGlzLmFkX2NvbnRyb2wudmlkZW9fc3RhdGUgPT0gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNjaGVkdWxlKGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuc2NoZWR1bGUoY2FsbGJhY2ssIDAuMik7XG4gICAgICAgIH07XG4gICAgfSxcbiAgICBvbkxvYWQoKSB7XG5cbiAgICB9LFxuXG4gICAgc3RhcnQoKSB7XG5cbiAgICB9LFxuXG4gICAgLy8gdXBkYXRlIChkdCkge30sXG59KTtcbiJdfQ==