{"version":3,"sources":["assets\\script\\control\\ad_control.js"],"names":["cc","Class","Component","properties","open_share","wx","showShareMenu","withShareTicket","onShareAppMessage","manual_share","tag","tt","share_tag","share_state","share_time","Date","getTime","self","shareAppMessage","templateId","title","desc","imageUrl","query","success","console","log","share_sucess","fail","e","share_fail","share_judge","onShow","now_time","game_scene_js","create_tips_ui","node","ini_share","create_videoAd","config","ad_state","video_ad","createRewardedVideoAd","adUnitId","onError","err","ad_manageer","show_videoAd","name","sound_control","pause_all_sound","video_tag","show","load","then","over_videoAd","onClose","res","isEnded","undefined","video_state","resume_all_sound","banner_ad","info","getSystemInfoSync","appName","toUpperCase","sysInfo","bannerAd","createBannerAd","adIntervals","style","left","top","width","onResize","windowHeight","height","windowWidth","show_bannerAd","hide_bannerAd","hide","onLoad","find","getComponent","judge","start"],"mappings":";;;;;;AAAA;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAGLC,EAAAA,UAAU,EAAE,EAHP;AAOL;AAEA;AACAC,EAAAA,UAAU,EAAE,sBAAY;AACpB,QAAI,OAAQC,EAAR,KAAgB,WAApB,EAAiC;AAC7B;AACAA,MAAAA,EAAE,CAACC,aAAH,CAAiB;AAAEC,QAAAA,eAAe,EAAE;AAAnB,OAAjB;AACAF,MAAAA,EAAE,CAACG,iBAAH,CAAqB,YAAY;AAC7B,eAAO,CACH;AADG,SAAP;AAGH,OAJD;AAKH;;AAAA;AACJ,GApBI;AAsBL;AACAC,EAAAA,YAAY,EAAE,sBAAUC,GAAV,EAAe;AACzB,QAAI,OAAQC,EAAR,KAAgB,WAApB,EAAiC;AAC7B;AACA,WAAKC,SAAL,GAAiBF,GAAjB;AACA,WAAKG,WAAL,GAAmB,QAAnB;AACA,WAAKC,UAAL,GAAkB,IAAIC,IAAJ,GAAWC,OAAX,EAAlB,CAJ6B,CAIW;;AACxC,UAAIC,IAAI,GAAG,IAAX;;AACA,cAAQP,GAAR;AACI,aAAK,gBAAL;AACIC,UAAAA,EAAE,CAACO,eAAH,CAAmB;AACfC,YAAAA,UAAU,EAAE,oBADG;AACmB;AAClCC,YAAAA,KAAK,EAAE,uBAFQ;AAGfC,YAAAA,IAAI,EAAE,iDAHS;AAIfC,YAAAA,QAAQ,EAAE,EAJK;AAKfC,YAAAA,KAAK,EAAE,EALQ;AAMfC,YAAAA,OANe,qBAML;AACNC,cAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACAT,cAAAA,IAAI,CAACU,YAAL;AACH,aATc;AAUfC,YAAAA,IAVe,gBAUVC,CAVU,EAUP;AACJJ,cAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACAT,cAAAA,IAAI,CAACa,UAAL;AACH;AAbc,WAAnB;AAeA;;AACJ,aAAK,KAAL;AACInB,UAAAA,EAAE,CAACO,eAAH,CAAmB;AACfC,YAAAA,UAAU,EAAE,EADG;AACC;AAChBC,YAAAA,KAAK,EAAE,iBAFQ;AAGfC,YAAAA,IAAI,EAAE,8CAHS;AAIfC,YAAAA,QAAQ,EAAE,EAJK;AAKfC,YAAAA,KAAK,EAAE,EALQ;AAMfC,YAAAA,OANe,qBAML;AACNC,cAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACAT,cAAAA,IAAI,CAACU,YAAL;AACH,aATc;AAUfC,YAAAA,IAVe,gBAUVC,CAVU,EAUP;AACJJ,cAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACAT,cAAAA,IAAI,CAACa,UAAL;AACH;AAbc,WAAnB;AAeA;AAlCR;;AAmCC;AACJ;;AAAA;AAEJ,GApEI;AAqEL;AACAC,EAAAA,WAAW,EAAE,uBAAY;AACrB,QAAI,OAAQ1B,EAAR,KAAgB,WAApB,EAAiC;AAC7B,UAAIY,IAAI,GAAG,IAAX;AACAZ,MAAAA,EAAE,CAAC2B,MAAH,CAAU,YAAY;AAClB;AACA,YAAIf,IAAI,CAACJ,WAAL,IAAoB,QAApB,IAAgCI,IAAI,CAACL,SAAL,KAAmB,IAAvD,EAA6D;AACzD,cAAIqB,QAAQ,GAAG,IAAIlB,IAAJ,GAAWC,OAAX,EAAf;;AACA,cAAIiB,QAAQ,GAAGhB,IAAI,CAACH,UAAhB,IAA8B,IAAlC,EAAwC;AACpCG,YAAAA,IAAI,CAACU,YAAL,CAAkBV,IAAI,CAACL,SAAvB;AACH,WAFD,MAEO;AACHK,YAAAA,IAAI,CAACa,UAAL;AACH;;AAAA;AACJ,SAPD,MAOO;AACH;AACH;AACJ,OAZD;AAaH;AACJ,GAvFI;AAwFL;AACAH,EAAAA,YAAY,EAAE,wBAAY;AACtB,SAAKd,WAAL,GAAmB,cAAnB;AACA,SAAKqB,aAAL,CAAmBC,cAAnB,CAAkC,KAAKD,aAAL,CAAmBE,IAArD,EAA2D,cAA3D;AACH,GA5FI;AA8FL;AACAN,EAAAA,UAAU,EAAE,sBAAY;AACpB,SAAKO,SAAL;AACA,SAAKH,aAAL,CAAmBC,cAAnB,CAAkC,KAAKD,aAAL,CAAmBE,IAArD,EAA2D,YAA3D;AAEH,GAnGI;AAqGL;AACAC,EAAAA,SAAS,EAAE,qBAAY;AACnB,SAAKzB,SAAL,GAAiB,IAAjB,CADmB,CACI;;AACvB,SAAKE,UAAL,GAAkB,IAAlB,CAFmB,CAEK;;AACxB,SAAKD,WAAL,GAAmB,UAAnB;AACH,GA1GI;AA4GL;AACA;AACA;AACAyB,EAAAA,cAAc,EAAE,0BAAY;AAAA;;AACxB,QAAIC,mBAAOC,QAAP,IAAmB,CAAvB,EAA0B;AACtB;AACH;;AAAA;;AACD,QAAI,OAAQnC,EAAR,KAAgB,WAApB,EAAiC;AAC7B;AACA,WAAKoC,QAAL,GAAgBpC,EAAE,CAACqC,qBAAH,CAAyB;AACrCC,QAAAA,QAAQ,EAAE,oBAD2B,CACN;;AADM,OAAzB,CAAhB,CAF6B,CAM7B;AACA;AAEA;;AACA,WAAKF,QAAL,CAAcG,OAAd,CAAsB,UAAAC,GAAG,EAAI;AACzB,QAAA,KAAI,CAACC,WAAL,GAAmB,KAAnB;AACArB,QAAAA,OAAO,CAACC,GAAR,CAAYmB,GAAZ;AACH,OAHD;AAIH;;AAAA;AACJ,GAlII;AAmIL;AACAE,EAAAA,YAAY,EAAE,sBAAUC,IAAV,EAAgB;AAAA;;AAC1B,QAAIT,mBAAOC,QAAP,IAAmB,CAAvB,EAA0B;AACtB;AACH;;AAAA;;AACD,QAAI,OAAQnC,EAAR,KAAgB,WAApB,EAAiC;AAC7B,UAAI,KAAKyC,WAAL,IAAoB,KAAxB,EAA+B,CAC3B;AACH,OAFD,MAEO;AACH,aAAKG,aAAL,CAAmBC,eAAnB;AACH;;AAAA;AACD,WAAKC,SAAL,GAAiBH,IAAjB,CAN6B,CAO7B;;AACA,WAAKP,QAAL,CAAcW,IAAd,YAA2B,YAAM;AAC7B;AACA,QAAA,MAAI,CAACX,QAAL,CAAcY,IAAd,GACKC,IADL,CACU;AAAA,iBAAM,MAAI,CAACb,QAAL,CAAcW,IAAd,EAAN;AAAA,SADV,WAGW,UAAAP,GAAG,EAAI;AACVpB,UAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;;AACA,UAAA,MAAI,CAACQ,aAAL,CAAmBC,cAAnB,CAAkC,MAAI,CAACD,aAAL,CAAmBE,IAArD,EAA2D,YAA3D;AACH,SANL;AAOH,OATD;AAUH;;AAAA;AACJ,GA3JI;AA4JL;AACAmB,EAAAA,YAAY,EAAE,wBAAY;AAAA;;AACtB,QAAIhB,mBAAOC,QAAP,IAAmB,CAAvB,EAA0B;AACtB;AACH;;AAAA;;AACD,QAAI,OAAQnC,EAAR,KAAgB,WAApB,EAAiC;AAC7B,WAAKoC,QAAL,CAAce,OAAd,CAAsB,UAAAC,GAAG,EAAI;AACzB;AACA;AACA,YAAIA,GAAG,IAAIA,GAAG,CAACC,OAAX,IAAsBD,GAAG,KAAKE,SAAlC,EAA6C;AACzC;AACA,UAAA,MAAI,CAACC,WAAL,GAAmB,CAAnB,CAFyC,CAEpB;;AACrB,UAAA,MAAI,CAACX,aAAL,CAAmBY,gBAAnB;AACH,SAJD,MAKK;AACD;AACA,UAAA,MAAI,CAACZ,aAAL,CAAmBY,gBAAnB;;AACA,UAAA,MAAI,CAACD,WAAL,GAAmB,CAAnB;;AACA,UAAA,MAAI,CAAC1B,aAAL,CAAmBC,cAAnB,CAAkC,MAAI,CAACD,aAAL,CAAmBE,IAArD,EAA2D,YAA3D;AACH;AACJ,OAdD;AAeH;;AAAA;AACJ,GAlLI;AAmLL;AACA0B,EAAAA,SAAS,EAAE,qBAAY;AAAA;;AACnB,QAAI,OAAQzD,EAAR,KAAgB,WAApB,EAAiC;AAC7B;AACA,UAAM0D,IAAI,GAAGpD,EAAE,CAACqD,iBAAH,EAAb;;AACA,UAAID,IAAI,CAACE,OAAL,CAAaC,WAAb,OAA+B,QAA/B,IAA2C3B,mBAAOC,QAAP,IAAmB,CAAlE,EAAqE;AACjE;AACH,OAFD,MAEO;AACH;AACA,YAAI2B,OAAO,GAAG9D,EAAE,CAAC2D,iBAAH,EAAd;AACA,aAAKI,QAAL,GAAgB/D,EAAE,CAACgE,cAAH,CAAkB;AAC9B1B,UAAAA,QAAQ,EAAE,oBADoB;AAE9B2B,UAAAA,WAAW,EAAE,EAFiB;AAG9BC,UAAAA,KAAK,EAAE;AACHC,YAAAA,IAAI,EAAE,CADH;AAEHC,YAAAA,GAAG,EAAE,CAFF;AAGHC,YAAAA,KAAK,EAAE;AAHJ;AAHuB,SAAlB,CAAhB;AASA,aAAKN,QAAL,CAAcxB,OAAd,CAAsB,UAAAC,GAAG,EAAI;AACzBpB,UAAAA,OAAO,CAACC,GAAR,CAAYmB,GAAZ,EADyB,CAEzB;AACH,SAHD;AAIA,aAAKuB,QAAL,CAAcO,QAAd,CAAuB,UAAAlB,GAAG,EAAI;AAC1B,UAAA,MAAI,CAACW,QAAL,CAAcG,KAAd,CAAoBE,GAApB,GAA0BN,OAAO,CAACS,YAAR,GAAuBnB,GAAG,CAACoB,MAA3B,GAAoC,EAA9D;AACA,UAAA,MAAI,CAACT,QAAL,CAAcG,KAAd,CAAoBC,IAApB,GAA2B,CAACL,OAAO,CAACW,WAAR,GAAsBrB,GAAG,CAACiB,KAA3B,IAAoC,CAA/D;AACH,SAHD;AAIH;AACJ;;AAAA,KA3BkB,CA2BjB;AACL,GAhNI;AAkNL;AACAK,EAAAA,aAAa,EAAE,yBAAY;AACvB/E,IAAAA,EAAE,CAAC0B,GAAH,CAAO,iBAAP;;AACA,QAAI,OAAQrB,EAAR,KAAgB,WAApB,EAAiC;AAC7B;AACA,UAAM0D,IAAI,GAAGpD,EAAE,CAACqD,iBAAH,EAAb;;AACA,UAAID,IAAI,CAACE,OAAL,CAAaC,WAAb,OAA+B,QAA/B,IAA2C3B,mBAAOC,QAAP,IAAmB,CAAlE,EAAqE;AACjE;AACH,OAFD,MAEO;AACH,aAAK4B,QAAL,CAAchB,IAAd;AACH;AACJ;;AAAA;AACJ,GA9NI;AA+NL4B,EAAAA,aAAa,EAAE,yBAAY;AACvBhF,IAAAA,EAAE,CAAC0B,GAAH,CAAO,eAAP;;AACA,QAAI,OAAQrB,EAAR,KAAgB,WAApB,EAAiC;AAC7B;AACA,UAAM0D,IAAI,GAAGpD,EAAE,CAACqD,iBAAH,EAAb;;AACA,UAAID,IAAI,CAACE,OAAL,CAAaC,WAAb,OAA+B,QAA/B,IAA2C3B,mBAAOC,QAAP,IAAmB,CAAlE,EAAqE;AACjE;AACH,OAFD,MAEO;AACH,aAAK4B,QAAL,CAAca,IAAd;AACH;AACJ;;AAAA;AACJ,GA1OI;AA6OLC,EAAAA,MA7OK,oBA6OI;AACL;AACA,SAAKhD,aAAL,GAAqBlC,EAAE,CAACmF,IAAH,CAAQ,SAAR,EAAmBC,YAAnB,CAAgC,YAAhC,CAArB;AACA,SAAKnC,aAAL,GAAqBjD,EAAE,CAACmF,IAAH,CAAQ,eAAR,EAAyBC,YAAzB,CAAsC,eAAtC,CAArB,CAHK,CAIL;;AACA,SAAK/C,SAAL;AACA,SAAKgD,KAAL,GAAa,IAAb,CANK,CAMc;;AACnB,SAAKlC,SAAL,GAAiB,IAAjB,CAPK,CAOkB;;AACvB,SAAKS,WAAL,GAAmB,IAAnB,CARK,CAQoB;;AACzB,SAAKtB,cAAL;AACA,SAAKiB,YAAL;AACA,SAAKO,SAAL;AACA,SAAK1D,UAAL;AAGH,GA5PI;AA8PLkF,EAAAA,KA9PK,mBA8PG,CAEP,CAhQI,CAkQL;;AAlQK,CAAT","sourceRoot":"/","sourcesContent":["import config from \"config\";\n/*\n    share_state :{\n        shared : \"已分享\"\n        un_share : \"未分享\"\n        share_succes :\"分享成功\"\n    };\n*/\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    //打开右上角3个点转发\n    open_share: function () {\n        if (typeof (wx) !== \"undefined\") {\n            //显示当前页面右上角的转发按钮\n            wx.showShareMenu({ withShareTicket: true })\n            wx.onShareAppMessage(function () {\n                return {\n                    //\n                }\n            });\n        };\n    },\n\n    //手动拉起转发调用\n    manual_share: function (tag) {\n        if (typeof (tt) !== \"undefined\") {\n            //记录是什么分享\n            this.share_tag = tag;\n            this.share_state = \"shared\";\n            this.share_time = new Date().getTime(); // 记录当前时间\n            let self = this;\n            switch (tag) {\n                case \"offline_profit\":\n                    tt.shareAppMessage({\n                        templateId: \"u764x7bp9v2d3k16ij\", // 替换成通过审核的分享ID\n                        title: \"Leisure farm, hang up\",\n                        desc: \"A relaxing and casual business simulation game。\",\n                        imageUrl: \"\",\n                        query: \"\",\n                        success() {\n                            console.log(\"分享视频成功\");\n                            self.share_sucess();\n                        },\n                        fail(e) {\n                            console.log(\"分享视频失败\");\n                            self.share_fail();\n                        }\n                    });\n                    break;\n                case \"pet\":\n                    tt.shareAppMessage({\n                        templateId: \"\", // 替换成通过审核的分享ID\n                        title: \"Do you like me?\",\n                        desc: \"I want this little pet, please click for me！\",\n                        imageUrl: \"\",\n                        query: \"\",\n                        success() {\n                            console.log(\"分享视频成功\");\n                            self.share_sucess();\n                        },\n                        fail(e) {\n                            console.log(\"分享视频失败\");\n                            self.share_fail();\n                        }\n                    });\n                    break;\n            };\n        };\n\n    },\n    //微信回到前台分享判断\n    share_judge: function () {\n        if (typeof (wx) !== \"undefined\") {\n            let self = this;\n            wx.onShow(function () {\n                //标签不能为空并且分享状态为已分享\n                if (self.share_state == \"shared\" && self.share_tag !== null) {\n                    var now_time = new Date().getTime();\n                    if (now_time - self.share_time >= 3000) {\n                        self.share_sucess(self.share_tag);\n                    } else {\n                        self.share_fail();\n                    };\n                } else {\n                    return;\n                }\n            });\n        }\n    },\n    //分享成功\n    share_sucess: function () {\n        this.share_state = \"share_succes\";\n        this.game_scene_js.create_tips_ui(this.game_scene_js.node, \"share_succes\");\n    },\n\n    //分享失败\n    share_fail: function () {\n        this.ini_share();\n        this.game_scene_js.create_tips_ui(this.game_scene_js.node, \"share_fail\");\n\n    },\n\n    //初始化分享\n    ini_share: function () {\n        this.share_tag = null; //分享的标签\n        this.share_time = null; //分享时的时间\n        this.share_state = \"un_share\";\n    },\n\n    //===========================================================\n    //===========================================================\n    //创建视频广告\n    create_videoAd: function () {\n        if (config.ad_state == 0) {\n            return;\n        };\n        if (typeof (wx) !== \"undefined\") {\n            //视频广告\n            this.video_ad = wx.createRewardedVideoAd({\n                adUnitId: '2oo60sjxld911grh25',//填上你的广告位id\n            });\n\n            //=======================================================\n            //=======================================================\n\n            //错误提示\n            this.video_ad.onError(err => {\n                this.ad_manageer = false;\n                console.log(err)\n            });\n        };\n    },\n    //展示视频广告\n    show_videoAd: function (name) {\n        if (config.ad_state == 0) {\n            return;\n        };\n        if (typeof (wx) !== \"undefined\") {\n            if (this.ad_manageer == false) {\n                //广告未开启\n            } else {\n                this.sound_control.pause_all_sound();\n            };\n            this.video_tag = name;\n            //无论有多少广告,只会返回一个实例\n            this.video_ad.show().catch(() => {\n                // 失败重试\n                this.video_ad.load()\n                    .then(() => this.video_ad.show(),\n                    )\n                    .catch(err => {\n                        console.log('激励视频 广告显示失败')\n                        this.game_scene_js.create_tips_ui(this.game_scene_js.node, \"video_wait\");\n                    })\n            })\n        };\n    },\n    //广告结束或退出\n    over_videoAd: function () {\n        if (config.ad_state == 0) {\n            return;\n        };\n        if (typeof (wx) !== \"undefined\") {\n            this.video_ad.onClose(res => {\n                // 用户点击了【关闭广告】按钮\n                // 小于 2.1.0 的基础库版本，res 是一个 undefined\n                if (res && res.isEnded || res === undefined) {\n                    // 正常播放结束，可以下发游戏奖励\n                    this.video_state = 1;// 1为成功，0为失败 2位播放结束\n                    this.sound_control.resume_all_sound();\n                }\n                else {\n                    // 播放中途退出，不下发游戏奖励\n                    this.sound_control.resume_all_sound();\n                    this.video_state = 0;\n                    this.game_scene_js.create_tips_ui(this.game_scene_js.node, \"video_exit\");\n                }\n            })\n        };\n    },\n    //创建banner广告\n    banner_ad: function () {\n        if (typeof (wx) !== \"undefined\") {\n            //抖音屏蔽banner\n            const info = tt.getSystemInfoSync();\n            if (info.appName.toUpperCase() === 'DOUYIN' || config.ad_state == 0) {\n                return;\n            } else {\n                // 创建 Banner 广告实例，提前初始化\n                let sysInfo = wx.getSystemInfoSync()\n                this.bannerAd = wx.createBannerAd({\n                    adUnitId: '6g3799b8gcb52y1dvi',\n                    adIntervals: 30,\n                    style: {\n                        left: 0,\n                        top: 0,\n                        width: 300,\n                    }\n                })\n                this.bannerAd.onError(err => {\n                    console.log(err)\n                    // this.show_push_ad(\"banner\");\n                });\n                this.bannerAd.onResize(res => {\n                    this.bannerAd.style.top = sysInfo.windowHeight - res.height - 10;\n                    this.bannerAd.style.left = (sysInfo.windowWidth - res.width) / 2;\n                })\n            }\n        };//end if\n    },\n\n    //展示banner\n    show_bannerAd: function () {\n        cc.log(\"create_bannerAD\");\n        if (typeof (wx) !== \"undefined\") {\n            //抖音屏蔽banner\n            const info = tt.getSystemInfoSync();\n            if (info.appName.toUpperCase() === 'DOUYIN' || config.ad_state == 0) {\n                return;\n            } else {\n                this.bannerAd.show();\n            }\n        };\n    },\n    hide_bannerAd: function () {\n        cc.log(\"hide_bannerAD\");\n        if (typeof (wx) !== \"undefined\") {\n            //抖音屏蔽banner\n            const info = tt.getSystemInfoSync();\n            if (info.appName.toUpperCase() === 'DOUYIN' || config.ad_state == 0) {\n                return;\n            } else {\n                this.bannerAd.hide();\n            }\n        };\n    },\n\n\n    onLoad() {\n        // cc.game.addPersistRootNode(this.node);\n        this.game_scene_js = cc.find(\"UI_ROOT\").getComponent(\"game_scene\");\n        this.sound_control = cc.find(\"sound_control\").getComponent(\"sound_control\");\n        // this.share_judge();\n        this.ini_share();\n        this.judge = null; // 判断是否分享成功\n        this.video_tag = null; //视频标签\n        this.video_state = null; //视频播放的状态 1位succes 0为fail\n        this.create_videoAd();\n        this.over_videoAd();\n        this.banner_ad();\n        this.open_share();\n\n\n    },\n\n    start() {\n\n    },\n\n    // update (dt) {},\n});\n"]}