{"version":3,"sources":["assets\\script\\ai\\staff_ai.js"],"names":["user_data","require","config","cc","Class","Component","properties","player_node","Node","pupple_node","staff_node","change_movement_direction","callback","stop_move","work_state","num","Math","floor","random","rest_direction","length","movement_direction","anim_select","all_direction","schedule","anim","getComponent","Animation","anim_clips","getClips","play","name","node","scaleX","ai_move","dt","s","move_speed","x","auto_work","land_js","parent","land_index","land","land_state","cut","water_num","water_charge","macro","REPEAT_FOREVER","work_schedule","work_time","staff","staff_index","skill","unschedule","now_time","Date","getTime","over_time","rest_schedule","on_staff_node_touch","sound_control","play_sound_effect","game_scene_js","create_rest_ui","on","rest_time","trader","recipes","active","off","ini_node","find","adsManager_js","staff_state","setPosition","onLoad","start","update"],"mappings":"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","sourceRoot":"/","sourcesContent":["var user_data = require(\"user_data\");\nvar config = require(\"config\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        player_node: cc.Node,\n        pupple_node: cc.Node,\n        staff_node: cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n    // 每隔几秒改变移动方向\n    change_movement_direction: function () {\n        var callback = function () {\n            this.stop_move = false;\n            if (this.work_state == \"rest\") {\n                var num = Math.floor(Math.random() * this.rest_direction.length - 1) + 1;\n                if (num < 0) {\n                    num = 0;\n                };\n                this.movement_direction = this.rest_direction[num];\n                this.anim_select();\n            } else {\n                var num = Math.floor(Math.random() * this.all_direction.length - 1) + 1;\n                if (num < 0) {\n                    num = 0;\n                };\n                this.movement_direction = this.all_direction[num];\n                this.anim_select();\n            };\n        };\n        this.schedule(callback, Math.random() * 3 + 2);\n    },\n    //anim select\n    anim_select: function () {\n        var anim = this.player_node.getComponent(cc.Animation);\n        var anim_clips = anim.getClips();//获取动画剪辑\n        switch (this.movement_direction) {\n            case \"z_idle\":\n                anim.play(anim_clips[0].name);\n                break;\n            case \"c_idle\":\n                anim.play(anim_clips[1].name);\n                break;\n            case \"c_run_l\":\n                this.node.scaleX = 1;\n                anim.play(anim_clips[2].name);\n                break;\n            case \"c_run_r\":\n                this.node.scaleX = -1;\n                anim.play(anim_clips[2].name);\n                break;\n        };\n    },\n    //随机某个方向移动\n    ai_move: function (dt) { //dt游戏时间\n        //得到每帧的速度\n        var s = this.move_speed * dt;\n        //\n        if (this.node.x <= -150 && this.stop_move == false) {\n            this.stop_move = true;\n            this.movement_direction = \"c_run_r\";\n            this.anim_select();\n        }\n        if (this.node.x >= 130 && this.stop_move == false) {\n            this.stop_move = true;\n            this.movement_direction = \"c_run_l\";\n            this.anim_select();\n\n        }\n        //几种不同的移动策略\n        switch (this.movement_direction) {\n            case \"z_idle\":\n                s = 0;\n                break;\n            case \"c_idle\":\n                s = 0;\n                break;\n            case \"c_run_l\":\n                this.node.x -= s;\n                break;\n            case \"c_run_r\":\n                this.node.x += s;\n                break;\n        };\n\n    },\n    //auto work\n    auto_work: function () {\n        var land_js = this.node.parent.getComponent(\"land\");\n        var land_index = land_js.land_index;\n        var callback = function () {\n            //工作状态工作\n            if (this.work_state == \"work\") {\n                switch (user_data.user_data.land[land_index].land_state) {\n                    case \"wait_cut\":\n                        land_js.cut();\n                        break;\n                    case \"grow\":\n                        if (user_data.user_data.land[land_index].water_num <= 0) {\n                            land_js.water_charge();\n                        };\n                        break;\n                    default:\n                        return;\n\n                };//end switch\n                // cc.log(\"工作中\");\n            } else {\n                return;\n            }; //end if\n\n        };\n        this.schedule(callback, 0.5, cc.macro.REPEAT_FOREVER);\n    },\n    //工作定时器\n    work_schedule: function () {\n\n        this.work_state = \"work\";\n\n        var work_time = config.staff[this.staff_index].work_time + user_data.user_data.skill[\"labor_contract\"];\n        var callback = function () {\n            work_time--;\n            if (work_time <= 0) {\n                this.unschedule(callback);\n                //停止工作计时器\n                // cc.log(this.staff_index, \"号休息\");\n                var now_time = new Date().getTime() / 1000;\n                user_data.user_data.staff[this.staff_index].over_time = now_time;\n                this.rest_schedule();\n            };//end if\n        };//end callback\n\n        this.schedule(callback, 1, cc.macro.REPEAT_FOREVER);\n    },\n    //休息时小人被点击\n    on_staff_node_touch() {\n        this.sound_control.play_sound_effect(\"button_click\");\n        this.game_scene_js.create_rest_ui(this.game_scene_js.node, this.staff_index);\n    },\n    //休息定时器\n    rest_schedule: function () {\n        this.work_state = \"rest\";\n        var callback = function () {\n            if (this.work_state == \"rest\") {\n\n                //启动监听事件\n                this.staff_node.on(\"touchstart\", this.on_staff_node_touch, this);\n                this.pupple_node.on(\"touchstart\", this.on_staff_node_touch, this)\n                var now_time = new Date().getTime() / 1000;\n                var over_time = user_data.user_data.staff[this.staff_index].over_time;\n                var rest_time = config.staff[this.staff_index].rest_time - user_data.user_data.trader.recipes;\n\n                //休息时间最小值为0\n                if (rest_time <= 0) {\n                    rest_time = 0;\n                };\n\n                //没有工作过就直接工作\n                if (over_time == 0) {\n                    this.work_schedule();\n                    this.pupple_node.active = false;\n                    this.unschedule(callback);\n                    return;\n                } else {\n                    if (now_time - over_time >= rest_time) {\n                        //休息结束\n                        // cc.log(this.staff_index, \"开始工作\");\n                        this.pupple_node.active = false;\n                        this.unschedule(callback);\n                        this.work_schedule();\n                        this.staff_node.off(\"touchstart\", this.on_staff_node_touch, this);\n                        this.pupple_node.on(\"touchstart\", this.on_staff_node_touch, this);\n                    } else {\n                        // cc.log(\"休息\");\n                        this.work_state = \"rest\";\n                        this.pupple_node.active = true;\n                    };//end if\n\n                };//end if\n\n            } else {\n                this.unschedule(callback);\n            };// end if\n\n        };\n        this.schedule(callback, 0.5, cc.macro.REPEAT_FOREVER);\n    },\n    ini_node: function (staff_index) {\n        this.game_scene_js = cc.find(\"UI_ROOT\").getComponent(\"game_scene\");;\n        this.sound_control = cc.find(\"sound_control\").getComponent(\"sound_control\");\n        this.adsManager_js = cc.find(\"UI_ROOT\").getComponent(\"AdsManager\");\n        this.staff_index = staff_index;\n        this.all_direction = [\"z_idle\", \"c_idle\", \"c_run_l\", \"c_run_r\"];\n        this.rest_direction = [\"z_idle\", \"c_idle\"];\n        this.movement_direction = \"z_idle\";\n        //小人的移动速度\n        this.move_speed = 30;\n        //停止移动，边缘时触发\n        this.stop_move = false;\n        this.staff_state = null;\n        this.work_state = null;\n        this.node.setPosition(0, -140);\n    },\n\n    onLoad() {\n\n    },\n\n    start() {\n        this.change_movement_direction();\n        this.anim_select();\n        this.rest_schedule();\n        this.auto_work();\n    },\n\n    update(dt) {\n        this.ai_move(dt);\n    },\n});\n"]}