{"version":3,"sources":["assets\\script\\ai\\pet_ai.js"],"names":["config","require","cc","Class","Component","properties","body_node","Node","change_movement_direction","callback","stop_move","num","Math","floor","random","all_direction","length","movement_direction","anim_select","schedule","anim","getComponent","Animation","anim_clips","getClips","play","name","node","scaleX","ai_move","dt","s","move_speed","x","y","onCollisionStay","other","self","zIndex","create_profit","pet_index","produce_ex_time","pet","produce_ex","user_data","have","game_rules_js","add_ex","ini_node","randomX","randomY","game_scene_js","find","onLoad","start","update"],"mappings":"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","sourceRoot":"/","sourcesContent":["var config = require(\"config\");\r\nimport user_data from \"user_data\";\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        body_node: cc.Node,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    // 每隔几秒改变移动方向\r\n    change_movement_direction: function () {\r\n        var callback = function () {\r\n            this.stop_move = false;\r\n            var num = Math.floor(Math.random() * this.all_direction.length - 1) + 1;\r\n            if (num < 0) {\r\n                num = 0;\r\n            };\r\n            this.movement_direction = this.all_direction[num];\r\n            this.anim_select();\r\n        };\r\n        this.schedule(callback, Math.random() * 3 + 2);\r\n    },\r\n    //anim select\r\n    anim_select: function () {\r\n        var anim = this.body_node.getComponent(cc.Animation);\r\n        var anim_clips = anim.getClips();//获取动画剪辑\r\n        switch (this.movement_direction) {\r\n            case \"z_idle\":\r\n                anim.play(anim_clips[0].name);\r\n                break;\r\n            case \"z_run\":\r\n                anim.play(anim_clips[1].name);\r\n                break;\r\n            case \"b_idle\":\r\n                anim.play(anim_clips[2].name);\r\n                break;\r\n            case \"b_run\":\r\n                anim.play(anim_clips[3].name);\r\n                break;\r\n            case \"c_idle\":\r\n                anim.play(anim_clips[4].name);\r\n                break;\r\n            case \"c_run_l\":\r\n                this.node.scaleX = 1;\r\n                anim.play(anim_clips[5].name);\r\n                break;\r\n            case \"c_run_r\":\r\n                this.node.scaleX = -1;\r\n                anim.play(anim_clips[5].name);\r\n                break;\r\n        };\r\n    },\r\n    //随机某个方向移动\r\n    ai_move: function (dt) { //dt游戏时间\r\n\r\n        //得到每帧的速度\r\n        var s = this.move_speed * dt;\r\n        //\r\n        if (this.node.x <= -65 && this.stop_move == false) {\r\n            this.stop_move = true;\r\n            this.movement_direction = \"c_run_r\";\r\n            this.anim_select();\r\n        }\r\n        if (this.node.x >= 65 && this.stop_move == false) {\r\n            this.stop_move = true;\r\n            this.movement_direction = \"c_run_l\";\r\n            this.anim_select();\r\n\r\n        }\r\n        if (this.node.y >= 290 && this.stop_move == false) {\r\n            this.stop_move = true;\r\n            this.movement_direction = \"z_run\";\r\n            this.anim_select();\r\n\r\n        }\r\n        if (this.node.y <= -529 && this.stop_move == false) {\r\n            this.stop_move = true;\r\n            this.movement_direction = \"b_run\";\r\n            this.anim_select();\r\n        }\r\n\r\n        //几种不同的移动策略\r\n        switch (this.movement_direction) {\r\n            case \"z_idle\":\r\n                s = 0;\r\n                break;\r\n            case \"z_run\":\r\n                this.node.y -= s;\r\n                break;\r\n            case \"b_idle\":\r\n                s = 0;\r\n                break;\r\n            case \"b_run\":\r\n                this.node.y += s;\r\n                break;\r\n            case \"c_idle\":\r\n                s = 0;\r\n                break;\r\n            case \"c_run_l\":\r\n                this.node.x -= s;\r\n                break;\r\n            case \"c_run_r\":\r\n                this.node.x += s;\r\n                break;\r\n        };\r\n\r\n    },\r\n    onCollisionStay: function (other, self) {\r\n        //碰撞产生了去调用该函数\r\n        if (self.node.y >= other.node.y) {\r\n            other.node.zIndex = 1;\r\n            self.node.zIndex = 0;\r\n        } else {\r\n            other.node.zIndex = 0;\r\n            self.node.zIndex = 1;\r\n        };\r\n    },\r\n    //自动销毁\r\n    // auto_destroy() {\r\n    //     var callback = function () {\r\n    //         var now_time = new Date().getTime();\r\n    //         if ((now_time - user_data.user_data.pet[this.pet_index].create_time) / 1000 >= config.pet[this.pet_index].stay_time) {\r\n    //             user_data.user_data.pet[this.pet_index].have = 0;\r\n    //             this.game_scene_js.create_tips_ui(this.game_scene_js.node,\"pet_leave\");\r\n    //             this.node.destroy();\r\n    //         };\r\n    //     };\r\n    //     this.schedule(callback, 1)\r\n    // },\r\n    //产出收益\r\n    create_profit() {\r\n        switch (this.node.name) {\r\n            case \"rabbit\":\r\n                this.pet_index = 0;\r\n                var produce_ex_time = config.pet[this.pet_index].produce_ex_time;\r\n                var produce_ex = config.pet[this.pet_index].produce_ex;\r\n                var callback = function () {\r\n                    var produce_ex = config.pet[this.pet_index].produce_ex;\r\n                    // for (var i = 0; i < produce_ex; i++) {\r\n                    //     this.game_scene_js.create_ex_effect(this.node, i);\r\n                    // };\r\n                    if (user_data.user_data.pet[this.pet_index].have == 1) {\r\n                        this.game_rules_js.add_ex(produce_ex);\r\n                    };\r\n                };\r\n                this.schedule(callback, produce_ex_time);\r\n                break;\r\n            case \"rabbit2\":\r\n                this.pet_index = 1;\r\n                var produce_ex_time = config.pet[this.pet_index].produce_ex_time;\r\n                var produce_ex = config.pet[this.pet_index].produce_ex;\r\n                var callback = function () {\r\n                    var produce_ex = config.pet[this.pet_index].produce_ex;\r\n                    // for (var i = 0; i < produce_ex; i++) {\r\n                    //     this.game_scene_js.create_ex_effect(this.node, i);\r\n                    // };\r\n                    if (user_data.user_data.pet[this.pet_index].have == 1) {\r\n                        this.game_rules_js.add_ex(produce_ex);\r\n                        // console.log(\"pet \" + this.pet_index + \" produce_ex: \" + produce_ex);\r\n                    };\r\n                };\r\n                this.schedule(callback, produce_ex_time);\r\n                break;\r\n            case \"xiaoba\":\r\n                this.pet_index = 2; \r\n                // this.auto_destroy();\r\n                var produce_ex_time = config.pet[this.pet_index].produce_ex_time;\r\n\r\n                var produce_ex = config.pet[this.pet_index].produce_ex;// lỗi NaN\r\n                var callback = function () {\r\n                    // var produce_ex = config.pet[this.pet_index].produce_ex;\r\n                    // for (var i = 0; i < produce_ex; i++) {\r\n                    //     this.game_scene_js.create_ex_effect(this.node, i);\r\n                    // };\r\n                    if (user_data.user_data.pet[this.pet_index].have == 1) {\r\n                        this.game_rules_js.add_ex(produce_ex);\r\n                        // console.log(\"pet \" + this.pet_index + \" produce_ex: \" + config.pet[this.pet_index].produce_ex);\r\n                    };\r\n                };\r\n                this.schedule(callback, produce_ex_time);\r\n                break;\r\n            case \"xiaoqi\":\r\n                this.pet_index = 3;\r\n                // this.auto_destroy();\r\n                var produce_ex_time = config.pet[this.pet_index].produce_ex_time;\r\n                var produce_ex = config.pet[this.pet_index].produce_ex;\r\n                var callback = function () {\r\n                    var produce_ex = config.pet[this.pet_index].produce_ex;\r\n                    if (user_data.user_data.pet[this.pet_index].have == 1) {\r\n                        this.game_rules_js.add_ex(produce_ex);\r\n                        // console.log(\"pet \" + this.pet_index + \" produce_ex: \" + produce_ex);\r\n                    };\r\n                };\r\n                this.schedule(callback, produce_ex_time);\r\n                break;\r\n        };\r\n    },\r\n    ini_node: function () {\r\n        var randomX = (Math.random() > 0.5 ? 1 : -1) * 100;\r\n        var randomY = (Math.random() > 0.5 ? 1 : -1) * 100;\r\n        this.node.x = randomX;\r\n        this.node.y = randomY\r\n        this.game_scene_js = cc.find(\"UI_ROOT\").getComponent(\"game_scene\");\r\n        this.all_direction = [\"z_idle\", \"z_run\", \"b_idle\", \"b_run\", \"c_idle\", \"c_run_l\", \"c_run_r\"];\r\n        this.movement_direction = \"z_idle\";\r\n        //小人的移动速度\r\n        this.move_speed = 30;\r\n        //停止移动，边缘时触发\r\n        this.stop_move = false;\r\n        this.create_profit();\r\n    },\r\n    onLoad() {\r\n        this.ini_node();\r\n        this.game_rules_js = cc.find(\"UI_ROOT\").getComponent(\"game_rules\");\r\n    },\r\n\r\n    start() {\r\n        this.change_movement_direction();\r\n        this.anim_select();\r\n    },\r\n\r\n    update(dt) {\r\n        this.ai_move(dt);\r\n    },\r\n});\r\n"]}