{"version":3,"sources":["assets\\script\\ai\\pet_ai.js"],"names":["config","require","cc","Class","Component","properties","body_node","Node","change_movement_direction","callback","stop_move","num","Math","floor","random","all_direction","length","movement_direction","anim_select","schedule","anim","getComponent","Animation","anim_clips","getClips","play","name","node","scaleX","ai_move","dt","s","move_speed","x","y","onCollisionStay","other","self","zIndex","create_profit","pet_index","produce_ex_time","pet","produce_ex","user_data","have","i","game_scene_js","create_ex_effect","ini_node","randomX","randomY","find","onLoad","game_rules_js","start","update"],"mappings":"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","sourceRoot":"/","sourcesContent":["var config = require(\"config\");\nimport user_data from \"user_data\";\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        body_node: cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n    // 每隔几秒改变移动方向\n    change_movement_direction: function () {\n        var callback = function () {\n            this.stop_move = false;\n            var num = Math.floor(Math.random() * this.all_direction.length - 1) + 1;\n            if (num < 0) {\n                num = 0;\n            };\n            this.movement_direction = this.all_direction[num];\n            this.anim_select();\n        };\n        this.schedule(callback, Math.random() * 3 + 2);\n    },\n    //anim select\n    anim_select: function () {\n        var anim = this.body_node.getComponent(cc.Animation);\n        var anim_clips = anim.getClips();//获取动画剪辑\n        switch (this.movement_direction) {\n            case \"z_idle\":\n                anim.play(anim_clips[0].name);\n                break;\n            case \"z_run\":\n                anim.play(anim_clips[1].name);\n                break;\n            case \"b_idle\":\n                anim.play(anim_clips[2].name);\n                break;\n            case \"b_run\":\n                anim.play(anim_clips[3].name);\n                break;\n            case \"c_idle\":\n                anim.play(anim_clips[4].name);\n                break;\n            case \"c_run_l\":\n                this.node.scaleX = 1;\n                anim.play(anim_clips[5].name);\n                break;\n            case \"c_run_r\":\n                this.node.scaleX = -1;\n                anim.play(anim_clips[5].name);\n                break;\n        };\n    },\n    //随机某个方向移动\n    ai_move: function (dt) { //dt游戏时间\n\n        //得到每帧的速度\n        var s = this.move_speed * dt;\n        //\n        if (this.node.x <= -65 && this.stop_move == false) {\n            this.stop_move = true;\n            this.movement_direction = \"c_run_r\";\n            this.anim_select();\n        }\n        if (this.node.x >= 65 && this.stop_move == false) {\n            this.stop_move = true;\n            this.movement_direction = \"c_run_l\";\n            this.anim_select();\n\n        }\n        if (this.node.y >= 290 && this.stop_move == false) {\n            this.stop_move = true;\n            this.movement_direction = \"z_run\";\n            this.anim_select();\n\n        }\n        if (this.node.y <= -529 && this.stop_move == false) {\n            this.stop_move = true;\n            this.movement_direction = \"b_run\";\n            this.anim_select();\n        }\n\n        //几种不同的移动策略\n        switch (this.movement_direction) {\n            case \"z_idle\":\n                s = 0;\n                break;\n            case \"z_run\":\n                this.node.y -= s;\n                break;\n            case \"b_idle\":\n                s = 0;\n                break;\n            case \"b_run\":\n                this.node.y += s;\n                break;\n            case \"c_idle\":\n                s = 0;\n                break;\n            case \"c_run_l\":\n                this.node.x -= s;\n                break;\n            case \"c_run_r\":\n                this.node.x += s;\n                break;\n        };\n\n    },\n    onCollisionStay: function (other, self) {\n        //碰撞产生了去调用该函数\n        if (self.node.y >= other.node.y) {\n            other.node.zIndex = 1;\n            self.node.zIndex = 0;\n        } else {\n            other.node.zIndex = 0;\n            self.node.zIndex = 1;\n        };\n    },\n    //自动销毁\n    // auto_destroy() {\n    //     var callback = function () {\n    //         var now_time = new Date().getTime();\n    //         if ((now_time - user_data.user_data.pet[this.pet_index].create_time) / 1000 >= config.pet[this.pet_index].stay_time) {\n    //             user_data.user_data.pet[this.pet_index].have = 0;\n    //             this.game_scene_js.create_tips_ui(this.game_scene_js.node,\"pet_leave\");\n    //             this.node.destroy();\n    //         };\n    //     };\n    //     this.schedule(callback, 1)\n    // },\n    //产出收益\n    create_profit() {\n        switch (this.node.name) {\n            case \"rabbit\":\n                this.pet_index = 0;\n                var produce_ex_time = config.pet[this.pet_index].produce_ex_time;\n                var produce_ex = config.pet[this.pet_index].produce_ex;\n                var callback = function () {\n                    var produce_ex = config.pet[this.pet_index].produce_ex;\n                    // for (var i = 0; i < produce_ex; i++) {\n                    //     this.game_scene_js.create_ex_effect(this.node, i);\n                    // };\n                    if (user_data.user_data.pet[this.pet_index].have == 1) {\n                        for (var i = 0; i < produce_ex; i++) {\n                            this.game_scene_js.create_ex_effect(this.node, i);\n                        };\n                    };\n                };\n                this.schedule(callback, produce_ex_time);\n                break;\n            case \"rabbit2\":\n                this.pet_index = 1;\n                var produce_ex_time = config.pet[this.pet_index].produce_ex_time;\n                var produce_ex = config.pet[this.pet_index].produce_ex;\n                var callback = function () {\n                    var produce_ex = config.pet[this.pet_index].produce_ex;\n                    // for (var i = 0; i < produce_ex; i++) {\n                    //     this.game_scene_js.create_ex_effect(this.node, i);\n                    // };\n                    if (user_data.user_data.pet[this.pet_index].have == 1) {\n                        for (var i = 0; i < produce_ex; i++) {\n                            this.game_scene_js.create_ex_effect(this.node, i);\n                        };\n                        // console.log(\"pet \" + this.pet_index + \" produce_ex: \" + produce_ex);\n                    };\n                };\n                this.schedule(callback, produce_ex_time);\n                break;\n            case \"xiaoba\":\n                this.pet_index = 2; \n                // this.auto_destroy();\n                var produce_ex_time = config.pet[this.pet_index].produce_ex_time;\n\n                var produce_ex = config.pet[this.pet_index].produce_ex;// lỗi NaN\n                var callback = function () {\n                    // var produce_ex = config.pet[this.pet_index].produce_ex;\n                    // for (var i = 0; i < produce_ex; i++) {\n                    //     this.game_scene_js.create_ex_effect(this.node, i);\n                    // };\n                    if (user_data.user_data.pet[this.pet_index].have == 1) {\n                        for (var i = 0; i < produce_ex; i++) {\n                            this.game_scene_js.create_ex_effect(this.node, i);\n                        };\n                        // console.log(\"pet \" + this.pet_index + \" produce_ex: \" + config.pet[this.pet_index].produce_ex);\n                    };\n                };\n                this.schedule(callback, produce_ex_time);\n                break;\n            case \"xiaoqi\":\n                this.pet_index = 3;\n                // this.auto_destroy();\n                var produce_ex_time = config.pet[this.pet_index].produce_ex_time;\n                var produce_ex = config.pet[this.pet_index].produce_ex;\n                var callback = function () {\n                    var produce_ex = config.pet[this.pet_index].produce_ex;\n                    if (user_data.user_data.pet[this.pet_index].have == 1) {\n                        for (var i = 0; i < produce_ex; i++) {\n                            this.game_scene_js.create_ex_effect(this.node, i);\n                        };\n                        // console.log(\"pet \" + this.pet_index + \" produce_ex: \" + produce_ex);\n                    };\n                };\n                this.schedule(callback, produce_ex_time);\n                break;\n        };\n    },\n    ini_node: function () {\n        var randomX = (Math.random() > 0.5 ? 1 : -1) * 100;\n        var randomY = (Math.random() > 0.5 ? 1 : -1) * 100;\n        this.node.x = randomX;\n        this.node.y = randomY\n        this.game_scene_js = cc.find(\"UI_ROOT\").getComponent(\"game_scene\");\n        this.all_direction = [\"z_idle\", \"z_run\", \"b_idle\", \"b_run\", \"c_idle\", \"c_run_l\", \"c_run_r\"];\n        this.movement_direction = \"z_idle\";\n        //小人的移动速度\n        this.move_speed = 30;\n        //停止移动，边缘时触发\n        this.stop_move = false;\n        this.create_profit();\n    },\n    onLoad() {\n        this.ini_node();\n        this.game_rules_js = cc.find(\"UI_ROOT\").getComponent(\"game_rules\");\n    },\n\n    start() {\n        this.change_movement_direction();\n        this.anim_select();\n    },\n\n    update(dt) {\n        this.ai_move(dt);\n    },\n});\n"]}