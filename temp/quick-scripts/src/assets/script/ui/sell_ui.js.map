{"version":3,"sources":["assets\\script\\ui\\sell_ui.js"],"names":["user_data","require","config","cc","Class","Component","properties","box_frame_arr","SpriteFrame","icon_group_node","Node","label_group_node","lock_group_node","ini_node","game_scene_js","find","getComponent","game_rules_js","ad_control","sound_control","show_bannerAd","set_sell","button_unlock_click","e","custom","sum_gold","sum_diamond","i","wareHouse","have","type_buy","cost","gold","diamond","create_tips_ui","node","auto_sell","time_auto","auto","schedule","all_capacity","children","length","count","Label","string","active","id_product","Sprite","spriteFrame","touch_exit","play_sound_effect","hide_bannerAd","on_node_kill","set_estimate_label","sum","sell","plant","estimate_label","on_sell_button_click","j","add_gold","on_double_sell_button_click","show_videoAd","video_succes","wx","callback","video_state","video_tag","unschedule","onLoad","start"],"mappings":";;;;;;AAAA,IAAIA,SAAS,GAAGC,OAAO,CAAC,WAAD,CAAvB;;AACA,IAAIC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAApB;;AACAE,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAGLC,EAAAA,UAAU,EAAE;AACRC,IAAAA,aAAa,EAAE,CAACJ,EAAE,CAACK,WAAJ,CADP;AAERC,IAAAA,eAAe,EAAEN,EAAE,CAACO,IAFZ;AAGRC,IAAAA,gBAAgB,EAAER,EAAE,CAACO,IAHb;AAIR;AACAE,IAAAA,eAAe,EAAET,EAAE,CAACO;AALZ,GAHP;AAWL;AACAG,EAAAA,QAAQ,EAAE,oBAAY;AAClB,SAAKC,aAAL,GAAqBX,EAAE,CAACY,IAAH,CAAQ,SAAR,EAAmBC,YAAnB,CAAgC,YAAhC,CAArB;AACA,SAAKC,aAAL,GAAqBd,EAAE,CAACY,IAAH,CAAQ,SAAR,EAAmBC,YAAnB,CAAgC,YAAhC,CAArB;AACA,SAAKE,UAAL,GAAkBf,EAAE,CAACY,IAAH,CAAQ,YAAR,EAAsBC,YAAtB,CAAmC,YAAnC,CAAlB;AACA,SAAKG,aAAL,GAAqBhB,EAAE,CAACY,IAAH,CAAQ,eAAR,EAAyBC,YAAzB,CAAsC,eAAtC,CAArB;AACA,SAAKE,UAAL,CAAgBE,aAAhB;AACA,SAAKC,QAAL,GANkB,CAOlB;AACH,GApBI;AAqBLC,EAAAA,mBArBK,+BAqBeC,CArBf,EAqBkBC,MArBlB,EAqB0B;AAAS;AACpC,QAAIC,QAAQ,GAAG,CAAf;AACA,QAAIC,WAAW,GAAG,CAAlB;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAIH,MAArB,EAA6BG,CAAC,EAA9B,EAAkC;AAE9B,UAAI3B,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BD,CAA9B,EAAiCE,IAAjC,IAAyC,CAA7C,EAAgD;AAC5C,YAAI7B,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BD,CAA9B,EAAiCG,QAAjC,IAA6C,MAAjD,EACIL,QAAQ,IAAIzB,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BD,CAA9B,EAAiCI,IAA7C,CADJ,KAEKL,WAAW,IAAI1B,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BD,CAA9B,EAAiCI,IAAhD;AACR;AACJ;;AACD,QAAI/B,SAAS,CAACA,SAAV,CAAoBgC,IAApB,IAA4BP,QAA5B,IAAwCzB,SAAS,CAACA,SAAV,CAAoBiC,OAApB,IAA+BP,WAA3E,EAAwF;AACpF1B,MAAAA,SAAS,CAACA,SAAV,CAAoBgC,IAApB,IAA4BP,QAA5B;AACAzB,MAAAA,SAAS,CAACA,SAAV,CAAoBiC,OAApB,IAA+BP,WAA/B;AACH,KAHD,MAKA;AACI,WAAKZ,aAAL,CAAmBoB,cAAnB,CAAkC,KAAKpB,aAAL,CAAmBqB,IAArD,EAA2D,eAA3D;AACH;AACJ,GAxCI;AAyCLC,EAAAA,SAAS,EAAE,qBAAY;AAAK;AACxB,QAAIC,SAAS,GAAG,KAAK,EAArB;;AAEA,QAAIC,IAAI,GAAG,SAAPA,IAAO,GAAY;AACnBD,MAAAA,SAAS,IAAG,GAAZ;AACH,KAFD;;AAGA,SAAKE,QAAL,CAAcD,IAAd,EAAoB,GAApB;AACH,GAhDI;AAiDLjB,EAAAA,QAAQ,EAAE,oBAAY;AAClB,QAAImB,YAAY,GAAG,EAAnB;;AACA,SAAK,IAAIb,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlB,eAAL,CAAqBgC,QAArB,CAA8BC,MAAlD,EAA0Df,CAAC,EAA3D,EAA+D;AAC3D,UAAI3B,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BD,CAA9B,EAAiCE,IAAjC,IAAyC,CAA7C,EAAgD;AAC5C,YAAIc,KAAK,GAAG3C,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BD,CAA9B,EAAiCgB,KAA7C;AACA,aAAKhC,gBAAL,CAAsB8B,QAAtB,CAA+Bd,CAA/B,EAAkCX,YAAlC,CAA+Cb,EAAE,CAACyC,KAAlD,EAAyDC,MAAzD,GAAkEF,KAAK,GAAG,GAAR,GAAcH,YAAhF;AACA,aAAK5B,eAAL,CAAqB6B,QAArB,CAA8Bd,CAA9B,EAAiCmB,MAAjC,GAA0C,KAA1C;;AAEA,YAAIH,KAAK,GAAG,CAAZ,EAAe;AACX,cAAII,UAAU,GAAG/C,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BD,CAA9B,EAAiCoB,UAAlD;AACA,eAAKtC,eAAL,CAAqBgC,QAArB,CAA8Bd,CAA9B,EAAiCX,YAAjC,CAA8Cb,EAAE,CAAC6C,MAAjD,EAAyDC,WAAzD,GAAuE,KAAK1C,aAAL,CAAmBwC,UAAnB,CAAvE;AACH,SAHD,MAIK;AACD,eAAKtC,eAAL,CAAqBgC,QAArB,CAA8Bd,CAA9B,EAAiCX,YAAjC,CAA8Cb,EAAE,CAAC6C,MAAjD,EAAyDC,WAAzD,GAAuE,KAAK1C,aAAL,CAAmB,CAAnB,CAAvE;AACH;AACJ,OAZD,MAaK;AACD,aAAKI,gBAAL,CAAsB8B,QAAtB,CAA+Bd,CAA/B,EAAkCX,YAAlC,CAA+Cb,EAAE,CAACyC,KAAlD,EAAyDC,MAAzD,GAAkE,EAAlE;AACA,aAAKjC,eAAL,CAAqB6B,QAArB,CAA8Bd,CAA9B,EAAiCmB,MAAjC,GAA0C,IAA1C;AACA,aAAKrC,eAAL,CAAqBgC,QAArB,CAA8Bd,CAA9B,EAAiCX,YAAjC,CAA8Cb,EAAE,CAAC6C,MAAjD,EAAyDxC,WAAzD,GAAuE,KAAKD,aAAL,CAAmB,CAAnB,CAAvE;AACH;AAEJ;AACJ,GAxEI;AAyEL2C,EAAAA,UAAU,EAAE,sBAAY;AACpB,SAAK/B,aAAL,CAAmBgC,iBAAnB,CAAqC,aAArC;AACA,SAAKjC,UAAL,CAAgBkC,aAAhB;AACA,SAAKtC,aAAL,CAAmBuC,YAAnB,CAAgC,KAAKlB,IAArC;AACH,GA7EI;AA8EL;AACAmB,EAAAA,kBAAkB,EAAE,8BAAY;AAC5B,QAAIC,GAAG,GAAG,CAAV;;AACA,SAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlB,eAAL,CAAqBgC,QAArB,CAA8BC,MAAlD,EAA0Df,CAAC,EAA3D,EAA+D;AAC3D,UAAIgB,KAAK,GAAG3C,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BD,CAA9B,EAAiCgB,KAA7C;AACA,UAAIa,IAAI,GAAGtD,MAAM,CAACuD,KAAP,CAAa9B,CAAb,EAAgB6B,IAA3B;AACAD,MAAAA,GAAG,IAAIZ,KAAK,GAAGa,IAAf;AACH;;AAAA;AACD,SAAKE,cAAL,CAAoBb,MAApB,GAA6B,uBAAuBU,GAApD;AACH,GAvFI;AAwFL;AACAI,EAAAA,oBAAoB,EAAE,gCAAY;AAC9B,SAAKxC,aAAL,CAAmBgC,iBAAnB,CAAqC,cAArC;AACA,QAAII,GAAG,GAAG,CAAV;;AACA,SAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlB,eAAL,CAAqBgC,QAArB,CAA8BC,MAAlD,EAA0Df,CAAC,EAA3D,EAA+D;AAC3D,UAAIgB,KAAK,GAAG3C,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BD,CAA9B,EAAiCgB,KAA7C;AACA,UAAII,UAAU,GAAG/C,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BD,CAA9B,EAAiCoB,UAAlD,CAF2D,CAEE;;AAC7D,UAAIA,UAAU,GAAG,CAAjB,EAAoB;AACpB,UAAIS,IAAI,GAAGtD,MAAM,CAACuD,KAAP,CAAaV,UAAb,EAAyBS,IAApC;AACAD,MAAAA,GAAG,IAAIZ,KAAK,GAAGa,IAAf;AACH;;AAAA;;AACD,QAAID,GAAG,IAAI,CAAX,EAAc;AACV,WAAKzC,aAAL,CAAmBoB,cAAnB,CAAkC,KAAKjB,aAAL,CAAmBkB,IAArD,EAA2D,SAA3D;AACH,KAFD,MAEO;AACH,WAAK,IAAIyB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKnD,eAAL,CAAqBgC,QAArB,CAA8BC,MAAlD,EAA0DkB,CAAC,EAA3D,EAA+D;AAC3D5D,QAAAA,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BgC,CAA9B,EAAiCjB,KAAjC,GAAyC,CAAzC;AACH;;AAAA;AACD,WAAK7B,aAAL,CAAmBoB,cAAnB,CAAkC,KAAKjB,aAAL,CAAmBkB,IAArD,EAA2D,MAA3D,EAAmEoB,GAAnE;AACA,WAAKtC,aAAL,CAAmB4C,QAAnB,CAA4BN,GAA5B;AACA,WAAKlC,QAAL;AACH;;AAAA;AACJ,GA7GI;AA8GL;AACAyC,EAAAA,2BA/GK,yCA+GyB;AAC1B,SAAK3C,aAAL,CAAmBgC,iBAAnB,CAAqC,cAArC;AACA,QAAII,GAAG,GAAG,CAAV;;AACA,SAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlB,eAAL,CAAqBgC,QAArB,CAA8BC,MAAlD,EAA0Df,CAAC,EAA3D,EAA+D;AAC3D,UAAIgB,KAAK,GAAG3C,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BD,CAA9B,EAAiCgB,KAA7C;AACA,UAAIa,IAAI,GAAGtD,MAAM,CAACuD,KAAP,CAAa9B,CAAb,EAAgB6B,IAA3B;AACAD,MAAAA,GAAG,IAAIZ,KAAK,GAAGa,IAAf;AACH;;AAAA,KAPyB,CAQ1B;;AACA,QAAID,GAAG,IAAI,CAAX,EAAc;AACV,WAAKzC,aAAL,CAAmBoB,cAAnB,CAAkC,KAAKjB,aAAL,CAAmBkB,IAArD,EAA2D,SAA3D;AACH,KAFD,MAEO;AACH,WAAKjB,UAAL,CAAgB6C,YAAhB,CAA6B,aAA7B;AACA,WAAKC,YAAL;AACH;;AAAA;AACJ,GA9HI;AA+HL;AACAA,EAAAA,YAAY,EAAE,wBAAY;AACtB,QAAI,OAAQC,EAAR,IAAe,WAAnB,EAAgC;AAC5B,UAAIC,QAAQ,GAAG,SAAXA,QAAW,GAAY;AACvB,YAAI,KAAKhD,UAAL,CAAgBiD,WAAhB,IAA+B,CAA/B,IAAoC,KAAKjD,UAAL,CAAgBkD,SAAhB,IAA6B,aAArE,EAAoF;AAChF,eAAKlD,UAAL,CAAgBkD,SAAhB,GAA4B,IAA5B;AACA,eAAKlD,UAAL,CAAgBiD,WAAhB,GAA8B,CAA9B;AACA,cAAIZ,GAAG,GAAG,CAAV;;AACA,eAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlB,eAAL,CAAqBgC,QAArB,CAA8BC,MAAlD,EAA0Df,CAAC,EAA3D,EAA+D;AAC3D,gBAAIgB,KAAK,GAAG3C,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BD,CAA9B,EAAiCgB,KAA7C;AACA,gBAAIa,IAAI,GAAGtD,MAAM,CAACuD,KAAP,CAAa9B,CAAb,EAAgB6B,IAA3B;AACAD,YAAAA,GAAG,IAAIZ,KAAK,GAAGa,IAAf;AACH;;AAAA;;AACD,eAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKnD,eAAL,CAAqBgC,QAArB,CAA8BC,MAAlD,EAA0DkB,CAAC,EAA3D,EAA+D;AAC3D5D,YAAAA,SAAS,CAACA,SAAV,CAAoB4B,SAApB,CAA8BgC,CAA9B,EAAiCjB,KAAjC,GAAyC,CAAzC;AACH;;AAAA;AACD,eAAK7B,aAAL,CAAmBoB,cAAnB,CAAkC,KAAKjB,aAAL,CAAmBkB,IAArD,EAA2D,MAA3D,EAAmEoB,GAAG,GAAG,CAAzE;AACA,eAAKtC,aAAL,CAAmB4C,QAAnB,CAA4BN,GAAG,GAAG,CAAlC;AACA,eAAKlC,QAAL;AACA,eAAKgD,UAAL,CAAgBH,QAAhB;AACH,SAhBD,MAgBO;AACH,cAAI,KAAKhD,UAAL,CAAgBkD,SAAhB,IAA6B,IAA7B,IAAqC,KAAKlD,UAAL,CAAgBiD,WAAhB,IAA+B,CAAxE,EAA2E;AACvE,iBAAKE,UAAL,CAAgBH,QAAhB;AACH;;AAAA;AACJ;;AAAA;AACJ,OAtBD;;AAuBA,WAAK3B,QAAL,CAAc2B,QAAd,EAAwB,GAAxB;AACH;;AAAA;AACJ,GA3JI;AA4JLI,EAAAA,MA5JK,oBA4JI,CAER,CA9JI;AAgKLC,EAAAA,KAhKK,mBAgKG,CAEP,CAlKI,CAoKL;;AApKK,CAAT","sourceRoot":"/","sourcesContent":["var user_data = require(\"user_data\");\nvar config = require(\"config\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        box_frame_arr: [cc.SpriteFrame],\n        icon_group_node: cc.Node,\n        label_group_node: cc.Node,\n        // estimate_label: cc.Label,\n        lock_group_node: cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n    ini_node: function () {\n        this.game_scene_js = cc.find(\"UI_ROOT\").getComponent(\"game_scene\");\n        this.game_rules_js = cc.find(\"UI_ROOT\").getComponent(\"game_rules\");\n        this.ad_control = cc.find(\"ad_control\").getComponent(\"ad_control\");\n        this.sound_control = cc.find(\"sound_control\").getComponent(\"sound_control\");\n        this.ad_control.show_bannerAd();\n        this.set_sell();\n        // this.set_estimate_label();\n    },\n    button_unlock_click(e, custom) {        // button mở kho\n        var sum_gold = 0;\n        var sum_diamond = 0;\n        for (var i = 0; i <= custom; i++) {\n\n            if (user_data.user_data.wareHouse[i].have == 0) {\n                if (user_data.user_data.wareHouse[i].type_buy == \"gold\")\n                    sum_gold += user_data.user_data.wareHouse[i].cost;\n                else sum_diamond += user_data.user_data.wareHouse[i].cost;\n            }\n        }\n        if (user_data.user_data.gold >= sum_gold && user_data.user_data.diamond >= sum_diamond) {\n            user_data.user_data.gold -= sum_gold;\n            user_data.user_data.diamond -= sum_diamond;\n        }\n        else \n        {\n            this.game_scene_js.create_tips_ui(this.game_scene_js.node, \"no_money_gold\");\n        }\n    },\n    auto_sell: function () {    // tự động bán hàng trong kho\n        var time_auto = 60 * 60;\n\n        var auto = function () {\n            time_auto -=0.1;\n        };\n        this.schedule(auto, 0.1);\n    },\n    set_sell: function () {\n        var all_capacity = 30;\n        for (var i = 0; i < this.icon_group_node.children.length; i++) {\n            if (user_data.user_data.wareHouse[i].have == 1) {\n                let count = user_data.user_data.wareHouse[i].count;\n                this.label_group_node.children[i].getComponent(cc.Label).string = count + \"/\" + all_capacity;\n                this.lock_group_node.children[i].active = false;\n\n                if (count > 0) {\n                    var id_product = user_data.user_data.wareHouse[i].id_product;\n                    this.icon_group_node.children[i].getComponent(cc.Sprite).spriteFrame = this.box_frame_arr[id_product];\n                }\n                else {\n                    this.icon_group_node.children[i].getComponent(cc.Sprite).spriteFrame = this.box_frame_arr[8];\n                }\n            }\n            else {\n                this.label_group_node.children[i].getComponent(cc.Label).string = '';\n                this.lock_group_node.children[i].active = true;\n                this.icon_group_node.children[i].getComponent(cc.Sprite).SpriteFrame = this.box_frame_arr[8];\n            }\n\n        }\n    },\n    touch_exit: function () {\n        this.sound_control.play_sound_effect(\"button_exit\");\n        this.ad_control.hide_bannerAd();\n        this.game_scene_js.on_node_kill(this.node);\n    },\n    //设置预计卖出文字\n    set_estimate_label: function () {\n        var sum = 0;\n        for (var i = 0; i < this.icon_group_node.children.length; i++) {\n            var count = user_data.user_data.wareHouse[i].count;\n            var sell = config.plant[i].sell;\n            sum += count * sell;\n        };\n        this.estimate_label.string = \"Expected to sell: \" + sum;\n    },\n    //普通卖出\n    on_sell_button_click: function () {\n        this.sound_control.play_sound_effect(\"button_click\");\n        var sum = 0;\n        for (var i = 0; i < this.icon_group_node.children.length; i++) {\n            var count = user_data.user_data.wareHouse[i].count;\n            var id_product = user_data.user_data.wareHouse[i].id_product;// lấy id của cây trong mỗi kho\n            if (id_product > 7) continue;\n            var sell = config.plant[id_product].sell;\n            sum += count * sell;\n        };\n        if (sum == 0) {\n            this.game_scene_js.create_tips_ui(this.game_rules_js.node, \"no_sell\");\n        } else {\n            for (var j = 0; j < this.icon_group_node.children.length; j++) {\n                user_data.user_data.wareHouse[j].count = 0;\n            };\n            this.game_scene_js.create_tips_ui(this.game_rules_js.node, \"gold\", sum);\n            this.game_rules_js.add_gold(sum);\n            this.set_sell();\n        };\n    },\n    //double_sell_button_click\n    on_double_sell_button_click() {\n        this.sound_control.play_sound_effect(\"button_click\");\n        var sum = 0;\n        for (var i = 0; i < this.icon_group_node.children.length; i++) {\n            var count = user_data.user_data.wareHouse[i].count;\n            var sell = config.plant[i].sell;\n            sum += count * sell;\n        };\n        //如果没有可卖的则不能卖出\n        if (sum == 0) {\n            this.game_scene_js.create_tips_ui(this.game_rules_js.node, \"no_sell\");\n        } else {\n            this.ad_control.show_videoAd(\"double_sell\");\n            this.video_succes();\n        };\n    },\n    //检测视频是否播放成功\n    video_succes: function () {\n        if (typeof (wx) != \"undefined\") {\n            var callback = function () {\n                if (this.ad_control.video_state == 1 && this.ad_control.video_tag == \"double_sell\") {\n                    this.ad_control.video_tag = null;\n                    this.ad_control.video_state = 2;\n                    var sum = 0;\n                    for (var i = 0; i < this.icon_group_node.children.length; i++) {\n                        var count = user_data.user_data.wareHouse[i].count;\n                        var sell = config.plant[i].sell;\n                        sum += count * sell;\n                    };\n                    for (var j = 0; j < this.icon_group_node.children.length; j++) {\n                        user_data.user_data.wareHouse[j].count = 0;\n                    };\n                    this.game_scene_js.create_tips_ui(this.game_rules_js.node, \"gold\", sum * 2);\n                    this.game_rules_js.add_gold(sum * 2);\n                    this.set_sell();\n                    this.unschedule(callback);\n                } else {\n                    if (this.ad_control.video_tag == null && this.ad_control.video_state == 2) {\n                        this.unschedule(callback);\n                    };\n                };\n            };\n            this.schedule(callback, 0.2);\n        };\n    },\n    onLoad() {\n\n    },\n\n    start() {\n\n    },\n\n    // update (dt) {},\n});\n"]}