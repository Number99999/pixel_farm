{"version":3,"sources":["assets\\script\\ui\\videotape_ui.js"],"names":["cc","Class","Component","properties","gold_lable","Label","ex_label","tips_label","button_frame","Sprite","button_frame_arr","SpriteFrame","purse_node","Node","ex_node","delete_button","Button","ini_node","game_rules_js","find","getComponent","game_scene_js","sound_control","ad_control","adsManager","show_bannerAd","add_gold","Math","floor","user_data","skill","add_ex","level","videotape_path","spriteFrame","node","active","string","today","Date","save_date","getDate","watch_video","on_button_click","log","showRewardedVideo","create_tips_ui","on_delete_button_click","video_share","wx","self","shareAppMessage","channel","title","extra","videoPath","videoTopics","success","console","videotape_share_succes","fail","videotape_share_fail","parent","touch_exit","play_sound_effect","hide_bannerAd","on_node_kill","add_gold_video","start"],"mappings":"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","sourceRoot":"/","sourcesContent":["import user_data from \"user_data\";\nimport config from \"config\";\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        gold_lable: cc.Label,\n        ex_label: cc.Label,\n        tips_label: cc.Label,\n        button_frame: cc.Sprite,\n        button_frame_arr: [cc.SpriteFrame],\n        purse_node: cc.Node,\n        ex_node: cc.Node,\n        delete_button: cc.Button,\n    },\n    //初始化节点\n    ini_node() {\n        this.game_rules_js = cc.find(\"UI_ROOT\").getComponent(\"game_rules\");\n        this.game_scene_js = cc.find(\"UI_ROOT\").getComponent(\"game_scene\");\n        this.sound_control = cc.find(\"sound_control\").getComponent(\"sound_control\");\n        this.ad_control = cc.find(\"ad_control\").getComponent(\"ad_control\");\n        this.adsManager = cc.find(\"UI_ROOT\").getComponent(\"AdsManager\");\n        this.ad_control.show_bannerAd();\n        this.add_gold = Math.floor(((500 * user_data.user_data.skill[\"gold_max\"] + 500)) / 20) + 1;\n        this.add_ex = Math.floor(user_data.user_data.level / 10) + 1;\n\n        if (this.game_rules_js.videotape_path == null) {\n            //录屏未录制\n            this.button_frame.spriteFrame = this.button_frame_arr[0];\n            this.delete_button.node.active = false;\n        } else {\n            //录屏已录制\n            this.button_frame.spriteFrame = this.button_frame_arr[1];\n            this.delete_button.node.active = true;\n        };\n        this.gold_lable.string = \"+\" + this.add_gold;\n        this.ex_label.string = \"+\" + this.add_ex;\n        var today = new Date();\n        if (user_data.user_data.save_date == today.getDate())\n            this.tips_label.string = \"Watched: \" + user_data.user_data.watch_video + \"/3\";\n        else this.tips_label.string = \"Watched: 0/3\"\n    },\n\n    //按钮被点击\n    on_button_click() {\n        var today = new Date();\n        if (today.getDate() == user_data.user_data.save_date && user_data.user_data.watch_video < 3) {\n            cc.log(\"=======48=======\");\n            this.adsManager.showRewardedVideo(() => {\n                user_data.user_data.watch_video++;\n                cc.log(\"=======50=======\");\n                this.tips_label.string = \"Watched: \" + user_data.user_data.watch_video + \"/3\";\n                user_data.user_data.save_date = today.getDate();\n            });\n\n        }\n        else if (today.getDate() != user_data.user_data.save_date) {\n            this.adsManager.showRewardedVideo(() => {\n                cc.log(\"=======59=======\");\n                watch_video = 1;\n                this.tips_label.string = \"Watched: \" + user_data.user_data.watch_video + \"/3\";\n                user_data.user_data.save_date = today.getDate();\n            });\n\n            cc.log(\"====65====\");\n        }\n        else this.game_scene_js.create_tips_ui(this.game_rules_js.node, \"no_video_today\");\n    },\n\n\n    on_delete_button_click() {\n        this.game_rules_js.videotape_path = null;\n        this.game_scene_js.create_tips_ui(this.game_rules_js.node, \"vidotape_cancel\");\n        this.ini_node();\n    },\n    //录屏分享\n    video_share: function () {\n        if (typeof (wx) !== \"undefined\") {\n            if (this.game_rules_js.videotape_path == null) {\n                return;\n            };\n            let self = this;\n            //获取分享导语\n            wx.shareAppMessage({\n                channel: 'video',  //指定为视频分享\n                title: 'On-Hook Small Farm',\n                extra: {\n                    videoPath: this.game_rules_js.videotape_path,// 设置视频路径\n                    videoTopics: [\"On-Hook Small Farm\", \"Game\"]\n                },\n                success: () => {\n                    //分享回调\n                    console.log('录屏分享成功');\n                    //分享奖励，仅一次\n                    self.videotape_share_succes();\n                },\n                fail: () => {\n                    console.log('录屏分享失败', this.videotape_path);\n                    self.videotape_share_fail();\n                }\n            });\n        };\n    },\n    //录屏分享成功\n    // videotape_share_succes: function () {\n    //     this.game_scene_js.create_tips_ui(this.node.parent, \"videotape_share_succes\");\n    //     this.game_rules_js.videotape_path = null;\n    //     user_data.user_data.videotape_share_count++;\n    //     var gold = Math.floor(this.add_gold / 6);\n    //     var ex = Math.floor(this.add_ex / 3);\n    //     for (var i = 0; i < 6; i++) {\n    //         this.game_scene_js.create_gold_effect(this.purse_node, i, gold);\n    //     };\n    //     for (var i = 0; i < 5; i++) {\n    //         this.game_scene_js.create_ex_effect(this.ex_node, i, ex);\n    //     };\n    //     this.ini_node();\n\n    // },\n    //录屏分享失败\n    videotape_share_fail: function () {\n        this.game_scene_js.create_tips_ui(this.node.parent, \"videotape_share_fail\");\n        this.ini_node();\n    },\n    //点击退出\n    touch_exit() {\n        this.sound_control.play_sound_effect(\"button_exit\");\n        this.ad_control.hide_bannerAd();\n        this.game_scene_js.on_node_kill(this.node);\n    },\n    // onLoad () {},\n\n    add_gold_video: function () {\n        this.game_rules_js.add_gold(Math.floor(((500 * user_data.user_data.skill[\"gold_max\"] + 500)) / 20) + 1);\n    },\n    start() {\n\n    },\n\n    // update (dt) {},\n});\n"]}