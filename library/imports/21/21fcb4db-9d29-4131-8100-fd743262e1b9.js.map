{"version":3,"sources":["assets\\script\\ui\\videotape_ui.js"],"names":["cc","Class","Component","properties","gold_lable","Label","ex_label","tips_label","button_frame","Sprite","button_frame_arr","SpriteFrame","purse_node","Node","ex_node","delete_button","Button","ini_node","game_rules_js","find","getComponent","game_scene_js","sound_control","ad_control","adsManager_js","add_gold","Math","floor","user_data","skill","add_ex","level","videotape_path","spriteFrame","node","active","string","today","Date","save_date","getDate","watch_video","on_button_click","showRewardedVideo","create_tips_ui","on_delete_button_click","video_share","wx","self","shareAppMessage","channel","title","extra","videoPath","videoTopics","success","console","log","videotape_share_succes","fail","videotape_share_fail","parent","touch_exit","play_sound_effect","on_node_kill","add_gold_video","start"],"mappings":"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","sourceRoot":"/","sourcesContent":["import user_data from \"user_data\";\r\nimport config from \"config\";\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        gold_lable: cc.Label,\r\n        ex_label: cc.Label,\r\n        tips_label: cc.Label,\r\n        button_frame: cc.Sprite,\r\n        button_frame_arr: [cc.SpriteFrame],\r\n        purse_node: cc.Node,\r\n        ex_node: cc.Node,\r\n        delete_button: cc.Button,\r\n    },\r\n    //初始化节点\r\n    ini_node() {\r\n        this.game_rules_js = cc.find(\"UI_ROOT\").getComponent(\"game_rules\");\r\n        this.game_scene_js = cc.find(\"UI_ROOT\").getComponent(\"game_scene\");\r\n        this.sound_control = cc.find(\"sound_control\").getComponent(\"sound_control\");\r\n        this.ad_control = cc.find(\"ad_control\").getComponent(\"ad_control\");\r\n        this.adsManager_js = cc.find(\"UI_ROOT\").getComponent(\"AdsManager\");\r\n        this.add_gold = Math.floor(((500 * user_data.user_data.skill[\"gold_max\"] + 500)) / 20) + 1;\r\n        this.add_ex = Math.floor(user_data.user_data.level / 10) + 1;\r\n\r\n        if (this.game_rules_js.videotape_path == null) {\r\n            //录屏未录制\r\n            this.button_frame.spriteFrame = this.button_frame_arr[0];\r\n            this.delete_button.node.active = false;\r\n        } else {\r\n            //录屏已录制\r\n            this.button_frame.spriteFrame = this.button_frame_arr[1];\r\n            this.delete_button.node.active = true;\r\n        };\r\n        this.gold_lable.string = \"+\" + this.add_gold;\r\n        this.ex_label.string = \"+\" + this.add_ex;\r\n        var today = new Date();\r\n        if (user_data.user_data.save_date == today.getDate())\r\n            this.tips_label.string = \"Watched: \" + user_data.user_data.watch_video + \"/3\";\r\n        else this.tips_label.string = \"Watched: 0/3\"\r\n    },\r\n\r\n    //按钮被点击\r\n    on_button_click() {\r\n        var today = new Date();\r\n        if (today.getDate() == user_data.user_data.save_date && user_data.user_data.watch_video < 3) {\r\n            this.adsManager_js.showRewardedVideo(() => {\r\n                user_data.user_data.watch_video++;\r\n                this.tips_label.string = \"Watched: \" + user_data.user_data.watch_video + \"/3\";\r\n                user_data.user_data.save_date = today.getDate();\r\n                this.game_rules_js.add_gold(Math.floor(((500 * user_data.user_data.skill[\"gold_max\"] + 500)) / 20) + 1);\r\n                this.game_rules_js.add_ex(Math.floor(user_data.user_data.level / 10) + 1);\r\n            });\r\n\r\n        }\r\n        else if (today.getDate() != user_data.user_data.save_date) {\r\n            this.adsManager_js.showRewardedVideo(() => {\r\n                watch_video = 1;\r\n                this.tips_label.string = \"Watched: \" + user_data.user_data.watch_video + \"/3\";\r\n                user_data.user_data.save_date = today.getDate();\r\n            });\r\n        }\r\n        else this.game_scene_js.create_tips_ui(this.game_rules_js.node, \"no_video_today\");\r\n    },\r\n\r\n\r\n    on_delete_button_click() {\r\n        this.game_rules_js.videotape_path = null;\r\n        this.game_scene_js.create_tips_ui(this.game_rules_js.node, \"vidotape_cancel\");\r\n        this.ini_node();\r\n    },\r\n    //录屏分享\r\n    video_share: function () {\r\n        if (typeof (wx) !== \"undefined\") {\r\n            if (this.game_rules_js.videotape_path == null) {\r\n                return;\r\n            };\r\n            let self = this;\r\n            //获取分享导语\r\n            wx.shareAppMessage({\r\n                channel: 'video',  //指定为视频分享\r\n                title: 'On-Hook Small Farm',\r\n                extra: {\r\n                    videoPath: this.game_rules_js.videotape_path,// 设置视频路径\r\n                    videoTopics: [\"On-Hook Small Farm\", \"Game\"]\r\n                },\r\n                success: () => {\r\n                    //分享回调\r\n                    console.log('录屏分享成功');\r\n                    //分享奖励，仅一次\r\n                    self.videotape_share_succes();\r\n                },\r\n                fail: () => {\r\n                    console.log('录屏分享失败', this.videotape_path);\r\n                    self.videotape_share_fail();\r\n                }\r\n            });\r\n        };\r\n    },\r\n    //录屏分享成功\r\n    // videotape_share_succes: function () {\r\n    //     this.game_scene_js.create_tips_ui(this.node.parent, \"videotape_share_succes\");\r\n    //     this.game_rules_js.videotape_path = null;\r\n    //     user_data.user_data.videotape_share_count++;\r\n    //     var gold = Math.floor(this.add_gold / 6);\r\n    //     var ex = Math.floor(this.add_ex / 3);\r\n    //     for (var i = 0; i < 6; i++) {\r\n    //         this.game_scene_js.create_gold_effect(this.purse_node, i, gold);\r\n    //     };\r\n    //     for (var i = 0; i < 5; i++) {\r\n    //         this.game_scene_js.create_ex_effect(this.ex_node, i, ex);\r\n    //     };\r\n    //     this.ini_node();\r\n\r\n    // },\r\n    //录屏分享失败\r\n    videotape_share_fail: function () {\r\n        this.game_scene_js.create_tips_ui(this.node.parent, \"videotape_share_fail\");\r\n        this.ini_node();\r\n    },\r\n    //点击退出\r\n    touch_exit() {\r\n        this.sound_control.play_sound_effect(\"button_exit\");\r\n        this.game_scene_js.on_node_kill(this.node);\r\n    },\r\n    // onLoad () {},\r\n\r\n    add_gold_video: function () {\r\n        this.game_rules_js.add_gold(Math.floor(((500 * user_data.user_data.skill[\"gold_max\"] + 500)) / 20) + 1);\r\n    },\r\n    start() {\r\n\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}