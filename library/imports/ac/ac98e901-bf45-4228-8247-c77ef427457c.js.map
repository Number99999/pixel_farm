{"version":3,"sources":["assets\\script\\loading_scene.js"],"names":["cc","Class","Component","properties","loadingBar","type","ProgressBar","work_label","Label","progress_label","center_node","Node","load_Succes","tween","to","opacity","easing","call","director","loadScene","start","ini_node","progress","on_load_progress","self","preloadScene","completedCount","totalCount","item","string","parseInt","error","asset","log","rest_load_game","dt","time","rest_count","node","active","onLoad","update"],"mappings":";;;;;;AAAAA,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAELC,EAAAA,UAAU,EAAE;AACRC,IAAAA,UAAU,EAAE;AACRC,MAAAA,IAAI,EAAEL,EAAE,CAACM,WADD;AAER,iBAAS;AAFD,KADJ;AAKRC,IAAAA,UAAU,EAAE;AACRF,MAAAA,IAAI,EAAEL,EAAE,CAACQ,KADD;AAER,iBAAS;AAFD,KALJ;AASRC,IAAAA,cAAc,EAAET,EAAE,CAACQ,KATX;AAURE,IAAAA,WAAW,EAAEV,EAAE,CAACW;AAVR,GAFP;AAeL;AACAC,EAAAA,WAAW,EAAE,uBAAY;AACrBZ,IAAAA,EAAE,CAACa,KAAH,CAAS,KAAKH,WAAd,EACKI,EADL,CACQ,GADR,EACa;AAAEC,MAAAA,OAAO,EAAE;AAAX,KADb,EAC6B;AAAEC,MAAAA,MAAM,EAAE;AAAV,KAD7B,EAEKC,IAFL,CAEU,YAAM;AACRjB,MAAAA,EAAE,CAACkB,QAAH,CAAYC,SAAZ,CAAsB,YAAtB;AACH,KAJL,EAKKC,KALL;AAMH,GAvBI;AAyBLC,EAAAA,QAAQ,EAAE,oBAAY;AAClB,SAAKjB,UAAL,CAAgBkB,QAAhB,GAA2B,CAA3B;AACA,SAAKC,gBAAL;AACH,GA5BI;AA6BL;AACAA,EAAAA,gBAAgB,EAAE,4BAAY;AAC1B,QAAIC,IAAI,GAAG,IAAX;AACAxB,IAAAA,EAAE,CAACkB,QAAH,CAAYO,YAAZ,CAAyB,YAAzB,EAAuC,UAACC,cAAD,EAAiBC,UAAjB,EAA6BC,IAA7B,EAAsC;AACzE,UAAIF,cAAc,GAAGC,UAAjB,GAA8BH,IAAI,CAACpB,UAAL,CAAgBkB,QAAlD,EAA4D;AACxDE,QAAAA,IAAI,CAACpB,UAAL,CAAgBkB,QAAhB,GAA2BI,cAAc,GAAGC,UAA5C;AACAH,QAAAA,IAAI,CAACf,cAAL,CAAoBoB,MAApB,GAA6BC,QAAQ,CAAEJ,cAAc,GAAGC,UAAlB,GAAgC,GAAjC,CAAR,GAAgD,GAA7E;AAEH;;AAAA,OALwE,CAMzE;AACH,KAPD,EAOG,UAAUI,KAAV,EAAiBC,KAAjB,EAAwB;AACvB,UAAID,KAAJ,EAAW;AACP/B,QAAAA,EAAE,CAACiC,GAAH,CAAO,MAAP;AACA;AACH,OAHD,MAGO;AACHT,QAAAA,IAAI,CAACZ,WAAL;AACAZ,QAAAA,EAAE,CAACiC,GAAH,CAAO,MAAP;AACH;;AAAA;AACJ,KAfD;AAgBH,GAhDI;AAkDL;AACAC,EAAAA,cAAc,EAAE,wBAAUC,EAAV,EAAc;AAC1B,SAAKC,IAAL,IAAaD,EAAb;;AACA,QAAI,KAAKC,IAAL,IAAa,EAAjB,EAAqB;AACjB,WAAKA,IAAL,GAAY,CAAZ;AACA,WAAKC,UAAL;AACA,WAAK9B,UAAL,CAAgBsB,MAAhB,GAAyB,aAAzB;;AACA,UAAI,KAAKQ,UAAL,IAAmB,CAAvB,EAA0B;AACtB,aAAK5B,cAAL,CAAoB6B,IAApB,CAAyBC,MAAzB,GAAkC,KAAlC;AACA,aAAKhC,UAAL,CAAgBsB,MAAhB,GAAyB,gCAAzB;AACH;;AAAA;AACD,WAAKR,QAAL;AACH;AACJ,GA/DI;AAgELmB,EAAAA,MAhEK,oBAgEI;AACL,SAAKJ,IAAL,GAAY,CAAZ;AACA,SAAKC,UAAL,GAAkB,CAAlB;AACA,SAAKhB,QAAL;AACH,GApEI;AAsELD,EAAAA,KAtEK,mBAsEG,CAEP,CAxEI;AA0ELqB,EAAAA,MA1EK,kBA0EEN,EA1EF,EA0EM;AACP,SAAKD,cAAL,CAAoBC,EAApB;AACH;AA5EI,CAAT","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        loadingBar: {\r\n            type: cc.ProgressBar,\r\n            default: null,\r\n        },\r\n        work_label: {\r\n            type: cc.Label,\r\n            default: null,\r\n        },\r\n        progress_label: cc.Label,\r\n        center_node: cc.Node,\r\n    },\r\n\r\n    //加载成功\r\n    load_Succes: function () {\r\n        cc.tween(this.center_node)\r\n            .to(0.5, { opacity: 0 }, { easing: \"sineOut\" })\r\n            .call(() => {\r\n                cc.director.loadScene(\"game_scene\");\r\n            })\r\n            .start();\r\n    },\r\n\r\n    ini_node: function () {\r\n        this.loadingBar.progress = 0;\r\n        this.on_load_progress();\r\n    },\r\n    //加载进度条\r\n    on_load_progress: function () {\r\n        var self = this;\r\n        cc.director.preloadScene(\"game_scene\", (completedCount, totalCount, item) => {\r\n            if (completedCount / totalCount > self.loadingBar.progress) {\r\n                self.loadingBar.progress = completedCount / totalCount;\r\n                self.progress_label.string = parseInt((completedCount / totalCount) * 100) + \"%\";\r\n\r\n            };\r\n            // self.loadingBar.width = 350* (completedCount/totalCount);\r\n        }, function (error, asset) {\r\n            if (error) {\r\n                cc.log(\"加载失败\");\r\n                return;\r\n            } else {\r\n                self.load_Succes();\r\n                cc.log(\"加载成功\");\r\n            };\r\n        })\r\n    },\r\n\r\n    //重新加载游戏\r\n    rest_load_game: function (dt) {\r\n        this.time += dt;\r\n        if (this.time >= 15) {\r\n            this.time = 0;\r\n            this.rest_count++;\r\n            this.work_label.string = \"正在尝试重新加载...\";\r\n            if (this.rest_count >= 2) {\r\n                this.progress_label.node.active = false;\r\n                this.work_label.string = \"由于网络波动加载失败，请清除缓存后重新进入~o(╥﹏╥)o~\"\r\n            };\r\n            this.ini_node();\r\n        }\r\n    },\r\n    onLoad() {\r\n        this.time = 0;\r\n        this.rest_count = 0;\r\n        this.ini_node();\r\n    },\r\n\r\n    start() {\r\n\r\n    },\r\n\r\n    update(dt) {\r\n        this.rest_load_game(dt);\r\n    },\r\n});\r\n"]}