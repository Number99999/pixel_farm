{"version":3,"sources":["assets\\script\\ai\\player_role.js"],"names":["cc","Class","Component","properties","player_node","Node","gift_node","gift_frame_arr","SpriteFrame","change_movement_direction","callback","stop_move","num","Math","floor","random","all_direction","length","movement_direction","anim_select","schedule","anim","getComponent","Animation","anim_clips","getClips","play","name","node","scaleX","ai_move","dt","s","move_speed","x","y","on_gift_button_click","sound_control","play_sound_effect","random_ex","gift_type","i","game_scene_js","create_ex_effect","active","create_gift_ui","ini_node","find","create_gift","random_num","Sprite","spriteFrame","hide_gift","scheduleOnce","onLoad","start","update"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        player_node: cc.Node,\r\n        gift_node: cc.Node,\r\n        gift_frame_arr: [cc.SpriteFrame],\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    // 每隔几秒改变移动方向\r\n    change_movement_direction: function () {\r\n        var callback = function () {\r\n            this.stop_move = false;\r\n            var num = Math.floor(Math.random() * this.all_direction.length - 1) + 1;\r\n            if (num < 0) {\r\n                num = 0;\r\n            };\r\n            this.movement_direction = this.all_direction[num];\r\n            this.anim_select();\r\n        };\r\n        this.schedule(callback, Math.random() * 3 + 2);\r\n    },\r\n    //anim select\r\n    anim_select: function () {\r\n        var anim = this.player_node.getComponent(cc.Animation);\r\n        var anim_clips = anim.getClips();//获取动画剪辑\r\n        switch (this.movement_direction) {\r\n            case \"z_idle\":\r\n                anim.play(anim_clips[0].name);\r\n                break;\r\n            case \"z_run\":\r\n                anim.play(anim_clips[1].name);\r\n                break;\r\n            case \"b_idle\":\r\n                anim.play(anim_clips[2].name);\r\n                break;\r\n            case \"b_run\":\r\n                anim.play(anim_clips[3].name);\r\n                break;\r\n            case \"c_idle\":\r\n                anim.play(anim_clips[4].name);\r\n                break;\r\n            case \"c_run_l\":\r\n                this.node.scaleX = 1;\r\n                anim.play(anim_clips[5].name);\r\n                break;\r\n            case \"c_run_r\":\r\n                this.node.scaleX = -1;\r\n                anim.play(anim_clips[5].name);\r\n                break;\r\n        };\r\n    },\r\n    //随机某个方向移动\r\n    ai_move: function (dt) { //dt游戏时间\r\n\r\n        //得到每帧的速度\r\n        var s = this.move_speed * dt;\r\n        //\r\n        if (this.node.x <= -65 && this.stop_move == false) {\r\n            this.stop_move = true;\r\n            this.movement_direction = \"c_run_r\";\r\n            this.anim_select();\r\n        }\r\n        if (this.node.x >= 65 && this.stop_move == false) {\r\n            this.stop_move = true;\r\n            this.movement_direction = \"c_run_l\";\r\n            this.anim_select();\r\n\r\n        }\r\n        if (this.node.y >= 290 && this.stop_move == false) {\r\n            this.stop_move = true;\r\n            this.movement_direction = \"z_run\";\r\n            this.anim_select();\r\n\r\n        }\r\n        if (this.node.y <= -529 && this.stop_move == false) {\r\n            this.stop_move = true;\r\n            this.movement_direction = \"b_run\";\r\n            this.anim_select();\r\n        }\r\n\r\n        //几种不同的移动策略\r\n        switch (this.movement_direction) {\r\n            case \"z_idle\":\r\n                s = 0;\r\n                break;\r\n            case \"z_run\":\r\n                this.node.y -= s;\r\n                break;\r\n            case \"b_idle\":\r\n                s = 0;\r\n                break;\r\n            case \"b_run\":\r\n                this.node.y += s;\r\n                break;\r\n            case \"c_idle\":\r\n                s = 0;\r\n                break;\r\n            case \"c_run_l\":\r\n                this.node.x -= s;\r\n                break;\r\n            case \"c_run_r\":\r\n                this.node.x += s;\r\n                break;\r\n        };\r\n\r\n    },\r\n    //按钮被点击\r\n    on_gift_button_click() {\r\n        this.sound_control.play_sound_effect(\"button_click\");\r\n        var random_ex = Math.floor(Math.random() * 10) + 1;\r\n        //最大值为6\r\n        if(random_ex >6){\r\n            random_ex = 6;\r\n        };\r\n        switch (this.gift_type) {\r\n            case \"ex\":\r\n                for (var i = 0; i < random_ex; i++) {\r\n                    this.game_scene_js.create_ex_effect(this.gift_node, i);\r\n                };\r\n                this.gift_type = null;\r\n                this.gift_node.active = false;\r\n                break;\r\n            case \"ad\":\r\n                this.gift_type = null;\r\n                this.gift_node.active = false;\r\n                this.game_scene_js.create_gift_ui(this.game_scene_js.node);\r\n                break;\r\n        };\r\n    },\r\n    ini_node: function () {\r\n        this.game_scene_js = cc.find(\"UI_ROOT\").getComponent(\"game_scene\");\r\n        this.sound_control = cc.find(\"sound_control\").getComponent(\"sound_control\");\r\n        this.all_direction = [\"z_idle\", \"z_run\", \"b_idle\", \"b_run\", \"c_idle\", \"c_run_l\", \"c_run_r\"];\r\n        this.movement_direction = \"z_idle\";\r\n        //小人的移动速度\r\n        this.move_speed = 30;\r\n        this.gift_node.active = false;\r\n        this.gift_type = null;\r\n        //停止移动，边缘时触发\r\n        this.stop_move = false;\r\n        this.create_gift();\r\n    },\r\n    //生成礼物\r\n    create_gift() {\r\n        var callback = function () {\r\n            var random_num = Math.random();\r\n            if (random_num > 0.5) {\r\n                this.gift_type = \"ex\";\r\n                this.gift_node.active = true;\r\n                this.gift_node.getComponent(cc.Sprite).spriteFrame = this.gift_frame_arr[0];\r\n            } else {\r\n                this.gift_type = \"ad\";\r\n                this.gift_node.active = true;\r\n                this.gift_node.getComponent(cc.Sprite).spriteFrame = this.gift_frame_arr[1];\r\n\r\n            };\r\n            this.hide_gift();\r\n        };\r\n        this.schedule(callback, 30);\r\n    },\r\n    //隐藏礼物\r\n    hide_gift() {\r\n        //10s后隐藏礼物\r\n        var callback = function () {\r\n            this.gift_node.active = false;\r\n            this.gift_type = null;\r\n        };\r\n        this.scheduleOnce(callback, 10);\r\n    },\r\n    onLoad() {\r\n        this.ini_node();\r\n    },\r\n\r\n    start() {\r\n        this.change_movement_direction();\r\n        this.anim_select();\r\n    },\r\n\r\n    update(dt) {\r\n        this.ai_move(dt);\r\n    },\r\n});"]}