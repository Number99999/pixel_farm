{"version":3,"sources":["assets\\script\\ai\\staff_ai.js"],"names":["user_data","require","config","cc","Class","Component","properties","player_node","Node","pupple_node","staff_node","progess_bar","change_movement_direction","callback","stop_move","work_state","num","Math","floor","random","rest_direction","length","movement_direction","anim_select","all_direction","schedule","anim","getComponent","Animation","anim_clips","getClips","play","name","node","scaleX","ai_move","dt","s","move_speed","x","auto_work","land_js","parent","land_index","land","land_state","cut","water_num","water_charge","macro","REPEAT_FOREVER","work_schedule","work_time","staff","staff_index","skill","unschedule","now_time","Date","getTime","over_time","rest_schedule","on_staff_node_touch","sound_control","play_sound_effect","game_scene_js","create_rest_ui","on","rest_time","trader","recipes","active","off","ini_node","find","adsManager_js","staff_state","setPosition","onLoad","start","update"],"mappings":"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","sourceRoot":"/","sourcesContent":["var user_data = require(\"user_data\");\r\nvar config = require(\"config\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        player_node: cc.Node,\r\n        pupple_node: cc.Node,\r\n        staff_node: cc.Node,\r\n        progess_bar: cc.Node,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    // 每隔几秒改变移动方向\r\n    change_movement_direction: function () {\r\n        var callback = function () {\r\n            this.stop_move = false;\r\n            if (this.work_state == \"rest\") {\r\n                var num = Math.floor(Math.random() * this.rest_direction.length - 1) + 1;\r\n                if (num < 0) {\r\n                    num = 0;\r\n                };\r\n                this.movement_direction = this.rest_direction[num];\r\n                this.anim_select();\r\n            } else {\r\n                var num = Math.floor(Math.random() * this.all_direction.length - 1) + 1;\r\n                if (num < 0) {\r\n                    num = 0;\r\n                };\r\n                this.movement_direction = this.all_direction[num];\r\n                this.anim_select();\r\n            };\r\n        };\r\n        this.schedule(callback, Math.random() * 3 + 2);\r\n    },\r\n    //anim select\r\n    anim_select: function () {\r\n        var anim = this.player_node.getComponent(cc.Animation);\r\n        var anim_clips = anim.getClips();//获取动画剪辑\r\n        switch (this.movement_direction) {\r\n            case \"z_idle\":\r\n                anim.play(anim_clips[0].name);\r\n                break;\r\n            case \"c_idle\":\r\n                anim.play(anim_clips[1].name);\r\n                break;\r\n            case \"c_run_l\":\r\n                this.node.scaleX = 1;\r\n                anim.play(anim_clips[2].name);\r\n                break;\r\n            case \"c_run_r\":\r\n                this.node.scaleX = -1;\r\n                anim.play(anim_clips[2].name);\r\n                break;\r\n        };\r\n    },\r\n    //随机某个方向移动\r\n    ai_move: function (dt) { //dt游戏时间\r\n        //得到每帧的速度\r\n        var s = this.move_speed * dt;\r\n        //\r\n        if (this.node.x <= -150 && this.stop_move == false) {\r\n            this.stop_move = true;\r\n            this.movement_direction = \"c_run_r\";\r\n            this.anim_select();\r\n        }\r\n        if (this.node.x >= 130 && this.stop_move == false) {\r\n            this.stop_move = true;\r\n            this.movement_direction = \"c_run_l\";\r\n            this.anim_select();\r\n\r\n        }\r\n        //几种不同的移动策略\r\n        switch (this.movement_direction) {\r\n            case \"z_idle\":\r\n                s = 0;\r\n                break;\r\n            case \"c_idle\":\r\n                s = 0;\r\n                break;\r\n            case \"c_run_l\":\r\n                this.node.x -= s;\r\n                break;\r\n            case \"c_run_r\":\r\n                this.node.x += s;\r\n                break;\r\n        };\r\n\r\n    },\r\n    //auto work\r\n    auto_work: function () {\r\n        var land_js = this.node.parent.getComponent(\"land\");\r\n        var land_index = land_js.land_index;\r\n        var callback = function () {\r\n            //工作状态工作\r\n            if (this.work_state == \"work\") {\r\n                switch (user_data.user_data.land[land_index].land_state) {\r\n                    case \"wait_cut\":\r\n                        land_js.cut();\r\n                        break;\r\n                    case \"grow\":\r\n                        if (user_data.user_data.land[land_index].water_num <= 0) {\r\n                            land_js.water_charge();\r\n                        };\r\n                        break;\r\n                    default:\r\n                        return;\r\n\r\n                };//end switch\r\n                // cc.log(\"工作中\");\r\n            } else {\r\n                return;\r\n            }; //end if\r\n\r\n        };\r\n        this.schedule(callback, 0.5, cc.macro.REPEAT_FOREVER);\r\n    },\r\n    //工作定时器\r\n    work_schedule: function () {\r\n\r\n        this.work_state = \"work\";\r\n\r\n        var work_time = config.staff[this.staff_index].work_time + user_data.user_data.skill[\"labor_contract\"];\r\n        var callback = function () {\r\n            work_time--;\r\n            if (work_time <= 0) {\r\n                this.unschedule(callback);\r\n                //停止工作计时器\r\n                // cc.log(this.staff_index, \"号休息\");\r\n                var now_time = new Date().getTime() / 1000;\r\n                user_data.user_data.staff[this.staff_index].over_time = now_time;\r\n                this.rest_schedule();\r\n            };//end if\r\n        };//end callback\r\n\r\n        this.schedule(callback, 1, cc.macro.REPEAT_FOREVER);\r\n    },\r\n    //休息时小人被点击\r\n    on_staff_node_touch() {\r\n        this.sound_control.play_sound_effect(\"button_click\");\r\n        this.game_scene_js.create_rest_ui(this.game_scene_js.node, this.staff_index);\r\n    },\r\n    //休息定时器\r\n    rest_schedule: function () {\r\n        this.work_state = \"rest\";\r\n        var callback = function () {\r\n            if (this.work_state == \"rest\") {\r\n\r\n                //nghe ev\r\n                this.staff_node.on(\"touchstart\", this.on_staff_node_touch, this);\r\n                this.pupple_node.on(\"touchstart\", this.on_staff_node_touch, this)\r\n                var now_time = new Date().getTime() / 1000;\r\n                var over_time = user_data.user_data.staff[this.staff_index].over_time;\r\n                var rest_time = config.staff[this.staff_index].rest_time - user_data.user_data.trader.recipes;\r\n\r\n                // tgian nghỉ min là 0\r\n                if (rest_time <= 0) {\r\n                    rest_time = 0;\r\n                };\r\n\r\n                //làm việc\r\n                if (over_time == 0) {\r\n                    this.work_schedule();\r\n                    this.pupple_node.active = false;\r\n                    this.unschedule(callback);\r\n                    return;\r\n                } else {\r\n                    if (now_time - over_time >= rest_time) {\r\n                        //hết nghỉ giải lao\r\n                        // cc.log(this.staff_index, \"开始工作\");\r\n                        this.pupple_node.active = false;\r\n                        this.unschedule(callback);\r\n                        this.work_schedule();\r\n                        this.staff_node.off(\"touchstart\", this.on_staff_node_touch, this);\r\n                        this.pupple_node.on(\"touchstart\", this.on_staff_node_touch, this);\r\n                    } else {\r\n                        // cc.log(\"休息\");\r\n                        this.work_state = \"rest\";\r\n                        this.pupple_node.active = true;\r\n\r\n                    };//end if\r\n\r\n                };//end if\r\n\r\n            } else {\r\n                this.unschedule(callback);\r\n            };// end if\r\n\r\n        };\r\n        this.schedule(callback, 0.1, cc.macro.REPEAT_FOREVER);\r\n    },\r\n    ini_node: function (staff_index) {\r\n        this.game_scene_js = cc.find(\"UI_ROOT\").getComponent(\"game_scene\");;\r\n        this.sound_control = cc.find(\"sound_control\").getComponent(\"sound_control\");\r\n        this.adsManager_js = cc.find(\"UI_ROOT\").getComponent(\"AdsManager\");\r\n        this.staff_index = staff_index;\r\n        this.all_direction = [\"z_idle\", \"c_idle\", \"c_run_l\", \"c_run_r\"];\r\n        this.rest_direction = [\"z_idle\", \"c_idle\"];\r\n        this.movement_direction = \"z_idle\";\r\n        //小人的移动速度\r\n        this.move_speed = 30;\r\n        //停止移动，边缘时触发\r\n        this.stop_move = false;\r\n        this.staff_state = null;\r\n        this.work_state = null;\r\n        this.node.setPosition(0, -140);\r\n    },\r\n\r\n    onLoad() {\r\n\r\n    },\r\n\r\n    start() {\r\n        this.change_movement_direction();\r\n        this.anim_select();\r\n        this.rest_schedule();\r\n        this.auto_work();\r\n    },\r\n\r\n    update(dt) {\r\n        this.ai_move(dt);\r\n    },\r\n});\r\n"]}